<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Secure Payment Confirmation</title>
  <link href="https://www.w3.org/TR/secure-payment-confirmation/" rel="canonical">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-issues */

a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-wpt */

:root {
    --wpt-border: hsl(0, 0%, 60%);
    --wpt-bg: hsl(0, 0%, 95%);
    --wpt-text: var(--text);
    --wptheading-text: hsl(0, 0%, 30%);
}
@media (prefers-color-scheme: dark) {
    :root {
        --wpt-border: hsl(0, 0%, 30%);
        --wpt-bg: var(--borderedblock-bg);
        --wpt-text: var(--text);
        --wptheading-text: hsl(0, 0%, 60%);
    }
}
.wpt-tests-block {
    list-style: none;
    border-left: .5em solid var(--wpt-border);
    background: var(--wpt-bg);
    color: var(--wpt-text);
    margin: 1em auto;
    padding: .5em;
}
.wpt-tests-block summary {
    color: var(--wptheading-text);
    font-weight: normal;
    text-transform: uppercase;
}
.wpt-tests-block summary::marker{
    color: var(--wpt-border);
}
.wpt-tests-block summary:hover::marker{
    color: var(--wpt-text);
}
/*
   The only content  of a wpt test block in its closed state is the <summary>,
   which contains the word TESTS,
   and that is absolutely positioned.
   In that closed state, wpt test blocks are styled
   to have a top margin whose height is exactly equal
   to the height of the absolutely positioned <summary>,
   and no other background/padding/margin/border.
   The wpt test block elements will therefore allow the maring
   of the previous/next block elements
   to collapse through them;
   if this combined margin would be larger than its own top margin,
   it stays as is,
   and therefore the pre-existing vertical rhythm of the document is undisturbed.
   If that combined margin would be smaller, it is grown to that size.
   This means that the wpt test block ensures
   that there's always enough vertical space to insert the summary,
   without adding more than is needed.
*/
.wpt-tests-block:not([open]){
    padding: 0;
    border: none;
    background: none;
    font-size: 0.75em;
    line-height: 1;
    position: relative;
    margin: 1em 0 0;
}
.wpt-tests-block:not([open]) summary {
    position: absolute;
    right: 0;
    bottom: 0;
}
/*
   It is possible that both the last child of a block element
   and the block element itself
   would be annotated with a <wpt> block each.
   If the block element has a padding or a border,
   that's fine, but otherwise
   the bottom margin of the block and of its last child would collapse
   and both <wpt> elements would overlap, being both placed there.
   To avoid that, add 1px of padding to the <wpt> element annotating the last child
   to prevent the bottom margin of the block and of its last child from collapsing
   (and as much negative margin,
   as wel only want to prevent margin collapsing,
   but are not trying to actually take more space).
*/
.wpt-tests-block:not([open]):last-child {
    padding-bottom: 1px;
    margin-bottom: -1px;
}
/*
   Exception to the previous rule:
   don't do that in non-last list items,
   because it's not necessary,
   and would therefore consume more space than strictly needed.
   Lists must have list items as children, not <wpt> elements,
   so a <wpt> element cannot be a sibling of a list item,
   and the collision that the previous rule avoids cannot happen.
*/
li:not(:last-child) > .wpt-tests-block:not([open]):last-child,
dd:not(:last-child) > .wpt-tests-block:not([open]):last-child {
    padding-bottom: 0;
    margin-bottom: 0;
}
.wpt-tests-block:not([open]):not(:hover){
    opacity: 0.5;
}
.wpt-tests-list {
    list-style: none;
    display: grid;
    margin: 0;
    padding: 0;
    grid-template-columns: 1fr max-content auto auto;
    grid-column-gap: .5em;
}
.wpt-tests-block hr:last-child {
    display: none;
}
.wpt-test {
    display: contents;
}
.wpt-test > a {
    text-decoration: underline;
    border: none;
}
.wpt-test > .wpt-name { grid-column: 1; }
.wpt-test > .wpt-results { grid-column: 2; }
.wpt-test > .wpt-live { grid-column: 3; }
.wpt-test > .wpt-source { grid-column: 4; }

.wpt-test > .wpt-results {
    display: flex;
    gap: .1em;
}
.wpt-test .wpt-result {
    display: inline-block;
    height: 1em;
    width: 1em;
    border-radius: 50%;
    position: relative;
}
</style>
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-ED" rel="stylesheet">
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Secure Payment Confirmation</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="profile-and-date"><span class="content">Editor’s Draft, <time class="dt-updated" datetime="1970-01-01">1 January 1970</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://w3c.github.io/secure-payment-confirmation/">https://w3c.github.io/secure-payment-confirmation/</a>
     <dt>Latest published version:
     <dd><a href="https://www.w3.org/TR/secure-payment-confirmation/">https://www.w3.org/TR/secure-payment-confirmation/</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard" data-editor-id="83784"><a class="p-name fn u-email email" href="mailto:rouslan@chromium.org">Rouslan Solomakhin</a> (<a class="p-org org" href="https://www.google.com/">Google</a>)
     <dd class="editor p-author h-card vcard" data-editor-id="96463"><a class="p-name fn u-email email" href="mailto:smcgruer@chromium.org">Stephen McGruer</a> (<a class="p-org org" href="https://www.google.com/">Google</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 1970 <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>, <a href="https://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document" rel="license">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>Secure Payment Confirmation (SPC) is a Web API to support streamlined

  authentication during a payment transaction. It is designed to scale authentication
  across merchants, to be used within a wide range of authentication protocols, and
  to produce cryptographic evidence that the user has confirmed transaction details.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#sctn-intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li>
       <a href="#sctn-use-cases"><span class="secno">1.1</span> <span class="content">Use Cases</span></a>
       <ol class="toc">
        <li><a href="#sctn-use-case-verifying-payment"><span class="secno">1.1.1</span> <span class="content">Cryptographic evidence of transaction confirmation</span></a>
        <li><a href="#sctn-use-case-iframe-registration"><span class="secno">1.1.2</span> <span class="content">Registration in a third-party iframe</span></a>
        <li><a href="#sctn-use-case-merchant-authentication"><span class="secno">1.1.3</span> <span class="content">Merchant control of authentication</span></a>
       </ol>
      <li>
       <a href="#sctn-sample-scenarios"><span class="secno">1.2</span> <span class="content">Sample API Usage Scenarios</span></a>
       <ol class="toc">
        <li><a href="#sctn-sample-registration"><span class="secno">1.2.1</span> <span class="content">Registration during a checkout</span></a>
        <li><a href="#sctn-sample-authentication"><span class="secno">1.2.2</span> <span class="content">Authentication on merchant site</span></a>
       </ol>
     </ol>
    <li><a href="#sctn-terminology"><span class="secno">2</span> <span class="content">Terminology</span></a>
    <li><a href="#sctn-registration"><span class="secno">3</span> <span class="content">Registration</span></a>
    <li>
     <a href="#sctn-authentication"><span class="secno">4</span> <span class="content">Authentication</span></a>
     <ol class="toc">
      <li>
       <a href="#sctn-payment-method-spc"><span class="secno">4.1</span> <span class="content">Payment Method: Secure Payment Confirmation</span></a>
       <ol class="toc">
        <li><a href="#sctn-payment-method-identifier"><span class="secno">4.1.1</span> <span class="content">Payment Method Identifier</span></a>
        <li><a href="#sctn-registration-in-payment-method-id"><span class="secno">4.1.2</span> <span class="content">Registration in <span>[payment-method-id]</span></span></a>
        <li><a href="#sctn-securepaymentconfirmationrequest-dictionary"><span class="secno">4.1.3</span> <span class="content"><span><code>SecurePaymentConfirmationRequest</code></span> Dictionary</span></a>
        <li><a href="#sctn-payment-method-additional-data-type"><span class="secno">4.1.4</span> <span class="content">Payment Method additional data type</span></a>
        <li><a href="#sctn-steps-to-validate-payment-method-data"><span class="secno">4.1.5</span> <span class="content">Steps to validate payment method data</span></a>
        <li><a href="#sctn-steps-to-check-if-a-payment-can-be-made"><span class="secno">4.1.6</span> <span class="content">Steps to check if a payment can be made</span></a>
        <li><a href="#sctn-transaction-confirmation-ux"><span class="secno">4.1.7</span> <span class="content">Displaying a transaction confirmation UX</span></a>
        <li><a href="#sctn-steps-to-respond-to-a-payment-request"><span class="secno">4.1.8</span> <span class="content">Steps to respond to a payment request</span></a>
       </ol>
     </ol>
    <li>
     <a href="#sctn-payment-extension-registration"><span class="secno">5</span> <span class="content">WebAuthn Extension - "<code>payment</code>"</span></a>
     <ol class="toc">
      <li><a href="#sctn-collectedclientpaymentdata-dictionary"><span class="secno">5.1</span> <span class="content"><span><code>CollectedClientPaymentData</code></span> Dictionary</span></a>
      <li><a href="#sctn-collectedclientadditionalpaymentdata-dictionary"><span class="secno">5.2</span> <span class="content"><span><code>CollectedClientAdditionalPaymentData</code></span> Dictionary</span></a>
     </ol>
    <li>
     <a href="#sctn-common-data-structures"><span class="secno">6</span> <span class="content">Common Data Structures</span></a>
     <ol class="toc">
      <li><a href="#sctn-paymentcredentialinstrument-dictionary"><span class="secno">6.1</span> <span class="content"><span><code>PaymentCredentialInstrument</code></span> Dictionary</span></a>
     </ol>
    <li><a href="#sctn-permissions-policy"><span class="secno">7</span> <span class="content">Permissions Policy integration</span></a>
    <li>
     <a href="#sctn-relying-party-operations"><span class="secno">8</span> <span class="content">SPC Relying Party Operations</span></a>
     <ol class="toc">
      <li><a href="#sctn-verifying-assertion"><span class="secno">8.1</span> <span class="content">Verifying an Authentication Assertion</span></a>
     </ol>
    <li>
     <a href="#sctn-automation"><span class="secno">9</span> <span class="content">User Agent Automation</span></a>
     <ol class="toc">
      <li><a href="#sctn-automation-set-spc-transaction-mode"><span class="secno">9.1</span> <span class="content"><span>Set SPC Transaction Mode</span></span></a>
     </ol>
    <li>
     <a href="#sctn-security-considerations"><span class="secno">10</span> <span class="content">Security Considerations</span></a>
     <ol class="toc">
      <li>
       <a href="#sctn-security-cross-origin-auth"><span class="secno">10.1</span> <span class="content">Cross-origin authentication ceremony</span></a>
       <ol class="toc">
        <li><a href="#sctn-security-login-attack"><span class="secno">10.1.1</span> <span class="content">Login Attack</span></a>
        <li><a href="#sctn-security-payment-attack"><span class="secno">10.1.2</span> <span class="content">Payment Attack</span></a>
       </ol>
      <li><a href="#sctn-security-merchant-data"><span class="secno">10.2</span> <span class="content">Merchant-supplied authentication data</span></a>
     </ol>
    <li>
     <a href="#sctn-privacy-considerations"><span class="secno">11</span> <span class="content">Privacy Considerations</span></a>
     <ol class="toc">
      <li><a href="#sctn-security-cross-origin-registration"><span class="secno">11.1</span> <span class="content">Registration in a Cross-Origin iframe</span></a>
      <li><a href="#sctn-privacy-probing-credential-ids"><span class="secno">11.2</span> <span class="content">Probing for credential ids</span></a>
      <li><a href="#sctn-privacy-joining-payment-instruments"><span class="secno">11.3</span> <span class="content">Joining different payment instruments</span></a>
      <li><a href="#sctn-privacy-credential-id-tracking-vector"><span class="secno">11.4</span> <span class="content">Credential ID(s) as a tracking vector</span></a>
     </ol>
    <li><a href="#sctn-accessibility-considerations"><span class="secno">12</span> <span class="content">Accessibility Considerations</span></a>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <div class="non-normative">
    <h2 class="heading settled" data-level="1" id="sctn-intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#sctn-intro"></a></h2>
    <p><em>This section and its sub-sections are non-normative.</em></p>
    <p>This specification defines an API that enables the use of strong authentication
methods in payment flows on the web. It aims to provide the same authentication
benefits and user privacy focus as <span>[webauthn-3]</span> with enhancements to meet the
needs of payment processing.</p>
    <p>Similarly to <span>[webauthn-3]</span>, this specification defines two related processes
involving a user. The first is <a href="#sctn-registration">§ 3 Registration</a> (formerly "enrollment"),
where a relationship is created between the user and the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party">Relying Party</a>. The
second is <a href="#sctn-authentication">§ 4 Authentication</a>, where the user responds to a challenge from
the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①">Relying Party</a> (possibly via an intermediary payment service provider)
to consent to a specific payment.</p>
    <p>It is a goal of this specification to reduce authentication friction during
checkout, and one aspect of that is to maximize the number of authentications
that the user can perform for a given registration. That is, with consent
from the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②">Relying Party</a>, ideally the user could "register once" and
authenticate on any merchant origin (and via payment service provider),
not just the merchant origin where the user first registered.</p>
    <p>To that end, an important feature of Secure Payment Confirmation is
that the merchant (or another entity) may initiate the authentication
ceremony on the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③">Relying Party’s</a> behalf. The <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④">Relying Party</a> must
opt-in to allowing this behavior during credential creation.</p>
    <p>Functionally, this specification defines a new <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-method" id="ref-for-dfn-payment-method">payment method</a> for the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/payment-request/#dom-paymentrequest" id="ref-for-dom-paymentrequest">PaymentRequest</a></code> API, and adds a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#webauthn-extensions" id="ref-for-webauthn-extensions">WebAuthn Extension</a> to extend <span>[webauthn-3]</span> with payment-specific datastructures and to relax assumptions to
allow the API to be called in payment contexts.</p>
    <h3 class="heading settled" data-level="1.1" id="sctn-use-cases"><span class="secno">1.1. </span><span class="content">Use Cases</span><a class="self-link" href="#sctn-use-cases"></a></h3>
    <p>Although <span>[webauthn-3]</span> provides general authentication capabilities for the
Web, the following use cases illustrate the value of the payment-specific
extension defined in this specification.</p>
    <p>We presume that the general use case of cryptographic-based authentication for
online transactions is well established.</p>
    <p class="note" role="note"><span>Note:</span> These sections are still a WIP.</p>
    <h4 class="heading settled" data-level="1.1.1" id="sctn-use-case-verifying-payment"><span class="secno">1.1.1. </span><span class="content">Cryptographic evidence of transaction confirmation</span><a class="self-link" href="#sctn-use-case-verifying-payment"></a></h4>
    <p>In many online payment systems, it is common for the entity (e.g., bank) that
issues a payment instrument to seek to reduce fraud through authentication. <span>[webauthn-3]</span> and this specification make it possible to use authenticators to
cryptographically sign important payment-specific information such as the
origin of the merchant and the transaction amount and currency. The bank, as
the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party⑤">Relying Party</a>, can then verify the signed payment-specific information
as part of the decision to authorize the payment.</p>
    <p>If the bank uses plain <span>[webauthn-3]</span>, the payment-specific information to be
verified must be stored in the WebAuthn <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-challenge" id="ref-for-dom-publickeycredentialrequestoptions-challenge">challenge</a></code>. This raises several issues:</p>
    <ol>
     <li data-md>
      <p>It is a misuse of the <code>challenge</code> field (which is intended to defeat replay
attacks).</p>
     <li data-md>
      <p>There is no specification for this, so each bank is likely to have
to devise its own format for how payment-specific information should be
formatted and encoded in the challenge, complicating deployment and
increasing fragmentation.</p>
     <li data-md>
      <p>Regulations may require evidence that the user was shown and agreed to the
payment-specific information. Plain <span>[webauthn-3]</span> does not provide for
this display: there is no specified UX associated with information stored
in the <code>challenge</code> field.</p>
    </ol>
    <p>These limitations motivate the following Secure Payment Confirmation behaviors:</p>
    <ol>
     <li data-md>
      <p>The <code>challenge</code> field is only used to defeat replay attacks, as with plain <span>[webauthn-3]</span>.</p>
     <li data-md>
      <p>SPC specifies a format for payment-specific information. This will enable
development of generic verification code and test suites.</p>
     <li data-md>
      <p>SPC guarantees that the user agent has presented the payment-specific
information to the user in a way that a malicious website (or maliciously
introduced JavaScript code on a trusted website) cannot bypass.</p>
      <ul>
       <li data-md>
        <p>The payment-specific information is included in the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata" id="ref-for-dictdef-collectedclientdata">CollectedClientData</a></code> dictionary, which cannot be tampered with via
JavaScript.</p>
      </ul>
      <p class="note" role="note"><span>NOTE:</span> Banks and other stakeholders in the payments ecosystem trust payments
via browsers sufficiently today using TLS, iframes, and other Web features.
The current specification is designed to increase the security and usability
of Web payments.</p>
    </ol>
    <h4 class="heading settled" data-level="1.1.2" id="sctn-use-case-iframe-registration"><span class="secno">1.1.2. </span><span class="content">Registration in a third-party iframe</span><a class="self-link" href="#sctn-use-case-iframe-registration"></a></h4>
    <p>If a bank wishes to use <span>[webauthn-3]</span> as the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party⑥">Relying Party</a>, that
specification requires the bank to register the user in a first party context.
Registration can happen outside of a transaction while the user is visiting the
bank’s site. It is also useful to be able to register the user during a
transaction, but any registration that interrupts the payment journey creates a
risk of transaction abandonment.</p>
    <p>This limitation motivates the following Secure Payment Confirmation behavior:</p>
    <ol>
     <li data-md>
      <p>SPC supports cross-origin registration from an iframe in a third-party
context. For instance, this registration might take place following some
other identity and verification (<abbr>ID&amp;V</abbr>) flow (e.g., SMS OTP).</p>
    </ol>
    <ul>
     <li data-md>
      <p>See <a href="https://github.com/w3c/webauthn/issues/1336#issuecomment-554170183">discussion
on WebAuthn issue 1336</a>.</p>
    </ul>
    <h4 class="heading settled" data-level="1.1.3" id="sctn-use-case-merchant-authentication"><span class="secno">1.1.3. </span><span class="content">Merchant control of authentication</span><a class="self-link" href="#sctn-use-case-merchant-authentication"></a></h4>
    <p>Merchants seek to avoid user drop-off during checkout, in particular by
reducing authentication friction. A <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party⑦">Relying Party</a> (e.g., a bank) that
wishes to use <span>[webauthn-3]</span> to authenticate the user typically does so from an
iframe. However, merchants would prefer to manage the user experience of
authenticating the user while still enabling the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party⑧">Relying Party</a> to verify
the results of authentication.</p>
    <p>This limitation motivates the following Secure Payment Confirmation behavior:</p>
    <ul>
     <li data-md>
      <p>With SPC, other parties than the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party⑨">Relying Party</a> can use authentication
credentials <em>on behalf of</em> the Relying Party. The Relying Party can then
verify the authentication results.</p>
    </ul>
    <p>An additional benefit of this feature to Relying Parties is that they no longer
need to build their own front-end experiences for authentication. Instead,
payment service providers are likely to build them on behalf of merchants.</p>
    <p class="note" role="note"><span>NOTE:</span> Relying Parties that wish to provide the authentication user experience
may still do so using SPC from an iframe.</p>
    <h3 class="heading settled" data-level="1.2" id="sctn-sample-scenarios"><span class="secno">1.2. </span><span class="content">Sample API Usage Scenarios</span><a class="self-link" href="#sctn-sample-scenarios"></a></h3>
    <p>In this section, we walk through some scenarios for Secure Payment Confirmation
and the corresponding sample code for using this API. Note that these are
example flows and do not limit the scope of how the API can be used.</p>
    <h4 class="heading settled" data-level="1.2.1" id="sctn-sample-registration"><span class="secno">1.2.1. </span><span class="content">Registration during a checkout</span><a class="self-link" href="#sctn-sample-registration"></a></h4>
    <p>This is a first-time flow, in which a new credential is created and stored by
an issuing bank during a checkout by the user on some merchant.</p>
    <ol>
     <li data-md>
      <p>The user visits <code>merchant.com</code>, selects an item to purchase, and proceeds to
the checkout flow. They enter their payment instrument details, and indicate
that they wish to pay (e.g., by pressing a "Pay" button).</p>
     <li data-md>
      <p>The merchant communicates out-of-band (e.g., using another protocol) with the
bank that issued the payment instrument. The issuing bank requests
verification of the user, and provides a bank-controlled URL for the
merchant to open in an iframe.</p>
     <li data-md>
      <p>The merchant opens an iframe to <code>bank.com</code>, with the <code>allow</code> attribute set to
"<a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-permission" id="ref-for-dfn-payment-permission">payment</a>".</p>
     <li data-md>
      <p>In the iframe, the issuing bank confirms the user’s identity via a
traditional means (e.g., SMS OTP). After confirmation, the bank invites the
user to register in SPC authentication for future payments.</p>
     <li data-md>
      <p>The user consents (e.g., by clicking an "Register" button in the bank UX),
and the bank runs code in the iframe (see example below).</p>
     <li data-md>
      <p>The user goes through a WebAuthn registration flow. A new credential is
created and returned to the issuing bank who stores it in their server-side
database associated with the user and payment instrument(s).</p>
     <li data-md>
      <p>The verification completes; the bank iframe closes and the merchant finishes
the checkout process for the user.</p>
    </ol>
    <p>Sample code for registering the user in this way follows:</p>
<pre class="example highlight" id="registration-example"><a class="self-link" href="#registration-example"></a><c- k>if</c-> <c- p>(</c-><c- o>!</c->window<c- p>.</c->PublicKeyCredential<c- p>)</c-> <c- p>{</c-> <c- d>/* Client not capable. Handle error. */</c-> <c- p>}</c->

<c- a>const</c-> publicKey <c- o>=</c-> <c- p>{</c->
  <c- c1>// The challenge should be created by the bank server and sent to the iframe.</c->
  challenge<c- o>:</c-> <c- ow>new</c-> Uint8Array<c- p>([</c-><c- mf>21</c-><c- p>,</c-><c- mf>31</c-><c- p>,</c-><c- mf>105</c-> <c- d>/* 29 more random bytes generated by the server */</c-><c- p>]),</c->

  <c- c1>// Relying Party:</c->
  rp<c- o>:</c-> <c- p>{</c->
    name<c- o>:</c-> <c- u>"Fancy Bank"</c-><c- p>,</c->
  <c- p>},</c->

  <c- c1>// User:</c->
  user<c- o>:</c-> <c- p>{</c->
    <c- c1>// Part of WebAuthn. This information is not required by SPC</c->
    <c- c1>// but may be used by the bank server to identify this user in</c->
    <c- c1>// future transactions. Inconsistent values for the same user</c->
    <c- c1>// can result in the creation of multiple credentials for the user</c->
    <c- c1>// and thus potential UX friction due to credential selection.</c->
    id<c- o>:</c-> Uint8Array<c- p>.</c-><c- kr>from</c-><c- p>(</c->window<c- p>.</c->atob<c- p>(</c-><c- u>"MIIBkzCCATigAwIBAjCCAZMwggE4oAMCAQIwggGTMII="</c-><c- p>),</c-> c<c- p>=></c->c<c- p>.</c->charCodeAt<c- p>(</c-><c- mf>0</c-><c- p>)),</c->
    name<c- o>:</c-> <c- u>"jane.doe@example.com"</c-><c- p>,</c->
    displayName<c- o>:</c-> <c- u>"Jane Doe"</c-><c- p>,</c->
  <c- p>},</c->

  <c- c1>// In this example the Relying Party accepts either an ES256 or RS256</c->
  <c- c1>// credential, but prefers an ES256 credential.</c->
  pubKeyCredParams<c- o>:</c-> <c- p>[</c->
    <c- p>{</c->
      type<c- o>:</c-> <c- u>"public-key"</c-><c- p>,</c->
      alg<c- o>:</c-> <c- o>-</c-><c- mf>7</c-> <c- c1>// "ES256"</c->
    <c- p>},</c->
    <c- p>{</c->
      type<c- o>:</c-> <c- u>"public-key"</c-><c- p>,</c->
      alg<c- o>:</c-> <c- o>-</c-><c- mf>257</c-> <c- c1>// "RS256"</c->
    <c- p>}</c->
  <c- p>],</c->

  authenticatorSelection<c- o>:</c-> <c- p>{</c->
    userVerification<c- o>:</c-> <c- u>"required"</c-><c- p>,</c->
    residentKey<c- o>:</c-> <c- u>"required"</c-><c- p>,</c->
    authenticatorAttachment<c- o>:</c-> <c- u>"platform"</c-><c- p>,</c->
  <c- p>},</c->

  timeout<c- o>:</c-> <c- mf>360000</c-><c- p>,</c->  <c- c1>// 6 minutes</c->

  <c- c1>// Indicate that this is an SPC credential. This is currently required so</c->
  <c- c1>// that the browser knows this credential relates to SPC. It also enables</c->
  <c- c1>// credential creation in a cross-origin iframe, which is required for this</c->
  <c- c1>// example.</c->
  <c- c1>//</c->
  <c- c1>// A future version of the spec may remove the need for this extension.</c->
  extensions<c- o>:</c-> <c- p>{</c->
    <c- u>"payment"</c-><c- o>:</c-> <c- p>{</c->
      isPayment<c- o>:</c-> <c- kc>true</c-><c- p>,</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>};</c->

<c- c1>// Note: The following call will cause the authenticator to display UI.</c->
navigator<c- p>.</c->credentials<c- p>.</c->create<c- p>({</c-> publicKey <c- p>})</c->
  <c- p>.</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->newCredentialInfo<c- p>)</c-> <c- p>{</c->
    <c- c1>// Send new credential info to server for verification and registration.</c->
  <c- p>}).</c-><c- k>catch</c-><c- p>(</c-><c- a>function</c-> <c- p>(</c->err<c- p>)</c-> <c- p>{</c->
    <c- c1>// No acceptable authenticator or user refused consent. Handle appropriately.</c->
  <c- p>});</c->
</pre>
   </div>
   <h4 class="heading settled" data-level="1.2.2" id="sctn-sample-authentication"><span class="secno">1.2.2. </span><span class="content">Authentication on merchant site</span><a class="self-link" href="#sctn-sample-authentication"></a></h4>
   <p>This is the flow when a user with an already registered credential is
performing a transaction and the issuing bank and merchant wish to use Secure
Payment Confirmation.</p>
   <ol>
    <li data-md>
     <p>The user visits <code>merchant.com</code>, selects an item to purchase, and proceeds
to the checkout flow. They enter their payment instrument details, and
indicate that they wish to pay (e.g., by pressing a "Pay" button).</p>
    <li data-md>
     <p>The merchant communicates out-of-band with the issuing bank of the payment
instrument (e.g., using another protocol). The issuing bank requests
verification of the user, and at the same time informs the merchant that it
accepts SPC by providing the information necessary to use the API. This
information includes a challenge and any credential IDs associated with this
user and payment instrument(s).</p>
    <li data-md>
     <p>The merchant runs the example code shown below.</p>
    <li data-md>
     <p>The user agrees to the payment-specific information displayed in the SPC UX,
and performs a subsequent WebAuthn authentication ceremony. The signed
cryptogram is returned to the merchant.</p>
    <li data-md>
     <p>The merchant communicates the signed cryptogram to the issuing bank
out-of-band. The issuing bank verifies the cryptogram, and knows that the
user is valid, what payment-specific information has been displayed, and
that the user has consented to the transaction. The issuing bank authorizes
the transaction and the merchant finishes the checkout process for the user.</p>
   </ol>
   <p>The sample code for authenticating the user follows. Note that the example code
presumes access to await/async, for easier to read promise handling.</p>
<pre class="example highlight" id="authentication-example"><a class="self-link" href="#authentication-example"></a><c- k>if</c-> <c- p>(</c-><c- o>!</c->window<c- p>.</c->PaymentRequest<c- p>)</c-> <c- p>{</c-> <c- d>/* PaymentRequest not available; merchant should fallback to traditional flows */</c-> <c- p>}</c->

<c- a>const</c-> request <c- o>=</c-> <c- ow>new</c-> PaymentRequest<c- p>([{</c->
  supportedMethods<c- o>:</c-> <c- u>"secure-payment-confirmation"</c-><c- p>,</c->
  data<c- o>:</c-> <c- p>{</c->
    <c- c1>// List of credential IDs obtained from the bank.</c->
    credentialIds<c- p>,</c->

    rpId<c- o>:</c-> <c- u>"fancybank.com"</c-><c- p>,</c->

    <c- c1>// The challenge is also obtained from the bank.</c->
    challenge<c- o>:</c-> <c- ow>new</c-> Uint8Array<c- p>([</c-><c- mf>21</c-><c- p>,</c-><c- mf>31</c-><c- p>,</c-><c- mf>105</c-> <c- d>/* 29 more random bytes generated by the bank */</c-><c- p>]),</c->

    instrument<c- o>:</c-> <c- p>{</c->
      displayName<c- o>:</c-> <c- u>"Fancy Card ****1234"</c-><c- p>,</c->
      icon<c- o>:</c-> <c- u>"https://fancybank.com/card-art.png"</c-><c- p>,</c->
    <c- p>},</c->

    payeeName<c- o>:</c-> <c- u>"Merchant Shop"</c-><c- p>,</c->
    payeeOrigin<c- o>:</c-> <c- u>"https://merchant.com"</c-><c- p>,</c->

    timeout<c- o>:</c-> <c- mf>360000</c-><c- p>,</c->  <c- c1>// 6 minutes</c->
  <c- p>}],</c-> <c- p>{</c->
    total<c- o>:</c-> <c- p>{</c->
      label<c- o>:</c-> <c- u>"Total"</c-><c- p>,</c->
      amount<c- o>:</c-> <c- p>{</c->
        currency<c- o>:</c-> <c- u>"USD"</c-><c- p>,</c->
        value<c- o>:</c-> <c- u>"5.00"</c-><c- p>,</c->
      <c- p>},</c->
    <c- p>},</c->
  <c- p>});</c->

  <c- d>/* canMakePayment indicates whether the browser supports SPC. */</c->
  <c- d>/* canMakePayment does not indicate whether the user has a credential */</c->
  <c- d>/* ready to go on this device. */</c->

<c- k>try</c-> <c- p>{</c->
  <c- a>const</c-> canMakePayment <c- o>=</c-> <c- k>await</c-> request<c- p>.</c->canMakePayment<c- p>();</c->
  <c- k>if</c-> <c- p>(</c-><c- o>!</c->canMakePayment<c- p>)</c-> <c- p>{</c-> <c- d>/* Browser does not support SPC. Handle error. */</c-> <c- p>}</c->

  <c- a>const</c-> response <c- o>=</c-> <c- k>await</c-> request<c- p>.</c->show<c- p>();</c->
  <c- k>await</c-> response<c- p>.</c->complete<c- p>(</c-><c- t>'success'</c-><c- p>);</c->

  <c- c1>// response.data is a PublicKeyCredential, with a clientDataJSON that</c->
  <c- c1>// contains the transaction data for verification by the issuing bank.</c->

  <c- d>/* send response.data to the issuing bank for verification */</c->
<c- p>}</c-> <c- k>catch</c-> <c- p>(</c->err<c- p>)</c-> <c- p>{</c->
  <c- d>/* SPC cannot be used; merchant should fallback to traditional flows */</c->
<c- p>}</c->
</pre>
   <h2 class="heading settled" data-level="2" id="sctn-terminology"><span class="secno">2. </span><span class="content">Terminology</span><a class="self-link" href="#sctn-terminology"></a></h2>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="spc-credential">SPC Credential</dfn>
    <dd data-md>
     <p>A <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#public-key-credential" id="ref-for-public-key-credential">WebAuthn credential</a> that can be used for the
behaviors defined in this specification. When an SPC Credential is to be
used by a party other than the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①⓪">Relying Party</a>, the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①①">Relying Party</a> must
explicitly opt in by declaring the credential for SPC at creation time.</p>
     <p>This specification does not intend to limit how SPC credentials may (or may
not) be used by a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①②">Relying Party</a> for other authentication flows (e.g.,
login).</p>
     <p class="note" role="note"><span>Note:</span> The current version of this specification requires the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①③">Relying
      Party</a> to explicitly opt in for a credential to be used in
      either a first-party or third-party context. Longer-term, our
      intention is that all <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#public-key-credential" id="ref-for-public-key-credential①">WebAuthn credentials</a> will be usable for SPC in a first-party context (e.g., on the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①④">Relying Party’s</a> domain) and opt-in will only be required to allow
      a credential to be used by a third-party.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="steps-to-silently-determine-if-a-credential-is-spc-enabled">Steps to silently determine if a credential is SPC-enabled</dfn>
    <dd data-md>
     <p>An as-yet undefined process by which a user agent can, given a <span spec-section="#relying-party-identifier">Relying Party Identifier</span> and a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#credential-id" id="ref-for-credential-id">credential ID</a>, silently (i.e., without user interaction) determine if
the credential represented by that ID is an <a data-link-type="dfn" href="#spc-credential" id="ref-for-spc-credential">SPC Credential</a>.</p>
     <p class="note" role="note"><span>NOTE:</span> See <a href="https://github.com/w3c/webauthn/issues/1667">WebAuthn
issue 1667</a>.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="steps-to-silently-determine-if-a-credential-is-available-for-the-current-device">Steps to silently determine if a credential is available for the current device</dfn>
    <dd data-md>
     <p>An as-yet undefined process by which a user agent can, given a <span spec-section="#relying-party-identifier">Relying Party Identifier</span> and a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#credential-id" id="ref-for-credential-id①">credential ID</a>, silently (i.e., without user interaction) determine if
the credential represented by that credential ID is available for the
current device (i.e., could be successfully used as part of a WebAuthn <span spec-section="#sctn-getAssertion">Get</span> call).</p>
     <p>This allows the user agent to only conditionally display <a href="#sctn-transaction-confirmation-ux">the transaction UX</a> to the user if
there is some chance that they can successfully complete the transaction.</p>
     <p class="note" role="note"><span>NOTE:</span> This property will likely require that <a data-link-type="dfn" href="#spc-credential" id="ref-for-spc-credential①">SPC Credentials</a> be <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#discoverable-credential" id="ref-for-discoverable-credential">discoverable</a>; as such this specification
currently encodes that as a requirement.</p>
     <p class="note" role="note"><span>NOTE:</span> This property is very similar to that which is required for the <a data-biblio-display="inline" data-link-type="biblio" href="https://github.com/w3c/webauthn/issues/1545"><cite>WebAuthn Conditional UI Proposal</cite></a>. It is likely that both it and SPC could
be supported by the same underlying API.</p>
   </dl>
   <h2 class="heading settled" data-level="3" id="sctn-registration"><span class="secno">3. </span><span class="content">Registration</span><a class="self-link" href="#sctn-registration"></a></h2>
   <p>To register a user for Secure Payment Confirmation, relying parties should call <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-create" id="ref-for-dom-credentialscontainer-create">navigator.credentials.create()</a></code>, with the <code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionsclientinputs-payment" id="ref-for-dom-authenticationextensionsclientinputs-payment">payment</a></code> <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#webauthn-extensions" id="ref-for-webauthn-extensions①">WebAuthn Extension</a> specified.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list"></ul>
   </details>
   <p class="note" role="note"><span>Note:</span> In this specification we define an extension in order to allow (1)
      credential creation in a cross-origin iframe (which WebAuthn does not yet
      allow) and (2) the browser to cache SPC credentials in the absence of <a data-link-type="biblio" href="#biblio-webauthn-conditional-ui">Conditional UI</a>. If these capabilities are
      available in future versions of WebAuthn, we may remove the requirement
      for the extension from SPC. Note that SPC credentials (with the extension)
      are otherwise full-fledged WebAuthn credentials.</p>
   <h2 class="heading settled" data-level="4" id="sctn-authentication"><span class="secno">4. </span><span class="content">Authentication</span><a class="self-link" href="#sctn-authentication"></a></h2>
   <p>To authenticate a payment via Secure Payment Confirmation, this specification
defines a new <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-method" id="ref-for-dfn-payment-method①">payment method</a>, "<a data-link-type="dfn" href="#secure-payment-confirmation" id="ref-for-secure-payment-confirmation">secure-payment-confirmation</a>". This
payment method confirms the transaction with the user and then performs an <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#authentication-ceremony" id="ref-for-authentication-ceremony">authentication ceremony</a> to authenticate the user and create a signed blob
representing the authentication ceremony.</p>
   <p>At a high level, authentication for Secure Payment Confirmation is similar to <span>[webauthn-3]</span>, with one major conceptual shift. Secure Payment Confirmation
allows a third-party (e.g., the merchant) to trigger an authentication ceremony
on behalf of the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①⑤">Relying Party</a>, passing in credentials that it has obtained
from the Relying Party on some other unspecified channel. See <a href="#sctn-use-case-merchant-authentication">§ 1.1.3 Merchant control of authentication</a>.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <p>This test file tests inherited behavior from the PaymentRequest
            specification; that a user activation is required to call show()
            (and thus to trigger SPC authentication). We test it explicitly for
            SPC to make it clear that this behavior is desirable even if the
            API shape for SPC changes in the future.</p>
    <ul class="wpt-tests-list"></ul>
    <hr>
   </details>
   <h3 class="heading settled" data-level="4.1" id="sctn-payment-method-spc"><span class="secno">4.1. </span><span class="content">Payment Method: Secure Payment Confirmation</span><a class="self-link" href="#sctn-payment-method-spc"></a></h3>
   <p>This specification defines a new <a data-link-type="dfn" href="https://www.w3.org/TR/payment-request/#dfn-payment-handler" id="ref-for-dfn-payment-handler">payment handler</a>, the <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="Secure Payment Confirmation payment handler" data-noexport id="secure-payment-confirmation-payment-handler">Secure Payment
Confirmation payment handler</dfn>, which handles requests to authenticate a
given payment.</p>
   <p class="note" role="note"><span>NOTE:</span> To quickly support an initial SPC experiment, this API was designed atop
existing implementations of the Payment Request and Payment Handler APIs. There
is now general agreement to explore a design of SPC independent of Payment
Request. We therefore expect (without a concrete timeline) that SPC will move
away from its Payment Request origins. For developers, this should improve
feature detection, invocation, and other aspects of the API.</p>
   <div class="note" role="note"> <strong>TODO</strong>: This specification also needs to constrain <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/payment-request/#dom-paymentrequest-constructor" id="ref-for-dom-paymentrequest-constructor">PaymentRequest’s constructor</a></code> somehow, to enforce
that when "<a data-link-type="dfn" href="#secure-payment-confirmation" id="ref-for-secure-payment-confirmation①">secure-payment-confirmation</a>" is used exactly one method is
given. </div>
   <h4 class="heading settled" data-level="4.1.1" id="sctn-payment-method-identifier"><span class="secno">4.1.1. </span><span class="content">Payment Method Identifier</span><a class="self-link" href="#sctn-payment-method-identifier"></a></h4>
   <p>The <a data-link-type="dfn" href="https://www.w3.org/TR/payment-method-id/#dfn-standardized-payment-method-identifier" id="ref-for-dfn-standardized-payment-method-identifier">standardized payment method identifier</a> for the <a data-link-type="dfn" href="#secure-payment-confirmation-payment-handler" id="ref-for-secure-payment-confirmation-payment-handler">Secure Payment
Confirmation payment handler</a> is "<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="secure-payment-confirmation">secure-payment-confirmation</dfn>".</p>
   <h4 class="heading settled" data-level="4.1.2" id="sctn-registration-in-payment-method-id"><span class="secno">4.1.2. </span><span class="content">Registration in <a data-link-type="biblio" href="#biblio-payment-method-id">[payment-method-id]</a></span><a class="self-link" href="#sctn-registration-in-payment-method-id"></a></h4>
   <p>Add the following to the <a data-link-type="dfn" href="https://w3c.github.io/payment-method-id/#registry" id="ref-for-registry">registry of standardized payment methods</a> in <a data-link-type="biblio" href="#biblio-payment-method-id">[payment-method-id]</a>:</p>
   <dl>
    <dt data-md>"<a data-link-type="dfn" href="#secure-payment-confirmation" id="ref-for-secure-payment-confirmation②">secure-payment-confirmation</a>"
    <dd data-md>
     <p>The <a href="https://w3c.github.io/secure-payment-confirmation/">Secure Payment Confirmation</a> specification.</p>
   </dl>
   <h4 class="heading settled" data-level="4.1.3" id="sctn-securepaymentconfirmationrequest-dictionary"><span class="secno">4.1.3. </span><span class="content"><dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-securepaymentconfirmationrequest"><code>SecurePaymentConfirmationRequest</code></dfn> Dictionary</span><a class="self-link" href="#sctn-securepaymentconfirmationrequest-dictionary"></a></h4>
<pre class="idl highlight def"><c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="#dictdef-securepaymentconfirmationrequest" id="ref-for-dictdef-securepaymentconfirmationrequest"><c- g>SecurePaymentConfirmationRequest</c-></a> {
    <c- b>required</c-> <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#BufferSource" id="ref-for-BufferSource"><c- n>BufferSource</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="BufferSource " href="#dom-securepaymentconfirmationrequest-challenge" id="ref-for-dom-securepaymentconfirmationrequest-challenge"><c- g>challenge</c-></a>;
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-securepaymentconfirmationrequest-rpid" id="ref-for-dom-securepaymentconfirmationrequest-rpid"><c- g>rpId</c-></a>;
    <c- b>required</c-> <a data-link-type="dfn" href="https://heycam.github.io/webidl/#idl-sequence" id="ref-for-idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="https://heycam.github.io/webidl/#BufferSource" id="ref-for-BufferSource①"><c- n>BufferSource</c-></a>> <a class="idl-code" data-link-type="dict-member" data-type="sequence<BufferSource> " href="#dom-securepaymentconfirmationrequest-credentialids" id="ref-for-dom-securepaymentconfirmationrequest-credentialids"><c- g>credentialIds</c-></a>;
    <c- b>required</c-> <a data-link-type="idl-name" href="#dictdef-paymentcredentialinstrument" id="ref-for-dictdef-paymentcredentialinstrument"><c- n>PaymentCredentialInstrument</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCredentialInstrument " href="#dom-securepaymentconfirmationrequest-instrument" id="ref-for-dom-securepaymentconfirmationrequest-instrument"><c- g>instrument</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-long" id="ref-for-idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="unsigned long " href="#dom-securepaymentconfirmationrequest-timeout" id="ref-for-dom-securepaymentconfirmationrequest-timeout"><c- g>timeout</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString①"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-securepaymentconfirmationrequest-payeename" id="ref-for-dom-securepaymentconfirmationrequest-payeename"><c- g>payeeName</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString②"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin"><c- g>payeeOrigin</c-></a>;
    <a data-link-type="idl-name" href="https://w3c.github.io/webauthn/#dictdef-authenticationextensionsclientinputs" id="ref-for-dictdef-authenticationextensionsclientinputs"><c- n>AuthenticationExtensionsClientInputs</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="AuthenticationExtensionsClientInputs " href="#dom-securepaymentconfirmationrequest-extensions" id="ref-for-dom-securepaymentconfirmationrequest-extensions"><c- g>extensions</c-></a>;
    <a data-link-type="dfn" href="https://heycam.github.io/webidl/#idl-sequence" id="ref-for-idl-sequence①"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString③"><c- b>USVString</c-></a>> <a class="idl-code" data-link-type="dict-member" data-type="sequence<USVString> " href="#dom-securepaymentconfirmationrequest-locale" id="ref-for-dom-securepaymentconfirmationrequest-locale"><c- g>locale</c-></a>;
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#dictdef-securepaymentconfirmationrequest" id="ref-for-dictdef-securepaymentconfirmationrequest①">SecurePaymentConfirmationRequest</a></code> dictionary contains the following
members:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="SecurePaymentConfirmationRequest" data-dfn-type="dict-member" data-export id="dom-securepaymentconfirmationrequest-challenge"><code>challenge</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#BufferSource" id="ref-for-BufferSource②">BufferSource</a></span>
    <dd data-md>
     <p>A random challenge that the relying party generates on the server side
to prevent replay attacks.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="SecurePaymentConfirmationRequest" data-dfn-type="dict-member" data-export id="dom-securepaymentconfirmationrequest-rpid"><code>rpId</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString④">USVString</a></span>
    <dd data-md>
     <p>The <span spec-section="#relying-party-identifier">Relying Party Identifier</span> of
the credentials.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="SecurePaymentConfirmationRequest" data-dfn-type="dict-member" data-export id="dom-securepaymentconfirmationrequest-credentialids"><code>credentialIds</code></dfn> member, <span> of type sequence&lt;<a data-link-type="idl-name" href="https://heycam.github.io/webidl/#BufferSource" id="ref-for-BufferSource③">BufferSource</a>></span>
    <dd data-md>
     <p>The list of credential identifiers for the given instrument.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="SecurePaymentConfirmationRequest" data-dfn-type="dict-member" data-export id="dom-securepaymentconfirmationrequest-instrument"><code>instrument</code></dfn> member, <span> of type <a data-link-type="idl-name" href="#dictdef-paymentcredentialinstrument" id="ref-for-dictdef-paymentcredentialinstrument①">PaymentCredentialInstrument</a></span>
    <dd data-md>
     <p>The description of the instrument name and icon to display during
registration and to be signed along with the transaction details.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="SecurePaymentConfirmationRequest" data-dfn-type="dict-member" data-export id="dom-securepaymentconfirmationrequest-timeout"><code>timeout</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-unsigned-long" id="ref-for-idl-unsigned-long①">unsigned long</a></span>
    <dd data-md>
     <p>The number of milliseconds before the request to sign the transaction
details times out. At most 1 hour.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="SecurePaymentConfirmationRequest" data-dfn-type="dict-member" data-export id="dom-securepaymentconfirmationrequest-payeename"><code>payeeName</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString⑤">USVString</a></span>
    <dd data-md>
     <p>The display name of the payee that this SPC call is for (e.g., the
merchant). Optional, may be provided alongside or instead of <code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin①">payeeOrigin</a></code>.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="SecurePaymentConfirmationRequest" data-dfn-type="dict-member" data-export id="dom-securepaymentconfirmationrequest-payeeorigin"><code>payeeOrigin</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString⑥">USVString</a></span>
    <dd data-md>
     <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin" id="ref-for-concept-origin">origin</a> of the payee that this SPC call is for (e.g., the
merchant). Optional, may be provided alongside or instead of <code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeename" id="ref-for-dom-securepaymentconfirmationrequest-payeename①">payeeName</a></code>.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="SecurePaymentConfirmationRequest" data-dfn-type="dict-member" data-export id="dom-securepaymentconfirmationrequest-extensions"><code>extensions</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://w3c.github.io/webauthn/#dictdef-authenticationextensionsclientinputs" id="ref-for-dictdef-authenticationextensionsclientinputs①">AuthenticationExtensionsClientInputs</a></span>
    <dd data-md>
     <p>Any <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#webauthn-extensions" id="ref-for-webauthn-extensions②">WebAuthn extensions</a> that should be used for the passed
credential(s). The caller does not need to specify the <a href="#sctn-payment-extension-registration"> payment extension</a>; it is added
automatically.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="SecurePaymentConfirmationRequest" data-dfn-type="dict-member" data-export id="dom-securepaymentconfirmationrequest-locale"><code>locale</code></dfn> member, <span> of type sequence&lt;<a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString⑦">USVString</a>></span>
    <dd data-md>
     <p>An optional list of well-formed <a data-link-type="biblio" href="#biblio-bcp47">[BCP47]</a> language tags, in descending
order of priority, that identify the <a data-link-type="dfn" href="https://w3c.github.io/i18n-glossary/#locale" id="ref-for-locale">locale</a> preferences of the
website, i.e. a <a data-link-type="dfn" href="https://w3c.github.io/i18n-glossary/#language-priority-list" id="ref-for-language-priority-list">language priority list</a> <a data-link-type="biblio" href="#biblio-rfc4647">[RFC4647]</a>, which the user
agent can use to perform <a data-link-type="dfn" href="https://w3c.github.io/i18n-glossary/#language-negotiation" id="ref-for-language-negotiation">language negotiation</a> and locale-affected
formatting with the caller.</p>
     <p class="note" role="note"><span>NOTE:</span> The <code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-locale" id="ref-for-dom-securepaymentconfirmationrequest-locale①">locale</a></code> is distinct from
      language or direction metadata associated with specific input
      members, in that it represents the caller’s requested localized
      experience rather than assertion about a specific string value.</p>
   </dl>
   <h4 class="heading settled" data-level="4.1.4" id="sctn-payment-method-additional-data-type"><span class="secno">4.1.4. </span><span class="content">Payment Method additional data type</span><a class="self-link" href="#sctn-payment-method-additional-data-type"></a></h4>
   <p>The <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-additional-data-type" id="ref-for-dfn-additional-data-type">payment method additional data type</a> for this payment method is <code class="idl"><a data-link-type="idl" href="#dictdef-securepaymentconfirmationrequest" id="ref-for-dictdef-securepaymentconfirmationrequest②">SecurePaymentConfirmationRequest</a></code>.</p>
   <h4 class="heading settled" data-level="4.1.5" id="sctn-steps-to-validate-payment-method-data"><span class="secno">4.1.5. </span><span class="content">Steps to validate payment method data</span><a class="self-link" href="#sctn-steps-to-validate-payment-method-data"></a></h4>
   <p>The <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-steps-to-validate-payment-method-data" id="ref-for-dfn-steps-to-validate-payment-method-data">steps to validate payment method data</a> for this payment method, for an
input <code class="idl"><a data-link-type="idl" href="#dictdef-securepaymentconfirmationrequest" id="ref-for-dictdef-securepaymentconfirmationrequest③">SecurePaymentConfirmationRequest</a></code> <var>data</var>, are:</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list"></ul>
   </details>
   <ol>
    <li data-md>
     <p>If <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-credentialids" id="ref-for-dom-securepaymentconfirmationrequest-credentialids①">credentialIds</a></code>"] is empty,
throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#exceptiondef-rangeerror" id="ref-for-exceptiondef-rangeerror">RangeError</a></code>.</p>
    <li data-md>
     <p>For each <var>id</var> in <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-credentialids" id="ref-for-dom-securepaymentconfirmationrequest-credentialids②">credentialIds</a></code>"]:</p>
     <ol>
      <li data-md>
       <p>If <var>id</var> is empty, throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#exceptiondef-rangeerror" id="ref-for-exceptiondef-rangeerror①">RangeError</a></code>.</p>
     </ol>
    <li data-md>
     <p>If <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-challenge" id="ref-for-dom-securepaymentconfirmationrequest-challenge①">challenge</a></code>"] is null or
empty, throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror">TypeError</a></code>.</p>
    <li data-md>
     <p>If <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-instrument" id="ref-for-dom-securepaymentconfirmationrequest-instrument①">instrument</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-displayname" id="ref-for-dom-paymentcredentialinstrument-displayname">displayName</a></code>"]
is empty, throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror①">TypeError</a></code>.</p>
    <li data-md>
     <p>If <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-instrument" id="ref-for-dom-securepaymentconfirmationrequest-instrument②">instrument</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-icon" id="ref-for-dom-paymentcredentialinstrument-icon">icon</a></code>"]
is empty, throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror②">TypeError</a></code>.</p>
    <li data-md>
     <p>Run the URL parser on data["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-instrument" id="ref-for-dom-securepaymentconfirmationrequest-instrument③">instrument</a></code>"]
["<code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-icon" id="ref-for-dom-paymentcredentialinstrument-icon①">icon</a></code>"]. If this returns failure, throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror③">TypeError</a></code>.</p>
    <li data-md>
     <p>If <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-rpid" id="ref-for-dom-securepaymentconfirmationrequest-rpid①">rpId</a></code>"] is not a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#valid-domain" id="ref-for-valid-domain">valid domain</a>, throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror④">TypeError</a></code>.</p>
    <li data-md>
     <p>If both <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeename" id="ref-for-dom-securepaymentconfirmationrequest-payeename②">payeeName</a></code>"] and <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin②">payeeOrigin</a></code>"] are omitted,
throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑤">TypeError</a></code>.</p>
    <li data-md>
     <p>If either of <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeename" id="ref-for-dom-securepaymentconfirmationrequest-payeename③">payeeName</a></code>"] or <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin③">payeeOrigin</a></code>"] is present and
empty, throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑥">TypeError</a></code>.</p>
    <li data-md>
     <p>If <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin④">payeeOrigin</a></code>"] is present:</p>
     <ol>
      <li data-md>
       <p>Let <var>parsedURL</var> be the result of running the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser">URL parser</a> on <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin⑤">payeeOrigin</a></code>"].</p>
      <li data-md>
       <p>If <var>parsedURL</var> is failure, then throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑦">TypeError</a></code>.</p>
      <li data-md>
       <p>If <var>parsedURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme">scheme</a> is not "<code>https</code>", then throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑧">TypeError</a></code>.</p>
     </ol>
   </ol>
   <h4 class="heading settled" data-level="4.1.6" id="sctn-steps-to-check-if-a-payment-can-be-made"><span class="secno">4.1.6. </span><span class="content">Steps to check if a payment can be made</span><a class="self-link" href="#sctn-steps-to-check-if-a-payment-can-be-made"></a></h4>
   <p>The <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-steps-to-check-if-a-payment-can-be-made" id="ref-for-dfn-steps-to-check-if-a-payment-can-be-made">steps to check if a payment can be made</a> for this payment method, for an
input <code class="idl"><a data-link-type="idl" href="#dictdef-securepaymentconfirmationrequest" id="ref-for-dictdef-securepaymentconfirmationrequest④">SecurePaymentConfirmationRequest</a></code> <var>data</var>, are:</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list"></ul>
   </details>
   <ol>
    <li data-md>
     <p>If <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin⑥">payeeOrigin</a></code>"] is present:</p>
     <ol>
      <li data-md>
       <p>Let <var>parsedURL</var> be the result of running the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser①">URL parser</a> on <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin⑦">payeeOrigin</a></code>"].</p>
      <li data-md>
       <p>Assert that <var>parsedURL</var> is not failure.</p>
      <li data-md>
       <p>Assert that <var>parsedURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme①">scheme</a> is "<code>https</code>".</p>
     </ol>
     <p class="note" role="note"><span>NOTE:</span> These pre-conditions were previously checked in the <a href="#sctn-steps-to-validate-payment-method-data">steps to validate payment
   method data</a>.</p>
     <ol>
      <li data-md>
       <p>Set <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin⑧">payeeOrigin</a></code>"] to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/origin.html#ascii-serialisation-of-an-origin" id="ref-for-ascii-serialisation-of-an-origin">serialization of</a> <var>parsedURL</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin">origin</a>.</p>
     </ol>
    <li data-md>
     <p><a data-link-type="dfn" href="https://www.w3.org/TR/image-resource/#dfn-fetching-an-image-resource" id="ref-for-dfn-fetching-an-image-resource">Fetch the image resource</a> for the icon, passing «["<code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/image-resource/#dom-imageresource-src" id="ref-for-dom-imageresource-src">src</a></code>" → <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-instrument" id="ref-for-dom-securepaymentconfirmationrequest-instrument④">instrument</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-icon" id="ref-for-dom-paymentcredentialinstrument-icon②">icon</a></code>"]]»
for <em>image</em>. If this fails:</p>
     <ol>
      <li data-md>
       <p>If <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-instrument" id="ref-for-dom-securepaymentconfirmationrequest-instrument⑤">instrument</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-iconmustbeshown" id="ref-for-dom-paymentcredentialinstrument-iconmustbeshown">iconMustBeShown</a></code>"]
is <code>true</code>, then return <code>false</code>.</p>
      <li data-md>
       <p>Otherwise, set <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-instrument" id="ref-for-dom-securepaymentconfirmationrequest-instrument⑥">instrument</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-icon" id="ref-for-dom-paymentcredentialinstrument-icon③">icon</a></code>"]
to an empty string.</p>
       <p class="note" role="note"><span>Note:</span> This lets the RP know that the specified icon was not shown, as the output <code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-instrument" id="ref-for-dom-collectedclientadditionalpaymentdata-instrument">instrument</a></code> will have an empty icon
string.</p>
     </ol>
     <p class="note" role="note"><span>Note:</span> The image resource must be fetched whether or not any credential
matches, to defeat attempts to <a href="#sctn-privacy-probing-credential-ids">probe
for credential existence</a>.</p>
    <li data-md>
     <p>For each <var>id</var> in <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-credentialids" id="ref-for-dom-securepaymentconfirmationrequest-credentialids③">credentialIds</a></code>"]:</p>
     <ol>
      <li data-md>
       <p>Run the <a data-link-type="dfn" href="#steps-to-silently-determine-if-a-credential-is-available-for-the-current-device" id="ref-for-steps-to-silently-determine-if-a-credential-is-available-for-the-current-device">steps to silently determine if a credential is available for
the current device</a> and the <a data-link-type="dfn" href="#steps-to-silently-determine-if-a-credential-is-spc-enabled" id="ref-for-steps-to-silently-determine-if-a-credential-is-spc-enabled">steps to silently determine if a
credential is SPC-enabled</a>, passing in <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-rpid" id="ref-for-dom-securepaymentconfirmationrequest-rpid②">rpId</a></code>"] and <var>id</var>. If the
result of either of these is <code>false</code>, remove <var>id</var> from <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-credentialids" id="ref-for-dom-securepaymentconfirmationrequest-credentialids④">credentialIds</a></code>"].</p>
     </ol>
    <li data-md>
     <p>If <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-credentialids" id="ref-for-dom-securepaymentconfirmationrequest-credentialids⑤">credentialIds</a></code>"] is now empty,
return <code>false</code>. The user agent must maintain <a href="#sctn-privacy-probing-credential-ids">authentication ceremony privacy</a> and not leak this lack of matching credentials to the caller, by:</p>
     <ol>
      <li data-md>
       <p>Not allowing the caller to perform a timing attack on this outcome versus
the user declining to authenticate on the <a href="#sctn-transaction-confirmation-ux">transaction confirmation UX</a>, e.g.,
by presenting an alternative interstitial that the user must interact
with.</p>
      <li data-md>
       <p>Rejecting the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/payment-request/#dom-paymentrequest-show" id="ref-for-dom-paymentrequest-show">show()</a></code> promise with a
"<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#notallowederror" id="ref-for-notallowederror">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>.</p>
     </ol>
    <li data-md>
     <p>Return <code>true</code>.</p>
   </ol>
   <h4 class="heading settled" data-level="4.1.7" id="sctn-transaction-confirmation-ux"><span class="secno">4.1.7. </span><span class="content">Displaying a transaction confirmation UX</span><a class="self-link" href="#sctn-transaction-confirmation-ux"></a></h4>
   <p>To avoid restricting User Agent implementation choice, this specification does
not require a User Agent to display a particular user interface when <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/payment-request/#dom-paymentrequest-show" id="ref-for-dom-paymentrequest-show①">PaymentRequest.show()</a></code> is called and the <a data-link-type="dfn" href="#secure-payment-confirmation-payment-handler" id="ref-for-secure-payment-confirmation-payment-handler①">Secure
Payment Confirmation payment handler</a> is selected. However, so that a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①⑥">Relying Party</a> can trust the information included in <code class="idl"><a data-link-type="idl" href="#dictdef-collectedclientpaymentdata" id="ref-for-dictdef-collectedclientpaymentdata">CollectedClientPaymentData</a></code>, the User Agent MUST ensure that the following
is communicated to the user and that the user’s consent is collected for the
authentication:</p>
   <ul>
    <li data-md>
     <p>The <code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-payeename" id="ref-for-dom-collectedclientadditionalpaymentdata-payeename">payeeName</a></code> if it is present.</p>
    <li data-md>
     <p>The <code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-payeeorigin" id="ref-for-dom-collectedclientadditionalpaymentdata-payeeorigin">payeeOrigin</a></code> if it is present.</p>
    <li data-md>
     <p>The <code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-total" id="ref-for-dom-collectedclientadditionalpaymentdata-total">total</a></code>, that is the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount-currency" id="ref-for-dom-paymentcurrencyamount-currency">currency</a></code> and <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount-value" id="ref-for-dom-paymentcurrencyamount-value">value</a></code> of the
transaction.</p>
    <li data-md>
     <p>The <code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-instrument" id="ref-for-dom-collectedclientadditionalpaymentdata-instrument①">instrument</a></code> details, that is the
payment instrument <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-displayname" id="ref-for-dom-paymentcredentialinstrument-displayname①">displayName</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-icon" id="ref-for-dom-paymentcredentialinstrument-icon④">icon</a></code>. If an image resource could not be
fetched or decoded from the input <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-icon" id="ref-for-dom-paymentcredentialinstrument-icon⑤">icon</a></code>,
then the User Agent may show no icon or a generic payment instrument
icon in its place.</p>
     <p class="note" role="note"><span>NOTE:</span> If the specified icon could not be fetched or decoded, then <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-iconmustbeshown" id="ref-for-dom-paymentcredentialinstrument-iconmustbeshown①">iconMustBeShown</a></code> must be <code>false</code> here as
otherwise the <a href="#sctn-steps-to-check-if-a-payment-can-be-made">the steps
to check if a payment can be made</a> would have failed previously.</p>
   </ul>
   <p>The user agent MAY utilize the information in <code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-locale" id="ref-for-dom-securepaymentconfirmationrequest-locale②">locale</a></code>, if any, to display a UX localized
into a language and using locale-based formatting consistent with that of the
website.</p>
   <p>If the <a data-link-type="dfn" href="#current-transaction-automation-mode" id="ref-for-current-transaction-automation-mode">current transaction automation mode</a> is not
"<code class="idl"><a data-link-type="idl" href="#dom-transactionautomationmode-none" id="ref-for-dom-transactionautomationmode-none">none</a></code>", the user agent should first verify that
it is in an automation context (see <a href="https://w3c.github.io/webdriver/#security">WebDriver’s Security
considerations</a>). The user agent should then bypass the above communication of
information and gathering of user consent, and instead do the following based
on the value of the <a data-link-type="dfn" href="#current-transaction-automation-mode" id="ref-for-current-transaction-automation-mode①">current transaction automation mode</a>:</p>
   <dl>
    <dt data-md>"<code class="idl"><a data-link-type="idl" href="#dom-transactionautomationmode-autoaccept" id="ref-for-dom-transactionautomationmode-autoaccept">autoaccept</a></code>"
    <dd data-md>
     <p>Act as if the user has seen the transaction details and accepted
the authentication.</p>
    <dt data-md>"<code class="idl"><a data-link-type="idl" href="#dom-transactionautomationmode-autoreject" id="ref-for-dom-transactionautomationmode-autoreject">autoreject</a></code>"
    <dd data-md>
     <p>Act as if the user has seen the transaction details and rejected
the authentication.</p>
   </dl>
   <h4 class="heading settled" data-level="4.1.8" id="sctn-steps-to-respond-to-a-payment-request"><span class="secno">4.1.8. </span><span class="content">Steps to respond to a payment request</span><a class="self-link" href="#sctn-steps-to-respond-to-a-payment-request"></a></h4>
   <p>The <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-steps-to-respond-to-a-payment-request" id="ref-for-dfn-steps-to-respond-to-a-payment-request">steps to respond to a payment request</a> for this payment method, for a given <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/payment-request/#dom-paymentrequest" id="ref-for-dom-paymentrequest①">PaymentRequest</a></code> <var>request</var> and <code class="idl"><a data-link-type="idl" href="#dictdef-securepaymentconfirmationrequest" id="ref-for-dictdef-securepaymentconfirmationrequest⑤">SecurePaymentConfirmationRequest</a></code> <var>data</var>, are:</p>
   <ol>
    <li data-md>
     <p>Let <var>topOrigin</var> be the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin" id="ref-for-concept-environment-top-level-origin">top-level origin</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object">relevant settings object</a> of <var>request</var>.</p>
    <li data-md>
     <p>Let <var>payment</var> be a new a <code class="idl"><a data-link-type="idl" href="#dictdef-authenticationextensionspaymentinputs" id="ref-for-dictdef-authenticationextensionspaymentinputs">AuthenticationExtensionsPaymentInputs</a></code> dictionary,
whose fields are:</p>
     <dl>
      <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-ispayment" id="ref-for-dom-authenticationextensionspaymentinputs-ispayment">isPayment</a></code>
      <dd data-md>
       <p>The boolean value <code>true</code>.</p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-rpid" id="ref-for-dom-authenticationextensionspaymentinputs-rpid">rpId</a></code>
      <dd data-md>
       <p><var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-rpid" id="ref-for-dom-securepaymentconfirmationrequest-rpid③">rpId</a></code>"]</p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-toporigin" id="ref-for-dom-authenticationextensionspaymentinputs-toporigin">topOrigin</a></code>
      <dd data-md>
       <p><var>topOrigin</var></p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-payeename" id="ref-for-dom-authenticationextensionspaymentinputs-payeename">payeeName</a></code>
      <dd data-md>
       <p><var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeename" id="ref-for-dom-securepaymentconfirmationrequest-payeename④">payeeName</a></code>"] if it is
present, otherwise omitted.</p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-payeeorigin" id="ref-for-dom-authenticationextensionspaymentinputs-payeeorigin">payeeOrigin</a></code>
      <dd data-md>
       <p><var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-payeeorigin" id="ref-for-dom-securepaymentconfirmationrequest-payeeorigin⑨">payeeOrigin</a></code>"] if it is
present, otherwise omitted.</p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-total" id="ref-for-dom-authenticationextensionspaymentinputs-total">total</a></code>
      <dd data-md>
       <p><var>request</var>.<a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-details" id="ref-for-dfn-details">[[details]]</a>["<code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/payment-request/#dom-paymentdetailsinit-total" id="ref-for-dom-paymentdetailsinit-total">total</a></code>"]</p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-instrument" id="ref-for-dom-authenticationextensionspaymentinputs-instrument">instrument</a></code>
      <dd data-md>
       <p><var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-instrument" id="ref-for-dom-securepaymentconfirmationrequest-instrument⑦">instrument</a></code>"]</p>
     </dl>
    <li data-md>
     <p>Let <var>extensions</var> be a new <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-authenticationextensionsclientinputs" id="ref-for-dictdef-authenticationextensionsclientinputs②">AuthenticationExtensionsClientInputs</a></code> dictionary
whose <code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionsclientinputs-payment" id="ref-for-dom-authenticationextensionsclientinputs-payment①">payment</a></code> member is set to <var>payment</var>, and whose other members are set from <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-extensions" id="ref-for-dom-securepaymentconfirmationrequest-extensions①">extensions</a></code>"].</p>
    <li data-md>
     <p>Let <var>publicKeyOpts</var> be a new <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-publickeycredentialrequestoptions" id="ref-for-dictdef-publickeycredentialrequestoptions">PublicKeyCredentialRequestOptions</a></code> dictionary, whose fields are:</p>
     <dl>
      <dt data-md><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-challenge" id="ref-for-dom-publickeycredentialrequestoptions-challenge①">challenge</a></code>
      <dd data-md>
       <p><var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-challenge" id="ref-for-dom-securepaymentconfirmationrequest-challenge②">challenge</a></code>"]</p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-timeout" id="ref-for-dom-publickeycredentialrequestoptions-timeout">timeout</a></code>
      <dd data-md>
       <p><var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-timeout" id="ref-for-dom-securepaymentconfirmationrequest-timeout①">timeout</a></code>"]</p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-rpid" id="ref-for-dom-publickeycredentialrequestoptions-rpid">rpId</a></code>
      <dd data-md>
       <p><var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-rpid" id="ref-for-dom-securepaymentconfirmationrequest-rpid④">rpId</a></code>"]</p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-userverification" id="ref-for-dom-publickeycredentialrequestoptions-userverification">userVerification</a></code>
      <dd data-md>
       <p><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-userverificationrequirement-required" id="ref-for-dom-userverificationrequirement-required">required</a></code></p>
      <dt data-md><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-extensions" id="ref-for-dom-publickeycredentialrequestoptions-extensions">extensions</a></code>
      <dd data-md>
       <p><var>extensions</var></p>
     </dl>
     <p class="note" role="note"><span>Note:</span> This algorithm hard-codes "required" as the value for <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-userverification" id="ref-for-dom-publickeycredentialrequestoptions-userverification①">userVerification</a></code>, because that is what Chrome’s initial implementation supports. The current limitations may change. The Working Group invites implementers to share use cases that would benefit from support for other values (e.g., "preferred" or "discouraged").</p>
    <li data-md>
     <p>For each <var>id</var> in <var>data</var>["<code class="idl"><a data-link-type="idl" href="#dom-securepaymentconfirmationrequest-credentialids" id="ref-for-dom-securepaymentconfirmationrequest-credentialids⑥">credentialIds</a></code>"]:</p>
     <ol>
      <li data-md>
       <p>Let <var>descriptor</var> be a new <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-publickeycredentialdescriptor" id="ref-for-dictdef-publickeycredentialdescriptor">PublicKeyCredentialDescriptor</a></code> dictionary,
whose fields are:</p>
       <dl>
        <dt data-md><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-type" id="ref-for-dom-publickeycredentialdescriptor-type">type</a></code>
        <dd data-md>
         <p><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialtype-public-key" id="ref-for-dom-publickeycredentialtype-public-key">public-key</a></code></p>
        <dt data-md><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-id" id="ref-for-dom-publickeycredentialdescriptor-id">id</a></code>
        <dd data-md>
         <p><var>id</var></p>
        <dt data-md><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-transports" id="ref-for-dom-publickeycredentialdescriptor-transports">transports</a></code>
        <dd data-md>
         <p>A sequence of length 1 whose only member is <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-authenticatortransport-internal" id="ref-for-dom-authenticatortransport-internal">internal</a></code>.</p>
       </dl>
      <li data-md>
       <p><a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-append" id="ref-for-list-append">Append</a> <var>descriptor</var> to <var>publicKeyOpts</var>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials" id="ref-for-dom-publickeycredentialrequestoptions-allowcredentials">allowCredentials</a></code>"].</p>
     </ol>
    <li data-md>
     <p>Let <var>outputCredential</var> be the result of running the algorithm to <a data-link-type="dfn" href="https://w3c.github.io/webappsec-credential-management/#abstract-opdef-request-a-credential" id="ref-for-abstract-opdef-request-a-credential">Request a Credential</a>, passing «["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-credentialrequestoptions-publickey" id="ref-for-dom-credentialrequestoptions-publickey">publicKey</a></code>"
→ <var>publicKeyOpts</var>]».</p>
     <p class="note" role="note"><span>Note:</span> Chrome’s initial implementation does not pass the full <code>data.credentialIds</code> list to <a data-link-type="dfn" href="https://w3c.github.io/webappsec-credential-management/#abstract-opdef-request-a-credential" id="ref-for-abstract-opdef-request-a-credential①">Request a Credential</a>. Instead, it chooses one credential in the list that matches the current device and passes only that in.</p>
     <p class="note" role="note"><span>Note:</span> This triggers <span>[webauthn-3]</span>'s <span spec-section="#sctn-getAssertion">Get</span> behavior</p>
    <li data-md>
     <p>Return <var>outputCredential</var>.</p>
   </ol>
   <h2 class="heading settled" data-level="5" id="sctn-payment-extension-registration"><span class="secno">5. </span><span class="content">WebAuthn Extension - "<code>payment</code>"</span><a class="self-link" href="#sctn-payment-extension-registration"></a></h2>
   <p>This <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#client-extension" id="ref-for-client-extension">client</a> <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#registration-extension" id="ref-for-registration-extension">registration extension</a> and <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#authentication-extension" id="ref-for-authentication-extension">authentication extension</a> indicates that a credential is either being
created for or used for Secure Payment Confirmation, respectively.</p>
   <p>For registration, this extension relaxes the WebAuthn requirements to allow
credential creation in a cross-origin iframe, and also allows the browser to
identify and cache Secure Payment Confirmation credentials. For authentication,
this extension allows a third-party to perform an authentication ceremony on
behalf of the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①⑦">Relying Party</a>, and also adds transaction information to the
signed cryptogram.</p>
   <p>Notably, a website should not call <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-get" id="ref-for-dom-credentialscontainer-get">navigator.credentials.get()</a></code> with this extension
directly; for authentication the extension can only be accessed via <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/payment-request/#dom-paymentrequest" id="ref-for-dom-paymentrequest②">PaymentRequest</a></code> with a "<a data-link-type="dfn" href="#secure-payment-confirmation" id="ref-for-secure-payment-confirmation③">secure-payment-confirmation</a>" payment method.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <p>This test does not directly correspond to a spec line, but instead
            tests that authentication can be triggered from inside a
            cross-origin iframe. That behavior is specified by the lack of any
            line forbidding it.</p>
    <ul class="wpt-tests-list"></ul>
    <hr>
   </details>
   <dl>
    <dt data-md>Extension identifier
    <dd data-md>
     <p><code>payment</code></p>
    <dt data-md>Operation applicability
    <dd data-md>
     <p><a data-link-type="dfn" href="https://w3c.github.io/webauthn/#registration-extension" id="ref-for-registration-extension①">Registration</a> and <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#authentication-extension" id="ref-for-authentication-extension①">authentication</a></p>
    <dt data-md>Client extension input
    <dd data-md>
<pre class="idl highlight def"><c- b>partial</c-> <c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="https://w3c.github.io/webauthn/#dictdef-authenticationextensionsclientinputs" id="ref-for-dictdef-authenticationextensionsclientinputs③"><c- g>AuthenticationExtensionsClientInputs</c-></a> {
  <a data-link-type="idl-name" href="#dictdef-authenticationextensionspaymentinputs" id="ref-for-dictdef-authenticationextensionspaymentinputs①"><c- n>AuthenticationExtensionsPaymentInputs</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="AuthenticationExtensionsClientInputs" data-dfn-type="dict-member" data-export data-type="AuthenticationExtensionsPaymentInputs " id="dom-authenticationextensionsclientinputs-payment"><code><c- g>payment</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-authenticationextensionspaymentinputs"><code><c- g>AuthenticationExtensionsPaymentInputs</c-></code></dfn> {
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="boolean " href="#dom-authenticationextensionspaymentinputs-ispayment" id="ref-for-dom-authenticationextensionspaymentinputs-ispayment①"><c- g>isPayment</c-></a>;

  // Only used for authentication.
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString⑧"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-authenticationextensionspaymentinputs-rpid" id="ref-for-dom-authenticationextensionspaymentinputs-rpid①"><c- g>rpId</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString⑨"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-authenticationextensionspaymentinputs-toporigin" id="ref-for-dom-authenticationextensionspaymentinputs-toporigin①"><c- g>topOrigin</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString①⓪"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-authenticationextensionspaymentinputs-payeename" id="ref-for-dom-authenticationextensionspaymentinputs-payeename①"><c- g>payeeName</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString①①"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-authenticationextensionspaymentinputs-payeeorigin" id="ref-for-dom-authenticationextensionspaymentinputs-payeeorigin①"><c- g>payeeOrigin</c-></a>;
  <a data-link-type="idl-name" href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount" id="ref-for-dom-paymentcurrencyamount"><c- n>PaymentCurrencyAmount</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCurrencyAmount " href="#dom-authenticationextensionspaymentinputs-total" id="ref-for-dom-authenticationextensionspaymentinputs-total①"><c- g>total</c-></a>;
  <a data-link-type="idl-name" href="#dictdef-paymentcredentialinstrument" id="ref-for-dictdef-paymentcredentialinstrument②"><c- n>PaymentCredentialInstrument</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCredentialInstrument " href="#dom-authenticationextensionspaymentinputs-instrument" id="ref-for-dom-authenticationextensionspaymentinputs-instrument①"><c- g>instrument</c-></a>;
};
</pre>
     <dl>
      <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="AuthenticationExtensionsPaymentInputs" data-dfn-type="dict-member" data-export id="dom-authenticationextensionspaymentinputs-ispayment"><code>isPayment</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean①">boolean</a></span>
      <dd data-md>
       <p>Indicates that the extension is active.</p>
       <div class="note" role="note"><strong>TODO</strong>: Find a better way to do this. Needed currently because other members are auth-time only.</div>
      <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="AuthenticationExtensionsPaymentInputs" data-dfn-type="dict-member" data-export id="dom-authenticationextensionspaymentinputs-rpid"><code>rpId</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString①②">USVString</a></span>
      <dd data-md>
       <p>The <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①⑧">Relying Party</a> id of the credential(s) being used. Only used at authentication time; not registration.</p>
      <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="AuthenticationExtensionsPaymentInputs" data-dfn-type="dict-member" data-export id="dom-authenticationextensionspaymentinputs-toporigin"><code>topOrigin</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString①③">USVString</a></span>
      <dd data-md>
       <p>The origin of the top-level frame. Only used at authentication time; not registration.</p>
      <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="AuthenticationExtensionsPaymentInputs" data-dfn-type="dict-member" data-export id="dom-authenticationextensionspaymentinputs-payeename"><code>payeeName</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString①④">USVString</a></span>
      <dd data-md>
       <p>The payee name, if present, that was displayed to the user. Only used at authentication time; not registration.</p>
      <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="AuthenticationExtensionsPaymentInputs" data-dfn-type="dict-member" data-export id="dom-authenticationextensionspaymentinputs-payeeorigin"><code>payeeOrigin</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString①⑤">USVString</a></span>
      <dd data-md>
       <p>The payee origin, if present, that was displayed to the user. Only used at authentication time; not registration.</p>
      <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="AuthenticationExtensionsPaymentInputs" data-dfn-type="dict-member" data-export id="dom-authenticationextensionspaymentinputs-total"><code>total</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount" id="ref-for-dom-paymentcurrencyamount①">PaymentCurrencyAmount</a></span>
      <dd data-md>
       <p>The transaction amount that was displayed to the user. Only used at authentication time; not registration.</p>
      <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="AuthenticationExtensionsPaymentInputs" data-dfn-type="dict-member" data-export id="dom-authenticationextensionspaymentinputs-instrument"><code>instrument</code></dfn> member, <span> of type <a data-link-type="idl-name" href="#dictdef-paymentcredentialinstrument" id="ref-for-dictdef-paymentcredentialinstrument③">PaymentCredentialInstrument</a></span>
      <dd data-md>
       <p>The instrument details that were displayed to the user. Only used at authentication time; not registration.</p>
     </dl>
    <dt data-md><dfn data-dfn-type="dfn" data-export id="client-extension-processing-registration">Client extension processing (<a data-link-type="dfn" href="https://w3c.github.io/webauthn/#registration-extension" id="ref-for-registration-extension②">registration</a>)<a class="self-link" href="#client-extension-processing-registration"></a></dfn>
    <dd data-md>
     <p class="note" role="note"><span>Note:</span> Reading <span>[webauthn-3]</span> literally, these steps don’t work; extensions
are injected at step 12 of <code>[[Create]]</code> and cannot really modify anything.
However other extensions ignore that entirely and assume they can modify any
part of any WebAuthn algorithm!</p>
     <p>When <span spec-section="#sctn-createCredential">creating a new credential</span>:</p>
     <ol>
      <li data-md>
       <p>Modify step 2 (the check for <em>sameOriginWithAncestors</em>) as follows:</p>
       <ul>
        <li data-md>
         <p>If <em>sameOriginWithAncestors</em> is <code>false</code>:</p>
         <ul>
          <li data-md>
           <p>If the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global">relevant global object</a>, as determined by the calling <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-create" id="ref-for-dom-credentialscontainer-create①">create()</a></code> implementation, does not have <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" id="ref-for-transient-activation">transient activation</a>:</p>
           <ul>
            <li data-md>
             <p>Return a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code> whose name is "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#securityerror" id="ref-for-securityerror">SecurityError</a></code>", and
terminate this algorithm.</p>
           </ul>
          <li data-md>
           <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation" id="ref-for-consume-user-activation">Consume user activation</a> of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global" id="ref-for-concept-relevant-global①">relevant global object</a>.</p>
         </ul>
         <details class="wpt-tests-block" dir="ltr" lang="en">
          <summary>Tests</summary>
          <ul class="wpt-tests-list"></ul>
         </details>
       </ul>
       <p class="note" role="note"><span>Note:</span> This allows for creating SPC credentials in a cross-origin
 iframe, as long as the correct permission policy is set
 (see <a href="#sctn-permissions-policy">§ 7 Permissions Policy integration</a>). A <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" id="ref-for-transient-activation①">transient activation</a> is
 also required in this case to mitigate privacy risks; see <a href="#sctn-security-cross-origin-registration">§ 11.1 Registration in a Cross-Origin iframe</a>.</p>
      <li data-md>
       <p>After step 3, insert the following step:</p>
       <ul>
        <li data-md>
         <p>If any of the following are true:</p>
         <ul>
          <li data-md>
           <p><em>options</em>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-authenticatorselection" id="ref-for-dom-publickeycredentialcreationoptions-authenticatorselection">authenticatorSelection</a></code>"]["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-authenticatorattachment" id="ref-for-dom-authenticatorselectioncriteria-authenticatorattachment">authenticatorAttachment</a></code>"] is not "<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-authenticatorattachment-platform" id="ref-for-dom-authenticatorattachment-platform">platform</a></code>".</p>
          <li data-md>
           <p><em>options</em>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-authenticatorselection" id="ref-for-dom-publickeycredentialcreationoptions-authenticatorselection①">authenticatorSelection</a></code>"]["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-residentkey" id="ref-for-dom-authenticatorselectioncriteria-residentkey">residentKey</a></code>"] is not "<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-residentkeyrequirement-required" id="ref-for-dom-residentkeyrequirement-required">required</a></code>" or "<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-residentkeyrequirement-preferred" id="ref-for-dom-residentkeyrequirement-preferred">preferred</a></code>".</p>
          <li data-md>
           <p><em>options</em>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-authenticatorselection" id="ref-for-dom-publickeycredentialcreationoptions-authenticatorselection②">authenticatorSelection</a></code>"]["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-userverification" id="ref-for-dom-authenticatorselectioncriteria-userverification">userVerification</a></code>"] is not "<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-userverificationrequirement-required" id="ref-for-dom-userverificationrequirement-required①">required</a></code>".</p>
         </ul>
         <p>then return a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror⑨">TypeError</a></code>.</p>
         <p class="note" role="note"><span>Note:</span> These values are hard-coded as that is what Chrome’s initial implementation
supports. The current limitations may change. The Working Group invites implementers
to share use cases that would benefit from support for other values.</p>
         <details class="wpt-tests-block" dir="ltr" lang="en">
          <summary>Tests</summary>
          <ul class="wpt-tests-list"></ul>
         </details>
       </ul>
     </ol>
    <dt data-md><dfn data-dfn-type="dfn" data-export id="client-extension-processing-authentication">Client extension processing (<a data-link-type="dfn" href="https://w3c.github.io/webauthn/#authentication-extension" id="ref-for-authentication-extension②">authentication</a>)<a class="self-link" href="#client-extension-processing-authentication"></a></dfn>
    <dd data-md>
     <p>When <span spec-section="#sctn-getAssertion">making an assertion</span> with a <code class="idl"><a data-link-type="idl" href="#dictdef-authenticationextensionspaymentinputs" id="ref-for-dictdef-authenticationextensionspaymentinputs②">AuthenticationExtensionsPaymentInputs</a></code> <var>extension_inputs</var>:</p>
     <ol>
      <li data-md>
       <p>If not in a "<a data-link-type="dfn" href="#secure-payment-confirmation" id="ref-for-secure-payment-confirmation④">secure-payment-confirmation</a>" payment handler, return a
"<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#notallowederror" id="ref-for-notallowederror①">NotAllowedError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>.</p>
       <details class="wpt-tests-block" dir="ltr" lang="en">
        <summary>Tests</summary>
        <ul class="wpt-tests-list"></ul>
       </details>
       <p class="note" role="note"><span>Note:</span> This guards against websites trying to access the extended powers of
SPC without going through <a href="#sctn-transaction-confirmation-ux">the
transaction UX</a>.</p>
      <li data-md>
       <p>During <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredential-discoverfromexternalsource-slot" id="ref-for-dom-publickeycredential-discoverfromexternalsource-slot">[[DiscoverFromExternalSource]](origin, options, sameOriginWithAncestors)</a></code>:</p>
       <ol>
        <li data-md>
         <p>Skip step 6.1, which compares <em>options.rpId</em> to <em>effectiveDomain</em></p>
       </ol>
       <details class="wpt-tests-block" dir="ltr" lang="en">
        <summary>Tests</summary>
        <ul class="wpt-tests-list"></ul>
       </details>
       <p class="note" role="note"><span>Note:</span> This enables cross-domain authentication ceremonies; see <a href="#sctn-use-case-merchant-authentication">§ 1.1.3 Merchant control of authentication</a>.</p>
       <ol>
        <li data-md>
         <p>In step 9, instead of creating a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata" id="ref-for-dictdef-collectedclientdata①">CollectedClientData</a></code>, instead
create a <code class="idl"><a data-link-type="idl" href="#dictdef-collectedclientpaymentdata" id="ref-for-dictdef-collectedclientpaymentdata①">CollectedClientPaymentData</a></code> with:</p>
         <ol>
          <li data-md>
           <p><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-collectedclientdata-type" id="ref-for-dom-collectedclientdata-type">type</a></code> set to "<code>payment.get</code>"</p>
          <li data-md>
           <p><code class="idl"><a data-link-type="idl" href="#dom-collectedclientpaymentdata-payment" id="ref-for-dom-collectedclientpaymentdata-payment">payment</a></code> set to a new <code class="idl"><a data-link-type="idl" href="#dictdef-collectedclientadditionalpaymentdata" id="ref-for-dictdef-collectedclientadditionalpaymentdata">CollectedClientAdditionalPaymentData</a></code> whose fields are:</p>
           <dl>
            <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-rpid" id="ref-for-dom-collectedclientadditionalpaymentdata-rpid">rpId</a></code>
            <dd data-md>
             <p><var>extension_inputs</var>["<code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-rpid" id="ref-for-dom-authenticationextensionspaymentinputs-rpid②">rpId</a></code>"]</p>
            <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-toporigin" id="ref-for-dom-collectedclientadditionalpaymentdata-toporigin">topOrigin</a></code>
            <dd data-md>
             <p><var>extension_inputs</var>["<code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-toporigin" id="ref-for-dom-authenticationextensionspaymentinputs-toporigin②">topOrigin</a></code>"]</p>
            <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-payeename" id="ref-for-dom-collectedclientadditionalpaymentdata-payeename①">payeeName</a></code>
            <dd data-md>
             <p><var>extension_inputs</var>["<code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-payeename" id="ref-for-dom-authenticationextensionspaymentinputs-payeename②">payeeName</a></code>"]
if it is present, otherwise omitted.</p>
            <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-payeeorigin" id="ref-for-dom-collectedclientadditionalpaymentdata-payeeorigin①">payeeOrigin</a></code>
            <dd data-md>
             <p><var>extension_inputs</var>["<code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-payeeorigin" id="ref-for-dom-authenticationextensionspaymentinputs-payeeorigin②">payeeOrigin</a></code>"]
if it is present, otherwise omitted.</p>
            <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-total" id="ref-for-dom-collectedclientadditionalpaymentdata-total①">total</a></code>
            <dd data-md>
             <p><var>extension_inputs</var>["<code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-total" id="ref-for-dom-authenticationextensionspaymentinputs-total②">total</a></code>"]</p>
            <dt data-md><code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-instrument" id="ref-for-dom-collectedclientadditionalpaymentdata-instrument②">instrument</a></code>
            <dd data-md>
             <p><var>extension_inputs</var>["<code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionspaymentinputs-instrument" id="ref-for-dom-authenticationextensionspaymentinputs-instrument②">instrument</a></code>"]</p>
           </dl>
          <li data-md>
           <p>All other fields set as per the original step 9.</p>
         </ol>
         <details class="wpt-tests-block" dir="ltr" lang="en">
          <summary>Tests</summary>
          <ul class="wpt-tests-list"></ul>
         </details>
       </ol>
     </ol>
    <dt data-md>Client extension output
    <dd data-md>
     <p>None</p>
    <dt data-md>Authenticator extension processing
    <dd data-md>
     <p>None</p>
   </dl>
   <h3 class="heading settled" data-level="5.1" id="sctn-collectedclientpaymentdata-dictionary"><span class="secno">5.1. </span><span class="content"><dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-collectedclientpaymentdata"><code>CollectedClientPaymentData</code></dfn> Dictionary</span><a class="self-link" href="#sctn-collectedclientpaymentdata-dictionary"></a></h3>
<pre class="idl highlight def"><c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="#dictdef-collectedclientpaymentdata" id="ref-for-dictdef-collectedclientpaymentdata②"><c- g>CollectedClientPaymentData</c-></a> : <a data-link-type="idl-name" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata" id="ref-for-dictdef-collectedclientdata②"><c- n>CollectedClientData</c-></a> {
    <c- b>required</c-> <a data-link-type="idl-name" href="#dictdef-collectedclientadditionalpaymentdata" id="ref-for-dictdef-collectedclientadditionalpaymentdata①"><c- n>CollectedClientAdditionalPaymentData</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="CollectedClientAdditionalPaymentData " href="#dom-collectedclientpaymentdata-payment" id="ref-for-dom-collectedclientpaymentdata-payment①"><c- g>payment</c-></a>;
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#dictdef-collectedclientpaymentdata" id="ref-for-dictdef-collectedclientpaymentdata③">CollectedClientPaymentData</a></code> dictionary inherits from <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata" id="ref-for-dictdef-collectedclientdata③">CollectedClientData</a></code>. It contains the following additional field:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="CollectedClientPaymentData" data-dfn-type="dict-member" data-export id="dom-collectedclientpaymentdata-payment"><code>payment</code></dfn> member, <span> of type <a data-link-type="idl-name" href="#dictdef-collectedclientadditionalpaymentdata" id="ref-for-dictdef-collectedclientadditionalpaymentdata②">CollectedClientAdditionalPaymentData</a></span>
    <dd data-md>
     <p>The additional payment information to sign.</p>
   </dl>
   <h3 class="heading settled" data-level="5.2" id="sctn-collectedclientadditionalpaymentdata-dictionary"><span class="secno">5.2. </span><span class="content"><dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-collectedclientadditionalpaymentdata"><code>CollectedClientAdditionalPaymentData</code></dfn> Dictionary</span><a class="self-link" href="#sctn-collectedclientadditionalpaymentdata-dictionary"></a></h3>
<pre class="idl highlight def"><c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="#dictdef-collectedclientadditionalpaymentdata" id="ref-for-dictdef-collectedclientadditionalpaymentdata③"><c- g>CollectedClientAdditionalPaymentData</c-></a> {
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString①⑥"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-collectedclientadditionalpaymentdata-rpid" id="ref-for-dom-collectedclientadditionalpaymentdata-rpid①"><c- g>rpId</c-></a>;
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString①⑦"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-collectedclientadditionalpaymentdata-toporigin" id="ref-for-dom-collectedclientadditionalpaymentdata-toporigin①"><c- g>topOrigin</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString①⑧"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-collectedclientadditionalpaymentdata-payeename" id="ref-for-dom-collectedclientadditionalpaymentdata-payeename②"><c- g>payeeName</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString①⑨"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-collectedclientadditionalpaymentdata-payeeorigin" id="ref-for-dom-collectedclientadditionalpaymentdata-payeeorigin②"><c- g>payeeOrigin</c-></a>;
    <c- b>required</c-> <a data-link-type="idl-name" href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount" id="ref-for-dom-paymentcurrencyamount②"><c- n>PaymentCurrencyAmount</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCurrencyAmount " href="#dom-collectedclientadditionalpaymentdata-total" id="ref-for-dom-collectedclientadditionalpaymentdata-total②"><c- g>total</c-></a>;
    <c- b>required</c-> <a data-link-type="idl-name" href="#dictdef-paymentcredentialinstrument" id="ref-for-dictdef-paymentcredentialinstrument④"><c- n>PaymentCredentialInstrument</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCredentialInstrument " href="#dom-collectedclientadditionalpaymentdata-instrument" id="ref-for-dom-collectedclientadditionalpaymentdata-instrument③"><c- g>instrument</c-></a>;
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#dictdef-collectedclientadditionalpaymentdata" id="ref-for-dictdef-collectedclientadditionalpaymentdata④">CollectedClientAdditionalPaymentData</a></code> dictionary contains the following
fields:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="CollectedClientAdditionalPaymentData" data-dfn-type="dict-member" data-export id="dom-collectedclientadditionalpaymentdata-rpid"><code>rpId</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString②⓪">USVString</a></span>
    <dd data-md>
     <p>The id of the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party①⑨">Relying Party</a> that created the credential.</p>
     <p class="note" role="note"><span>NOTE:</span> For historical reasons, some implementations may additionally
         include this parameter with the name <code>rp</code>. The values of <code>rp</code> and <code>rpId</code> must be the same if both are present.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="CollectedClientAdditionalPaymentData" data-dfn-type="dict-member" data-export id="dom-collectedclientadditionalpaymentdata-toporigin"><code>topOrigin</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString②①">USVString</a></span>
    <dd data-md>
     <p>The origin of the top level context that requested to sign the transaction details.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="CollectedClientAdditionalPaymentData" data-dfn-type="dict-member" data-export id="dom-collectedclientadditionalpaymentdata-payeename"><code>payeeName</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString②②">USVString</a></span>
    <dd data-md>
     <p>The name of the payee, if present, that was displayed to the user.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="CollectedClientAdditionalPaymentData" data-dfn-type="dict-member" data-export id="dom-collectedclientadditionalpaymentdata-payeeorigin"><code>payeeOrigin</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString②③">USVString</a></span>
    <dd data-md>
     <p>The origin of the payee, if present, that was displayed to the user.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="CollectedClientAdditionalPaymentData" data-dfn-type="dict-member" data-export id="dom-collectedclientadditionalpaymentdata-total"><code>total</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount" id="ref-for-dom-paymentcurrencyamount③">PaymentCurrencyAmount</a></span>
    <dd data-md>
     <p>The <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount" id="ref-for-dom-paymentcurrencyamount④">PaymentCurrencyAmount</a></code> of the <a data-link-type="biblio" href="#biblio-payment-request">[payment-request]</a> <code>total</code> field.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="CollectedClientAdditionalPaymentData" data-dfn-type="dict-member" data-export id="dom-collectedclientadditionalpaymentdata-instrument"><code>instrument</code></dfn> member, <span> of type <a data-link-type="idl-name" href="#dictdef-paymentcredentialinstrument" id="ref-for-dictdef-paymentcredentialinstrument⑤">PaymentCredentialInstrument</a></span>
    <dd data-md>
     <p>The instrument information that was displayed to the user.</p>
   </dl>
   <p>Note that there is no <code>paymentRequestOrigin</code> field in <code class="idl"><a data-link-type="idl" href="#dictdef-collectedclientadditionalpaymentdata" id="ref-for-dictdef-collectedclientadditionalpaymentdata⑤">CollectedClientAdditionalPaymentData</a></code>, because the origin of the calling
frame is already included in <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata" id="ref-for-dictdef-collectedclientdata④">CollectedClientData</a></code> of <span>[webauthn-3]</span>.</p>
   <h2 class="heading settled" data-level="6" id="sctn-common-data-structures"><span class="secno">6. </span><span class="content">Common Data Structures</span><a class="self-link" href="#sctn-common-data-structures"></a></h2>
   <p>The following data structures are shared between registration and authentication.</p>
   <h3 class="heading settled" data-level="6.1" id="sctn-paymentcredentialinstrument-dictionary"><span class="secno">6.1. </span><span class="content"><dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-paymentcredentialinstrument"><code>PaymentCredentialInstrument</code></dfn> Dictionary</span><a class="self-link" href="#sctn-paymentcredentialinstrument-dictionary"></a></h3>
<pre class="idl highlight def"><c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="#dictdef-paymentcredentialinstrument" id="ref-for-dictdef-paymentcredentialinstrument⑥"><c- g>PaymentCredentialInstrument</c-></a> {
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString②④"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-paymentcredentialinstrument-displayname" id="ref-for-dom-paymentcredentialinstrument-displayname②"><c- g>displayName</c-></a>;
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString②⑤"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-paymentcredentialinstrument-icon" id="ref-for-dom-paymentcredentialinstrument-icon⑥"><c- g>icon</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean②"><c- b>boolean</c-></a> <a class="idl-code" data-default="true" data-link-type="dict-member" data-type="boolean " href="#dom-paymentcredentialinstrument-iconmustbeshown" id="ref-for-dom-paymentcredentialinstrument-iconmustbeshown②"><c- g>iconMustBeShown</c-></a> = <c- b>true</c->;
};
</pre>
   <p>The <code class="idl"><a data-link-type="idl" href="#dictdef-paymentcredentialinstrument" id="ref-for-dictdef-paymentcredentialinstrument⑦">PaymentCredentialInstrument</a></code> dictionary contains the information to be
displayed to the user and signed together with the transaction details. It
contains the following members:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="PaymentCredentialInstrument" data-dfn-type="dict-member" data-export id="dom-paymentcredentialinstrument-displayname"><code>displayName</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString②⑥">USVString</a></span>
    <dd data-md>
     <p>The name of the payment instrument to be displayed to the user.</p>
     <p class="note" role="note"><span>NOTE:</span> For discussion about internationalization of the <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-displayname" id="ref-for-dom-paymentcredentialinstrument-displayname③">displayName</a></code>, see <a href="https://github.com/w3c/secure-payment-confirmation/issues/93">issue 93</a>.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="PaymentCredentialInstrument" data-dfn-type="dict-member" data-export id="dom-paymentcredentialinstrument-icon"><code>icon</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString②⑦">USVString</a></span>
    <dd data-md>
     <p>The URL of the icon of the payment instrument.</p>
     <p class="note" role="note"><span>NOTE:</span> The <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-icon" id="ref-for-dom-paymentcredentialinstrument-icon⑦">icon</a></code> URL may either identify
 an image on an internet-accessible server (e.g., <code>https://bank.com/card.png</code>),
 or directly encode the icon data via a Data URL <a data-link-type="biblio" href="#biblio-rfc2397">[RFC2397]</a>. Between
 the two types of URLs, Data URLs offer several benefits to the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②⓪">Relying Party</a>. They can improve reliability (e.g., in the case that
 the icon hosting server may be unavailable). They can also enhance
 validation because the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②①">Relying Party</a> has cryptographic evidence of
 what the browser displayed to the user: the icon URL is signed as part
 of the <code class="idl"><a data-link-type="idl" href="#dictdef-collectedclientadditionalpaymentdata" id="ref-for-dictdef-collectedclientadditionalpaymentdata⑥">CollectedClientAdditionalPaymentData</a></code> structure.</p>
     <p class="note" role="note"><span>NOTE:</span> See related <a href="#sctn-accessibility-considerations">accessibility considerations</a>.</p>
    <dt data-md><dfn class="dfn-paneled idl-code" data-dfn-for="PaymentCredentialInstrument" data-dfn-type="dict-member" data-export id="dom-paymentcredentialinstrument-iconmustbeshown"><code>iconMustBeShown</code></dfn> member, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean③">boolean</a>, defaulting to <code>true</code></span>
    <dd data-md>
     <p>Indicates whether the specified icon must be successfully fetched and shown for the
request to succeed.</p>
   </dl>
   <h2 class="heading settled" data-level="7" id="sctn-permissions-policy"><span class="secno">7. </span><span class="content">Permissions Policy integration</span><a class="self-link" href="#sctn-permissions-policy"></a></h2>
   <p>This specification uses the "<a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-permission" id="ref-for-dfn-payment-permission①">payment</a>"
policy-identifier string from <a data-link-type="biblio" href="#biblio-payment-request">[payment-request]</a> to control access to <strong>both</strong> registration and authentication. This extends the <span spec-section="#sctn-permissions-policy">WebAuthn Permission Policy</span>.</p>
   <details class="wpt-tests-block" dir="ltr" lang="en">
    <summary>Tests</summary>
    <ul class="wpt-tests-list"></ul>
   </details>
   <p class="note" role="note"><span>Note:</span> Algorithms specified in <a data-link-type="biblio" href="#biblio-credential-management-1">[CREDENTIAL-MANAGEMENT-1]</a> perform the actual
permissions policy evaluation. This is because such policy evaluation needs to
occur when there is access to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object" id="ref-for-current-settings-object">current settings object</a>. The <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredential-create-slot" id="ref-for-dom-publickeycredential-create-slot">[[Create]](origin, options, sameOriginWithAncestors)</a></code> and <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-publickeycredential-discoverfromexternalsource-slot" id="ref-for-dom-publickeycredential-discoverfromexternalsource-slot①">[[DiscoverFromExternalSource]](origin, options,
sameOriginWithAncestors)</a></code> <a data-link-type="dfn" href="https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots" id="ref-for-sec-object-internal-methods-and-internal-slots">internal methods</a> do not have such access since
they are invoked <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a> (by algorithms specified in <a data-link-type="biblio" href="#biblio-credential-management-1">[CREDENTIAL-MANAGEMENT-1]</a>).</p>
   <h2 class="heading settled" data-level="8" id="sctn-relying-party-operations"><span class="secno">8. </span><span class="content">SPC Relying Party Operations</span><a class="self-link" href="#sctn-relying-party-operations"></a></h2>
   <h3 class="heading settled" data-level="8.1" id="sctn-verifying-assertion"><span class="secno">8.1. </span><span class="content">Verifying an Authentication Assertion</span><a class="self-link" href="#sctn-verifying-assertion"></a></h3>
   <p>In order to perform an <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#authentication-ceremony" id="ref-for-authentication-ceremony①">authentication ceremony</a> for Secure Payment
Confirmation, the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②②">Relying Party</a> MUST proceed as follows:</p>
   <ol>
    <li data-md>
     <p>Let <var>credential</var> be a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#publickeycredential" id="ref-for-publickeycredential">PublicKeyCredential</a></code> returned from a successful
invocation of the <a data-link-type="dfn" href="#secure-payment-confirmation-payment-handler" id="ref-for-secure-payment-confirmation-payment-handler②">Secure Payment Confirmation payment handler</a> by the <var>SPC caller</var>.</p>
     <p class="note" role="note"><span>Note:</span> As SPC is designed to enable <a href="#sctn-use-case-merchant-authentication">merchant
control of authentication</a>, the entity that invokes SPC may not be the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②③">Relying Party</a>. This first step presumes that the SPC caller has returned
a credential obtained via SPC to the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②④">Relying Party</a>.</p>
    <li data-md>
     <p>Perform steps 3-21 <span spec-section="#sctn-verifying-assertion"> as specified in
WebAuthn</span>, with the following changes:</p>
     <ol>
      <li data-md>
       <p>In step 5, verify that <var>credential</var>.<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webappsec-credential-management/#dom-credential-id" id="ref-for-dom-credential-id">id</a></code> identifies one of
the public key credentials provided to the <var>SPC caller</var> by the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②⑤">Relying Party</a>.</p>
      <li data-md>
       <p>In step 11, verify that the value of <var>C</var>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-collectedclientdata-type" id="ref-for-dom-collectedclientdata-type①">type</a></code>"]
is the string <code>payment.get</code>.</p>
      <li data-md>
       <p>In step 12, verify that the value of <var>C</var>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-collectedclientdata-challenge" id="ref-for-dom-collectedclientdata-challenge">challenge</a></code>"]
equals the base64url encoding of the challenge provided to the <var>SPC caller</var> by the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②⑥">Relying Party</a>.</p>
      <li data-md>
       <p>In step 13, verify that the value of <var>C</var>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-collectedclientdata-origin" id="ref-for-dom-collectedclientdata-origin">origin</a></code>"]
matches the origin that the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②⑦">Relying Party</a> expects SPC to have been
called from.</p>
      <li data-md>
       <p>After step 13, insert the following steps:</p>
       <ul>
        <li data-md>
         <p>Verify that the value of <var>C</var>["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientpaymentdata-payment" id="ref-for-dom-collectedclientpaymentdata-payment②">payment</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-rpid" id="ref-for-dom-collectedclientadditionalpaymentdata-rpid②">rpId</a></code>"]
matches the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②⑧">Relying Party</a>'s origin.</p>
        <li data-md>
         <p>Verify that the value of <var>C</var>["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientpaymentdata-payment" id="ref-for-dom-collectedclientpaymentdata-payment③">payment</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-toporigin" id="ref-for-dom-collectedclientadditionalpaymentdata-toporigin②">topOrigin</a></code>"]
matches the top-level origin that the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party②⑨">Relying Party</a> expects.</p>
        <li data-md>
         <p>Verify that the value of <var>C</var>["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientpaymentdata-payment" id="ref-for-dom-collectedclientpaymentdata-payment④">payment</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-payeename" id="ref-for-dom-collectedclientadditionalpaymentdata-payeename③">payeeName</a></code>"]
matches the name of the payee that should have been displayed to the user, if any.</p>
        <li data-md>
         <p>Verify that the value of <var>C</var>["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientpaymentdata-payment" id="ref-for-dom-collectedclientpaymentdata-payment⑤">payment</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-payeeorigin" id="ref-for-dom-collectedclientadditionalpaymentdata-payeeorigin③">payeeOrigin</a></code>"]
matches the origin of the payee that should have been displayed to the user, if any.</p>
        <li data-md>
         <p>Verify that the value of <var>C</var>["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientpaymentdata-payment" id="ref-for-dom-collectedclientpaymentdata-payment⑥">payment</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-total" id="ref-for-dom-collectedclientadditionalpaymentdata-total③">total</a></code>"]
matches the transaction amount that should have been displayed to the user.</p>
        <li data-md>
         <p>Verify that the value of <var>C</var>["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientpaymentdata-payment" id="ref-for-dom-collectedclientpaymentdata-payment⑦">payment</a></code>"]["<code class="idl"><a data-link-type="idl" href="#dom-collectedclientadditionalpaymentdata-instrument" id="ref-for-dom-collectedclientadditionalpaymentdata-instrument④">instrument</a></code>"]
matches the payment instrument details that should have been displayed to the user.</p>
       </ul>
     </ol>
   </ol>
   <h2 class="heading settled" data-level="9" id="sctn-automation"><span class="secno">9. </span><span class="content">User Agent Automation</span><a class="self-link" href="#sctn-automation"></a></h2>
   <p>For the purposes of user agent automation and website testing, this document
defines the below <a data-link-type="biblio" href="#biblio-webdriver">[WebDriver]</a> <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-extension-command" id="ref-for-dfn-extension-command">extension commands</a>. Interested parties
should also consult the <span spec-section="#sctn-automation">equivalent automation
section</span> in <span>[webauthn-3]</span>.</p>
   <h3 class="heading settled" data-level="9.1" id="sctn-automation-set-spc-transaction-mode"><span class="secno">9.1. </span><span class="content"><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="set-spc-transaction-mode">Set SPC Transaction Mode</dfn></span><a class="self-link" href="#sctn-automation-set-spc-transaction-mode"></a></h3>
   <p>The <a data-link-type="dfn" href="#set-spc-transaction-mode" id="ref-for-set-spc-transaction-mode">Set SPC Transaction Mode</a> WebDriver <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-extension-command" id="ref-for-dfn-extension-command①">extension command</a> instructs the
user agent to place Secure Payment Confirmation into a mode where it will
automatically simulate a user either accepting or rejecting the <a href="#sctn-transaction-confirmation-ux">transaction confirmation UX</a>.</p>
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="current-transaction-automation-mode">current transaction automation mode</dfn> tracks what <code class="idl"><a data-link-type="idl" href="#enumdef-transactionautomationmode" id="ref-for-enumdef-transactionautomationmode">TransactionAutomationMode</a></code> is currently active for SPC. It defaults to
"<code class="idl"><a data-link-type="idl" href="#dom-transactionautomationmode-none" id="ref-for-dom-transactionautomationmode-none①">none</a></code>".</p>
<pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-transactionautomationmode"><code><c- g>TransactionAutomationMode</c-></code></dfn> {
  <dfn class="dfn-paneled idl-code" data-dfn-for="TransactionAutomationMode" data-dfn-type="enum-value" data-export id="dom-transactionautomationmode-none"><code><c- s>"none"</c-></code></dfn>,
  <dfn class="dfn-paneled idl-code" data-dfn-for="TransactionAutomationMode" data-dfn-type="enum-value" data-export id="dom-transactionautomationmode-autoaccept"><code><c- s>"autoaccept"</c-></code></dfn>,
  <dfn class="dfn-paneled idl-code" data-dfn-for="TransactionAutomationMode" data-dfn-type="enum-value" data-export id="dom-transactionautomationmode-autoreject"><code><c- s>"autoreject"</c-></code></dfn>
};
</pre>
   <figure class="table" id="table-setSPCTransactionMode">
    <table class="data">
     <thead>
      <tr>
       <th>HTTP Method
       <th>URI Template
     <tbody>
      <tr>
       <td>POST
       <td><code>/session/{session id}/secure-payment-confirmation/set-mode</code>
    </table>
   </figure>
   <p>The <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-remote-end-steps" id="ref-for-dfn-remote-end-steps">remote end steps</a> are:</p>
   <ol>
    <li data-md>
     <p>If <var>parameters</var> is not a JSON <a href="https://tc39.es/ecma262/#sec-json-object">Object</a>, return a <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-errors" id="ref-for-dfn-errors">WebDriver error</a> with <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error-code" id="ref-for-dfn-error-code">WebDriver error code</a> <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-invalid-argument" id="ref-for-dfn-invalid-argument">invalid argument</a>.</p>
    <li data-md>
     <p>Let <var>mode</var> be the result of <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-getting-properties" id="ref-for-dfn-getting-properties">getting a property</a> named <code>"mode"</code> from <var>parameters</var>.</p>
    <li data-md>
     <p>If <var>mode</var> is <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-undefined" id="ref-for-dfn-undefined">undefined</a> or is not a member of <code class="idl"><a data-link-type="idl" href="#enumdef-transactionautomationmode" id="ref-for-enumdef-transactionautomationmode①">TransactionAutomationMode</a></code>,
return a <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-errors" id="ref-for-dfn-errors①">WebDriver error</a> with <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-error-code" id="ref-for-dfn-error-code①">WebDriver error code</a> <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-invalid-argument" id="ref-for-dfn-invalid-argument①">invalid
argument</a>.</p>
    <li data-md>
     <p>Set the <a data-link-type="dfn" href="#current-transaction-automation-mode" id="ref-for-current-transaction-automation-mode②">current transaction automation mode</a> to <var>mode</var>.</p>
    <li data-md>
     <p>Return <a data-link-type="dfn" href="https://w3c.github.io/webdriver/#dfn-success" id="ref-for-dfn-success">success</a> with data <code>null</code>.</p>
   </ol>
   <h2 class="heading settled" data-level="10" id="sctn-security-considerations"><span class="secno">10. </span><span class="content">Security Considerations</span><a class="self-link" href="#sctn-security-considerations"></a></h2>
   <p>As this specification builds on top of WebAuthn, the <span spec-section="#sctn-security-considerations">WebAuthn Security Considerations</span> are applicable. The below subsections comprise the current Secure Payment
Confirmation-specific security considerations, where this specification
diverges from WebAuthn.</p>
   <h3 class="heading settled" data-level="10.1" id="sctn-security-cross-origin-auth"><span class="secno">10.1. </span><span class="content">Cross-origin authentication ceremony</span><a class="self-link" href="#sctn-security-cross-origin-auth"></a></h3>
   <p>A significant departure that Secure Payment Confirmation makes from WebAuthn is
in allowing a third-party to initiate an authentication ceremony using
credentials for a different <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③⓪">Relying Party</a>, and returning the assertion to
the third party. This feature can expose <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③①">Relying Parties</a> to both login and
payment attacks, which are discussed here.</p>
   <h4 class="heading settled" data-level="10.1.1" id="sctn-security-login-attack"><span class="secno">10.1.1. </span><span class="content">Login Attack</span><a class="self-link" href="#sctn-security-login-attack"></a></h4>
   <p>As credentials created for Secure Payment Confirmation are valid WebAuthn
credentials, it is possible that a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③②">Relying Party</a> may wish to use the same
credential for a given user for both login and payment. This allows a potential
attack on the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③③">Relying Party’s</a> login system, if they do not carefully verify
the assertion they receive.</p>
   <p>The attack is as follows:</p>
   <ol>
    <li data-md>
     <p>The user visits <code>attacker.com</code>, which is or pretends to be a merchant site.</p>
    <li data-md>
     <p><code>attacker.com</code> obtains credentials for the user from <code>relyingparty.com</code>,
 either legitimately or by stealing them from <code>relyingparty.com</code> or another
 party with whom <code>relyingparty.com</code> had shared the credentials.</p>
    <li data-md>
     <p><code>attacker.com</code> initiates SPC authentication, and the user agrees to the
 transaction (which may or may not be legitimate).</p>
    <li data-md>
     <p><code>attacker.com</code> takes the payment assertion that they received from the API
 call, and sends it to the login endpoint for <code>relyingparty.com</code>, e.g. by
 sending a POST to <code>https://relyingparty.com/login</code>.</p>
    <li data-md>
     <p><code>relyingparty.com</code> is employing faulty assertion validation code, which
 checks the signature but fails to validate the necessary fields (see
 below), and believes the login attempt to be legitimate.</p>
    <li data-md>
     <p><code>relyingparty.com</code> returns e.g. a login cookie to <code>attacker.com</code>. The user’s
 account at <code>relyingparty.com</code> has now been compromised.</p>
   </ol>
   <p><a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③④">Relying Parties</a> can guard against this attack in two ways.</p>
   <p>Firstly, a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③⑤">Relying Party</a> must always follow the correct assertion
validation steps either for <span spec-section="#sctn-verifying-assertion">WebAuthn
login</span> or <a href="#sctn-verifying-assertion">SPC payment</a> as appropriate. In
particular, the following fields can all be used to detect an inappropriate use
of a credential:</p>
   <ul>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata" id="ref-for-dictdef-collectedclientdata⑤">CollectedClientData</a></code>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-collectedclientdata-type" id="ref-for-dom-collectedclientdata-type②">type</a></code>"]- "webauthn.get" for
login, "payment.get" for SPC.</p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata" id="ref-for-dictdef-collectedclientdata⑥">CollectedClientData</a></code>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-collectedclientdata-challenge" id="ref-for-dom-collectedclientdata-challenge①">challenge</a></code>"] - this value should
be provided by the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③⑥">Relying Party</a> server to the site ahead of any call
to either WebAuthn or SPC, and should be verified as matching an expected,
appropriate, previously-provided value.</p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata" id="ref-for-dictdef-collectedclientdata⑦">CollectedClientData</a></code>["<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webauthn/#dom-collectedclientdata-origin" id="ref-for-dom-collectedclientdata-origin①">origin</a></code>"] - if SPC is being
performed cross-origin, this value will contain the origin of the caller
(e.g. <code>attacker.com</code> in the above example).</p>
   </ul>
   <p>Secondly, a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③⑦">Relying Party</a> can consider keeping their payment and login
credentials separate. If doing this, the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③⑧">Relying Party</a> should only register
credentials for Secure Payment Confirmation on a subdomain (e.g. <code>https//payment.relyingparty.com</code>), and should keep payment credentials and
login credentials separate in their database.</p>
   <div class="note" role="note">
     NOTE: As currently written, the Secure Payment Confirmation specification
      allows any WebAuthn credential to be used in an SPC authentication.
      However this is not true in implementations today, which only allow
      credentials created with the <code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionsclientinputs-payment" id="ref-for-dom-authenticationextensionsclientinputs-payment②">payment</a></code> extension specified to participate in SPC authentication, and the
      specification may be updated to reflect that in the future. 
    <p>In both implementation and specification today, a credential created
      with the <code class="idl"><a data-link-type="idl" href="#dom-authenticationextensionsclientinputs-payment" id="ref-for-dom-authenticationextensionsclientinputs-payment③">payment</a></code> can be used
      for login, if the Relying Party wishes. This is not expected to change.</p>
   </div>
   <h4 class="heading settled" data-level="10.1.2" id="sctn-security-payment-attack"><span class="secno">10.1.2. </span><span class="content">Payment Attack</span><a class="self-link" href="#sctn-security-payment-attack"></a></h4>
   <p>A Secure Payment Confirmation assertion is essentially useless unless
it is part of an ongoing online transaction.</p>
   <p>A variety of mechanisms protect against an attack where a malicious
third-party, instead of attempting to hijack a user account, initiates
an unauthorized payment using Secure Payment Confirmation credentials
(obtained either legitimately or otherwise):</p>
   <ul>
    <li data-md>
     <p>When the attacker initiates SPC, the user will be shown UI by the
User Agent that clearly states the transaction details (including the payee
and amount). The user is very likely to "cancel" in this scenario.</p>
    <li data-md>
     <p>If the user does agree to the transaction, and completes the subsequent
WebAuthn authentication ceremony, the attacker now has a signed SPC
assertion for the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party③⑨">Relying Party</a>.</p>
    <li data-md>
     <p>If the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④⓪">Relying Party</a> is not expecting a transaction, it will reject the
assertion.</p>
    <li data-md>
     <p>If the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④①">Relying Party</a> is expecting a transaction, it will detect an
unfamiliar <code>challenge</code> and reject the assertion.</p>
   </ul>
   <h3 class="heading settled" data-level="10.2" id="sctn-security-merchant-data"><span class="secno">10.2. </span><span class="content">Merchant-supplied authentication data</span><a class="self-link" href="#sctn-security-merchant-data"></a></h3>
   <p>The bank can and should protect against spoofing by <a href="#sctn-verifying-assertion">verifying the authentication assertion</a> they receive to
ensure it aligns with the transaction details provided by the
merchant.</p>
   <p>That is because a consequence of this specification’s third-party
authentication ceremony is that even in a valid transaction (i.e. one
that the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④②">Relying Party</a> is expecting), a third-party provides the
transaction details that are shown to the user:</p>
   <ul>
    <li data-md>
     <p>Transaction amount and currency</p>
    <li data-md>
     <p>Payment instrument name and icon</p>
    <li data-md>
     <p>Payee name and origin</p>
   </ul>
   <p>This could lead to a spoofing attack, in which a merchant presents incorrect
data to the user. For example, the merchant could tell the bank (in the
backend) that it is initiating a purchase of $100, but then pass $1 to the SPC
API (and thus show the user a $1 transaction to verify). Or the merchant
could provide the correct transaction details but pass Secure Payment
Confirmation credentials that don’t match what the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④③">Relying Party</a> expects.</p>
   <p>Secure Payment Confirmation actually makes defeating this kind of attack easier
than it currently is on the web. In online payments today, the bank has to
trust that the merchant showed the user the correct amount in their checkout
flow (and any fraud discoveries are post-payment, when the user checks their
account statement).</p>
   <h2 class="heading settled" data-level="11" id="sctn-privacy-considerations"><span class="secno">11. </span><span class="content">Privacy Considerations</span><a class="self-link" href="#sctn-privacy-considerations"></a></h2>
   <p>As this specification builds on top of WebAuthn, the <span spec-section="#sctn-privacy-considerations">WebAuthn Privacy Considerations</span> are
applicable. The below subsections comprise the current Secure Payment
Confirmation-specific privacy considerations, where this specification diverges
from WebAuthn.</p>
   <h3 class="heading settled" data-level="11.1" id="sctn-security-cross-origin-registration"><span class="secno">11.1. </span><span class="content">Registration in a Cross-Origin iframe</span><a class="self-link" href="#sctn-security-cross-origin-registration"></a></h3>
   <p>Unlike WebAuthn, this specification allows the creation of credentials in a
cross-origin iframe (as long as the appropriate <a href="#sctn-permissions-policy">Permission Policy</a> is set on the iframe). That is,
if site A embeds an iframe from site B, with the "<a data-link-type="dfn" href="https://w3c.github.io/payment-request/#dfn-payment-permission" id="ref-for-dfn-payment-permission②">payment</a>" policy set, then site B may initiate a credential creation
for site B within that iframe.</p>
   <p class="note" role="note"><span>NOTE:</span> Allowing credential creation in cross-origin iframes is currently <a href="https://github.com/w3c/webauthn/issues/1656">under
      discussion</a> in the WebAuthn
      Working Group, and thus may move from this specification to WebAuthn in
      the future.</p>
   <p>Allowing credential creation in a cross-origin iframe presents a risk that an
iframe may attempt to trick a user into registering a credential. That
credential could then be used for tracking (see <a href="https://github.com/w3c/webauthn/issues/1336#issue-513568855">WebAuthn issue
1336</a>). To
mitigate such an attack, this specification requires that a call to <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-create" id="ref-for-dom-credentialscontainer-create②">navigator.credentials.create()</a></code> inside a
cross-origin iframe may only be invoked when the iframe has <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation" id="ref-for-transient-activation②">transient
activation</a> (e.g., via a click or press from the user).</p>
   <p class="note" role="note"><span>NOTE:</span> Requiring user activation for WebAuthn APIs in general is under discussion
      in the WebAuthn WG too; see <a href="https://github.com/w3c/webauthn/issues/1293">issue #1293</a>.</p>
   <h3 class="heading settled" data-level="11.2" id="sctn-privacy-probing-credential-ids"><span class="secno">11.2. </span><span class="content">Probing for credential ids</span><a class="self-link" href="#sctn-privacy-probing-credential-ids"></a></h3>
   <p>As per WebAuthn’s section on <span spec-section="#sctn-assertion-privacy">Authentication
Ceremony Privacy</span>, implementors of Secure Payment Confirmation must make sure
not to enable malicious callers (who now may not even be the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④④">Relying Party</a>)
to distinguish between these cases:</p>
   <ul>
    <li data-md>
     <p>A credential is not available.</p>
    <li data-md>
     <p>A credential is available, but the user does not consent to use it.</p>
   </ul>
   <p>If the above cases are distinguishable, information is leaked by which a
malicious <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④⑤">Relying Party</a> could identify the user by probing for which <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#public-key-credential" id="ref-for-public-key-credential②">credentials</a> are available.</p>
   <p>Section <a href="#sctn-steps-to-check-if-a-payment-can-be-made">§ 4.1.6 Steps to check if a payment can be made</a> gives normative steps
to mitigate this risk.</p>
   <h3 class="heading settled" data-level="11.3" id="sctn-privacy-joining-payment-instruments"><span class="secno">11.3. </span><span class="content">Joining different payment instruments</span><a class="self-link" href="#sctn-privacy-joining-payment-instruments"></a></h3>
   <p>If a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④⑥">Relying Party</a> uses the same credentials for a given user across
multiple payment instruments, this might allow a merchant to join information
about payment instruments that might otherwise not be linked. That is, across
two different transactions that a user U performs with payment instruments P1
and P2 (either on the same merchant M, or two colluding merchants M1 and M2),
the merchant(s) may now be able to learn that P1 and P2 are for the same user.</p>
   <p>For many current online payment flows this may not be a significant
risk, as the user often provides sufficient information to do
this joining anyway (e.g., name, email address, shipping address).</p>
   <p>However, if payment methods that involve less identifying information
(e.g., tokenization) become commonplace, it is important that
ecosystem stakeholders take steps to preserve user privacy. For example:</p>
   <ul>
    <li data-md>
     <p>Payment systems might establish rules that place limits on storage of credential ID(s) by third parties.</p>
    <li data-md>
     <p>When a <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④⑦">Relying Party</a> assigns multiple instruments to a single SPC credential, it might choose not to share that credential ID with other parties. In this case, the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④⑧">Relying Party</a> could still use the SPC credential itself (in either a first-party or third-party context) to authenticate the user.</p>
    <li data-md>
     <p>A <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party④⑨">Relying Party</a> (e.g., a bank) might enable the user to register a distinct SPC credential per payment instrument. This would not prevent the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party⑤⓪">Relying Party</a> from joining those accounts internally.</p>
   </ul>
   <p class="note" role="note"><span>NOTE:</span> See <a href="https://github.com/w3c/secure-payment-confirmation/issues/77">issue #77</a> for discussion on possible spec changes related to this section.</p>
   <h3 class="heading settled" data-level="11.4" id="sctn-privacy-credential-id-tracking-vector"><span class="secno">11.4. </span><span class="content">Credential ID(s) as a tracking vector</span><a class="self-link" href="#sctn-privacy-credential-id-tracking-vector"></a></h3>
   <p>Even for a single payment instrument, the credential ID(s) returned by the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party⑤①">Relying Party</a> could be used by a malicious entity as a tracking vector, as
they are strong, cross-site identifiers. However in order to obtain them from
the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party⑤②">Relying Party</a>, the merchant already needs an as-strong identifier to
give to the <a data-link-type="dfn" href="https://w3c.github.io/webauthn/#relying-party" id="ref-for-relying-party⑤③">Relying Party</a> (e.g., the credit card number).</p>
   <p class="note" role="note"><span>NOTE:</span> See <a href="https://github.com/w3c/secure-payment-confirmation/issues/77">issue #77</a> for discussion on possible spec changes related to this section.</p>
   <h2 class="heading settled" data-level="12" id="sctn-accessibility-considerations"><span class="secno">12. </span><span class="content">Accessibility Considerations</span><a class="self-link" href="#sctn-accessibility-considerations"></a></h2>
   <p>User agents render the <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-icon" id="ref-for-dom-paymentcredentialinstrument-icon⑧">icon</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-displayname" id="ref-for-dom-paymentcredentialinstrument-displayname④">displayName</a></code> together. Relying parties ensure the accessibility of the icon presentation by providing sufficient information via the <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-displayname" id="ref-for-dom-paymentcredentialinstrument-displayname⑤">displayName</a></code> (e.g., if the icon represents a bank, by including the bank name in the <code class="idl"><a data-link-type="idl" href="#dom-paymentcredentialinstrument-displayname" id="ref-for-dom-paymentcredentialinstrument-displayname⑥">displayName</a></code>).</p>
   <p>User Agents implementing this specification should follow both <span spec-section="#sctn-accessiblility-considerations">WebAuthn’s Accessibility Considerations</span> and <a data-link-type="dfn" href="https://w3c.github.io/payment-request/#accessibility-considerations" id="ref-for-accessibility-considerations">PaymentRequest’s Accessibility Considerations</a>.</p>
   <p id="back-to-top" role="navigation"><a href="#toc"><abbr title="Back to Top">↑</abbr></a></p>
<script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  </main>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dictdef-authenticationextensionspaymentinputs">AuthenticationExtensionsPaymentInputs</a><span>, in § 5</span>
   <li><a href="#dom-transactionautomationmode-autoaccept">"autoaccept"</a><span>, in § 9.1</span>
   <li><a href="#dom-transactionautomationmode-autoreject">"autoreject"</a><span>, in § 9.1</span>
   <li><a href="#dom-securepaymentconfirmationrequest-challenge">challenge</a><span>, in § 4.1.3</span>
   <li><a href="#client-extension-processing-authentication">Client extension processing (authentication)</a><span>, in § 5</span>
   <li><a href="#client-extension-processing-registration">Client extension processing (registration)</a><span>, in § 5</span>
   <li><a href="#dictdef-collectedclientadditionalpaymentdata">CollectedClientAdditionalPaymentData</a><span>, in § 5.2</span>
   <li><a href="#dictdef-collectedclientpaymentdata">CollectedClientPaymentData</a><span>, in § 5.1</span>
   <li><a href="#dom-securepaymentconfirmationrequest-credentialids">credentialIds</a><span>, in § 4.1.3</span>
   <li><a href="#current-transaction-automation-mode">current transaction automation mode</a><span>, in § 9.1</span>
   <li><a href="#dom-paymentcredentialinstrument-displayname">displayName</a><span>, in § 6.1</span>
   <li><a href="#dom-securepaymentconfirmationrequest-extensions">extensions</a><span>, in § 4.1.3</span>
   <li><a href="#dom-paymentcredentialinstrument-icon">icon</a><span>, in § 6.1</span>
   <li><a href="#dom-paymentcredentialinstrument-iconmustbeshown">iconMustBeShown</a><span>, in § 6.1</span>
   <li>
    instrument
    <ul>
     <li><a href="#dom-authenticationextensionspaymentinputs-instrument">dict-member for AuthenticationExtensionsPaymentInputs</a><span>, in § 5</span>
     <li><a href="#dom-collectedclientadditionalpaymentdata-instrument">dict-member for CollectedClientAdditionalPaymentData</a><span>, in § 5.2</span>
     <li><a href="#dom-securepaymentconfirmationrequest-instrument">dict-member for SecurePaymentConfirmationRequest</a><span>, in § 4.1.3</span>
    </ul>
   <li><a href="#dom-authenticationextensionspaymentinputs-ispayment">isPayment</a><span>, in § 5</span>
   <li><a href="#dom-securepaymentconfirmationrequest-locale">locale</a><span>, in § 4.1.3</span>
   <li><a href="#dom-transactionautomationmode-none">"none"</a><span>, in § 9.1</span>
   <li>
    payeeName
    <ul>
     <li><a href="#dom-authenticationextensionspaymentinputs-payeename">dict-member for AuthenticationExtensionsPaymentInputs</a><span>, in § 5</span>
     <li><a href="#dom-collectedclientadditionalpaymentdata-payeename">dict-member for CollectedClientAdditionalPaymentData</a><span>, in § 5.2</span>
     <li><a href="#dom-securepaymentconfirmationrequest-payeename">dict-member for SecurePaymentConfirmationRequest</a><span>, in § 4.1.3</span>
    </ul>
   <li>
    payeeOrigin
    <ul>
     <li><a href="#dom-authenticationextensionspaymentinputs-payeeorigin">dict-member for AuthenticationExtensionsPaymentInputs</a><span>, in § 5</span>
     <li><a href="#dom-collectedclientadditionalpaymentdata-payeeorigin">dict-member for CollectedClientAdditionalPaymentData</a><span>, in § 5.2</span>
     <li><a href="#dom-securepaymentconfirmationrequest-payeeorigin">dict-member for SecurePaymentConfirmationRequest</a><span>, in § 4.1.3</span>
    </ul>
   <li>
    payment
    <ul>
     <li><a href="#dom-authenticationextensionsclientinputs-payment">dict-member for AuthenticationExtensionsClientInputs</a><span>, in § 5</span>
     <li><a href="#dom-collectedclientpaymentdata-payment">dict-member for CollectedClientPaymentData</a><span>, in § 5.1</span>
    </ul>
   <li><a href="#dictdef-paymentcredentialinstrument">PaymentCredentialInstrument</a><span>, in § 6.1</span>
   <li>
    rpId
    <ul>
     <li><a href="#dom-authenticationextensionspaymentinputs-rpid">dict-member for AuthenticationExtensionsPaymentInputs</a><span>, in § 5</span>
     <li><a href="#dom-collectedclientadditionalpaymentdata-rpid">dict-member for CollectedClientAdditionalPaymentData</a><span>, in § 5.2</span>
     <li><a href="#dom-securepaymentconfirmationrequest-rpid">dict-member for SecurePaymentConfirmationRequest</a><span>, in § 4.1.3</span>
    </ul>
   <li><a href="#secure-payment-confirmation">secure-payment-confirmation</a><span>, in § 4.1.1</span>
   <li><a href="#secure-payment-confirmation-payment-handler">Secure Payment Confirmation payment handler</a><span>, in § 4.1</span>
   <li><a href="#dictdef-securepaymentconfirmationrequest">SecurePaymentConfirmationRequest</a><span>, in § 4.1.3</span>
   <li><a href="#set-spc-transaction-mode">Set SPC Transaction Mode</a><span>, in § 9.1</span>
   <li><a href="#spc-credential">SPC Credential</a><span>, in § 2</span>
   <li><a href="#steps-to-silently-determine-if-a-credential-is-available-for-the-current-device">Steps to silently determine if a credential is available for the current device</a><span>, in § 2</span>
   <li><a href="#steps-to-silently-determine-if-a-credential-is-spc-enabled">Steps to silently determine if a credential is SPC-enabled</a><span>, in § 2</span>
   <li><a href="#dom-securepaymentconfirmationrequest-timeout">timeout</a><span>, in § 4.1.3</span>
   <li>
    topOrigin
    <ul>
     <li><a href="#dom-authenticationextensionspaymentinputs-toporigin">dict-member for AuthenticationExtensionsPaymentInputs</a><span>, in § 5</span>
     <li><a href="#dom-collectedclientadditionalpaymentdata-toporigin">dict-member for CollectedClientAdditionalPaymentData</a><span>, in § 5.2</span>
    </ul>
   <li>
    total
    <ul>
     <li><a href="#dom-authenticationextensionspaymentinputs-total">dict-member for AuthenticationExtensionsPaymentInputs</a><span>, in § 5</span>
     <li><a href="#dom-collectedclientadditionalpaymentdata-total">dict-member for CollectedClientAdditionalPaymentData</a><span>, in § 5.2</span>
    </ul>
   <li><a href="#enumdef-transactionautomationmode">TransactionAutomationMode</a><span>, in § 9.1</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-dom-credentialscontainer-create">
   <a href="https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-create">https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-create</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-credentialscontainer-create">3. Registration</a>
    <li><a href="#ref-for-dom-credentialscontainer-create①">5. WebAuthn Extension - "payment"</a>
    <li><a href="#ref-for-dom-credentialscontainer-create②">11.1. Registration in a Cross-Origin iframe</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-credentialscontainer-get">
   <a href="https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-get">https://w3c.github.io/webappsec-credential-management/#dom-credentialscontainer-get</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-credentialscontainer-get">5. WebAuthn Extension - "payment"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-credential-id">
   <a href="https://w3c.github.io/webappsec-credential-management/#dom-credential-id">https://w3c.github.io/webappsec-credential-management/#dom-credential-id</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-credential-id">8.1. Verifying an Authentication Assertion</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-abstract-opdef-request-a-credential">
   <a href="https://w3c.github.io/webappsec-credential-management/#abstract-opdef-request-a-credential">https://w3c.github.io/webappsec-credential-management/#abstract-opdef-request-a-credential</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-abstract-opdef-request-a-credential">4.1.8. Steps to respond to a payment request</a> <a href="#ref-for-abstract-opdef-request-a-credential①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-sec-object-internal-methods-and-internal-slots">
   <a href="https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots">https://tc39.github.io/ecma262/#sec-object-internal-methods-and-internal-slots</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-sec-object-internal-methods-and-internal-slots">7. Permissions Policy integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-consume-user-activation">
   <a href="https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation">https://html.spec.whatwg.org/multipage/interaction.html#consume-user-activation</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-consume-user-activation">5. WebAuthn Extension - "payment"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-current-settings-object">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-current-settings-object">7. Permissions Policy integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-in-parallel">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-in-parallel">7. Permissions Policy integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-origin">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#concept-origin">https://html.spec.whatwg.org/multipage/origin.html#concept-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-origin">4.1.3. SecurePaymentConfirmationRequest Dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-relevant-global">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global">https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-relevant-global">5. WebAuthn Extension - "payment"</a> <a href="#ref-for-concept-relevant-global①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-relevant-settings-object">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-relevant-settings-object">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ascii-serialisation-of-an-origin">
   <a href="https://html.spec.whatwg.org/multipage/origin.html#ascii-serialisation-of-an-origin">https://html.spec.whatwg.org/multipage/origin.html#ascii-serialisation-of-an-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ascii-serialisation-of-an-origin">4.1.6. Steps to check if a payment can be made</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-environment-top-level-origin">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin">https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-top-level-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-environment-top-level-origin">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-transient-activation">
   <a href="https://html.spec.whatwg.org/multipage/interaction.html#transient-activation">https://html.spec.whatwg.org/multipage/interaction.html#transient-activation</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-transient-activation">5. WebAuthn Extension - "payment"</a> <a href="#ref-for-transient-activation①">(2)</a>
    <li><a href="#ref-for-transient-activation②">11.1. Registration in a Cross-Origin iframe</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-language-negotiation">
   <a href="https://w3c.github.io/i18n-glossary/#language-negotiation">https://w3c.github.io/i18n-glossary/#language-negotiation</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-language-negotiation">4.1.3. SecurePaymentConfirmationRequest Dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-language-priority-list">
   <a href="https://w3c.github.io/i18n-glossary/#language-priority-list">https://w3c.github.io/i18n-glossary/#language-priority-list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-language-priority-list">4.1.3. SecurePaymentConfirmationRequest Dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-locale">
   <a href="https://w3c.github.io/i18n-glossary/#locale">https://w3c.github.io/i18n-glossary/#locale</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-locale">4.1.3. SecurePaymentConfirmationRequest Dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-fetching-an-image-resource">
   <a href="https://www.w3.org/TR/image-resource/#dfn-fetching-an-image-resource">https://www.w3.org/TR/image-resource/#dfn-fetching-an-image-resource</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-fetching-an-image-resource">4.1.6. Steps to check if a payment can be made</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-imageresource-src">
   <a href="https://www.w3.org/TR/image-resource/#dom-imageresource-src">https://www.w3.org/TR/image-resource/#dom-imageresource-src</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-imageresource-src">4.1.6. Steps to check if a payment can be made</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-append">
   <a href="https://infra.spec.whatwg.org/#list-append">https://infra.spec.whatwg.org/#list-append</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-append">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-registry">
   <a href="https://w3c.github.io/payment-method-id/#registry">https://w3c.github.io/payment-method-id/#registry</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-registry">4.1.2. Registration in [payment-method-id]</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-standardized-payment-method-identifier">
   <a href="https://www.w3.org/TR/payment-method-id/#dfn-standardized-payment-method-identifier">https://www.w3.org/TR/payment-method-id/#dfn-standardized-payment-method-identifier</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-standardized-payment-method-identifier">4.1.1. Payment Method Identifier</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-paymentcurrencyamount">
   <a href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount">https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-paymentcurrencyamount">5. WebAuthn Extension - "payment"</a> <a href="#ref-for-dom-paymentcurrencyamount①">(2)</a>
    <li><a href="#ref-for-dom-paymentcurrencyamount②">5.2. CollectedClientAdditionalPaymentData Dictionary</a> <a href="#ref-for-dom-paymentcurrencyamount③">(2)</a> <a href="#ref-for-dom-paymentcurrencyamount④">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-paymentrequest">
   <a href="https://www.w3.org/TR/payment-request/#dom-paymentrequest">https://www.w3.org/TR/payment-request/#dom-paymentrequest</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-paymentrequest">1. Introduction</a>
    <li><a href="#ref-for-dom-paymentrequest①">4.1.8. Steps to respond to a payment request</a>
    <li><a href="#ref-for-dom-paymentrequest②">5. WebAuthn Extension - "payment"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-paymentrequest-constructor">
   <a href="https://www.w3.org/TR/payment-request/#dom-paymentrequest-constructor">https://www.w3.org/TR/payment-request/#dom-paymentrequest-constructor</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-paymentrequest-constructor">4.1. Payment Method: Secure Payment Confirmation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-paymentcurrencyamount-currency">
   <a href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount-currency">https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount-currency</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-paymentcurrencyamount-currency">4.1.7. Displaying a transaction confirmation UX</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-payment-handler">
   <a href="https://www.w3.org/TR/payment-request/#dfn-payment-handler">https://www.w3.org/TR/payment-request/#dfn-payment-handler</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-payment-handler">4.1. Payment Method: Secure Payment Confirmation</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-payment-method">
   <a href="https://w3c.github.io/payment-request/#dfn-payment-method">https://w3c.github.io/payment-request/#dfn-payment-method</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-payment-method">1. Introduction</a>
    <li><a href="#ref-for-dfn-payment-method①">4. Authentication</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-additional-data-type">
   <a href="https://w3c.github.io/payment-request/#dfn-additional-data-type">https://w3c.github.io/payment-request/#dfn-additional-data-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-additional-data-type">4.1.4. Payment Method additional data type</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-payment-permission">
   <a href="https://w3c.github.io/payment-request/#dfn-payment-permission">https://w3c.github.io/payment-request/#dfn-payment-permission</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-payment-permission">1.2.1. Registration during a checkout</a>
    <li><a href="#ref-for-dfn-payment-permission①">7. Permissions Policy integration</a>
    <li><a href="#ref-for-dfn-payment-permission②">11.1. Registration in a Cross-Origin iframe</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-accessibility-considerations">
   <a href="https://w3c.github.io/payment-request/#accessibility-considerations">https://w3c.github.io/payment-request/#accessibility-considerations</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-accessibility-considerations">12. Accessibility Considerations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-details">
   <a href="https://w3c.github.io/payment-request/#dfn-details">https://w3c.github.io/payment-request/#dfn-details</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-details">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-paymentrequest-show">
   <a href="https://www.w3.org/TR/payment-request/#dom-paymentrequest-show">https://www.w3.org/TR/payment-request/#dom-paymentrequest-show</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-paymentrequest-show">4.1.6. Steps to check if a payment can be made</a>
    <li><a href="#ref-for-dom-paymentrequest-show①">4.1.7. Displaying a transaction confirmation UX</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-steps-to-check-if-a-payment-can-be-made">
   <a href="https://w3c.github.io/payment-request/#dfn-steps-to-check-if-a-payment-can-be-made">https://w3c.github.io/payment-request/#dfn-steps-to-check-if-a-payment-can-be-made</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-steps-to-check-if-a-payment-can-be-made">4.1.6. Steps to check if a payment can be made</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-steps-to-respond-to-a-payment-request">
   <a href="https://w3c.github.io/payment-request/#dfn-steps-to-respond-to-a-payment-request">https://w3c.github.io/payment-request/#dfn-steps-to-respond-to-a-payment-request</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-steps-to-respond-to-a-payment-request">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-steps-to-validate-payment-method-data">
   <a href="https://w3c.github.io/payment-request/#dfn-steps-to-validate-payment-method-data">https://w3c.github.io/payment-request/#dfn-steps-to-validate-payment-method-data</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-steps-to-validate-payment-method-data">4.1.5. Steps to validate payment method data</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-paymentdetailsinit-total">
   <a href="https://www.w3.org/TR/payment-request/#dom-paymentdetailsinit-total">https://www.w3.org/TR/payment-request/#dom-paymentdetailsinit-total</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-paymentdetailsinit-total">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-paymentcurrencyamount-value">
   <a href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount-value">https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount-value</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-paymentcurrencyamount-value">4.1.7. Displaying a transaction confirmation UX</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-origin">
   <a href="https://url.spec.whatwg.org/#concept-url-origin">https://url.spec.whatwg.org/#concept-url-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-origin">4.1.6. Steps to check if a payment can be made</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-scheme">
   <a href="https://url.spec.whatwg.org/#concept-url-scheme">https://url.spec.whatwg.org/#concept-url-scheme</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-scheme">4.1.5. Steps to validate payment method data</a>
    <li><a href="#ref-for-concept-url-scheme①">4.1.6. Steps to check if a payment can be made</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-parser">
   <a href="https://url.spec.whatwg.org/#concept-url-parser">https://url.spec.whatwg.org/#concept-url-parser</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-parser">4.1.5. Steps to validate payment method data</a>
    <li><a href="#ref-for-concept-url-parser①">4.1.6. Steps to check if a payment can be made</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-valid-domain">
   <a href="https://url.spec.whatwg.org/#valid-domain">https://url.spec.whatwg.org/#valid-domain</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-valid-domain">4.1.5. Steps to validate payment method data</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-authentication-ceremony">
   <a href="https://w3c.github.io/webauthn/#authentication-ceremony">https://w3c.github.io/webauthn/#authentication-ceremony</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-authentication-ceremony">4. Authentication</a>
    <li><a href="#ref-for-authentication-ceremony①">8.1. Verifying an Authentication Assertion</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-authentication-extension">
   <a href="https://w3c.github.io/webauthn/#authentication-extension">https://w3c.github.io/webauthn/#authentication-extension</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-authentication-extension">5. WebAuthn Extension - "payment"</a> <a href="#ref-for-authentication-extension①">(2)</a> <a href="#ref-for-authentication-extension②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-client-extension">
   <a href="https://w3c.github.io/webauthn/#client-extension">https://w3c.github.io/webauthn/#client-extension</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-client-extension">5. WebAuthn Extension - "payment"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-credential-id">
   <a href="https://w3c.github.io/webauthn/#credential-id">https://w3c.github.io/webauthn/#credential-id</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-credential-id">2. Terminology</a> <a href="#ref-for-credential-id①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-discoverable-credential">
   <a href="https://w3c.github.io/webauthn/#discoverable-credential">https://w3c.github.io/webauthn/#discoverable-credential</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-discoverable-credential">2. Terminology</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-public-key-credential">
   <a href="https://w3c.github.io/webauthn/#public-key-credential">https://w3c.github.io/webauthn/#public-key-credential</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-public-key-credential">2. Terminology</a> <a href="#ref-for-public-key-credential①">(2)</a>
    <li><a href="#ref-for-public-key-credential②">11.2. Probing for credential ids</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-registration-extension">
   <a href="https://w3c.github.io/webauthn/#registration-extension">https://w3c.github.io/webauthn/#registration-extension</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-registration-extension">5. WebAuthn Extension - "payment"</a> <a href="#ref-for-registration-extension①">(2)</a> <a href="#ref-for-registration-extension②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-relying-party">
   <a href="https://w3c.github.io/webauthn/#relying-party">https://w3c.github.io/webauthn/#relying-party</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-relying-party">1. Introduction</a> <a href="#ref-for-relying-party①">(2)</a> <a href="#ref-for-relying-party②">(3)</a> <a href="#ref-for-relying-party③">(4)</a> <a href="#ref-for-relying-party④">(5)</a>
    <li><a href="#ref-for-relying-party⑤">1.1.1. Cryptographic evidence of transaction confirmation</a>
    <li><a href="#ref-for-relying-party⑥">1.1.2. Registration in a third-party iframe</a>
    <li><a href="#ref-for-relying-party⑦">1.1.3. Merchant control of authentication</a> <a href="#ref-for-relying-party⑧">(2)</a> <a href="#ref-for-relying-party⑨">(3)</a>
    <li><a href="#ref-for-relying-party①⓪">2. Terminology</a> <a href="#ref-for-relying-party①①">(2)</a> <a href="#ref-for-relying-party①②">(3)</a> <a href="#ref-for-relying-party①③">(4)</a> <a href="#ref-for-relying-party①④">(5)</a>
    <li><a href="#ref-for-relying-party①⑤">4. Authentication</a>
    <li><a href="#ref-for-relying-party①⑥">4.1.7. Displaying a transaction confirmation UX</a>
    <li><a href="#ref-for-relying-party①⑦">5. WebAuthn Extension - "payment"</a> <a href="#ref-for-relying-party①⑧">(2)</a>
    <li><a href="#ref-for-relying-party①⑨">5.2. CollectedClientAdditionalPaymentData Dictionary</a>
    <li><a href="#ref-for-relying-party②⓪">6.1. PaymentCredentialInstrument Dictionary</a> <a href="#ref-for-relying-party②①">(2)</a>
    <li><a href="#ref-for-relying-party②②">8.1. Verifying an Authentication Assertion</a> <a href="#ref-for-relying-party②③">(2)</a> <a href="#ref-for-relying-party②④">(3)</a> <a href="#ref-for-relying-party②⑤">(4)</a> <a href="#ref-for-relying-party②⑥">(5)</a> <a href="#ref-for-relying-party②⑦">(6)</a> <a href="#ref-for-relying-party②⑧">(7)</a> <a href="#ref-for-relying-party②⑨">(8)</a>
    <li><a href="#ref-for-relying-party③⓪">10.1. Cross-origin authentication ceremony</a> <a href="#ref-for-relying-party③①">(2)</a>
    <li><a href="#ref-for-relying-party③②">10.1.1. Login Attack</a> <a href="#ref-for-relying-party③③">(2)</a> <a href="#ref-for-relying-party③④">(3)</a> <a href="#ref-for-relying-party③⑤">(4)</a> <a href="#ref-for-relying-party③⑥">(5)</a> <a href="#ref-for-relying-party③⑦">(6)</a> <a href="#ref-for-relying-party③⑧">(7)</a>
    <li><a href="#ref-for-relying-party③⑨">10.1.2. Payment Attack</a> <a href="#ref-for-relying-party④⓪">(2)</a> <a href="#ref-for-relying-party④①">(3)</a>
    <li><a href="#ref-for-relying-party④②">10.2. Merchant-supplied authentication data</a> <a href="#ref-for-relying-party④③">(2)</a>
    <li><a href="#ref-for-relying-party④④">11.2. Probing for credential ids</a> <a href="#ref-for-relying-party④⑤">(2)</a>
    <li><a href="#ref-for-relying-party④⑥">11.3. Joining different payment instruments</a> <a href="#ref-for-relying-party④⑦">(2)</a> <a href="#ref-for-relying-party④⑧">(3)</a> <a href="#ref-for-relying-party④⑨">(4)</a> <a href="#ref-for-relying-party⑤⓪">(5)</a>
    <li><a href="#ref-for-relying-party⑤①">11.4. Credential ID(s) as a tracking vector</a> <a href="#ref-for-relying-party⑤②">(2)</a> <a href="#ref-for-relying-party⑤③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-webauthn-extensions">
   <a href="https://w3c.github.io/webauthn/#webauthn-extensions">https://w3c.github.io/webauthn/#webauthn-extensions</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-webauthn-extensions">1. Introduction</a>
    <li><a href="#ref-for-webauthn-extensions①">3. Registration</a>
    <li><a href="#ref-for-webauthn-extensions②">4.1.3. SecurePaymentConfirmationRequest Dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dictdef-authenticationextensionsclientinputs">
   <a href="https://w3c.github.io/webauthn/#dictdef-authenticationextensionsclientinputs">https://w3c.github.io/webauthn/#dictdef-authenticationextensionsclientinputs</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-authenticationextensionsclientinputs">4.1.3. SecurePaymentConfirmationRequest Dictionary</a> <a href="#ref-for-dictdef-authenticationextensionsclientinputs①">(2)</a>
    <li><a href="#ref-for-dictdef-authenticationextensionsclientinputs②">4.1.8. Steps to respond to a payment request</a>
    <li><a href="#ref-for-dictdef-authenticationextensionsclientinputs③">5. WebAuthn Extension - "payment"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dictdef-collectedclientdata">
   <a href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata">https://w3c.github.io/webauthn/#dictdef-collectedclientdata</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-collectedclientdata">1.1.1. Cryptographic evidence of transaction confirmation</a>
    <li><a href="#ref-for-dictdef-collectedclientdata①">5. WebAuthn Extension - "payment"</a>
    <li><a href="#ref-for-dictdef-collectedclientdata②">5.1. CollectedClientPaymentData Dictionary</a> <a href="#ref-for-dictdef-collectedclientdata③">(2)</a>
    <li><a href="#ref-for-dictdef-collectedclientdata④">5.2. CollectedClientAdditionalPaymentData Dictionary</a>
    <li><a href="#ref-for-dictdef-collectedclientdata⑤">10.1.1. Login Attack</a> <a href="#ref-for-dictdef-collectedclientdata⑥">(2)</a> <a href="#ref-for-dictdef-collectedclientdata⑦">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-publickeycredential">
   <a href="https://w3c.github.io/webauthn/#publickeycredential">https://w3c.github.io/webauthn/#publickeycredential</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-publickeycredential">8.1. Verifying an Authentication Assertion</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dictdef-publickeycredentialdescriptor">
   <a href="https://w3c.github.io/webauthn/#dictdef-publickeycredentialdescriptor">https://w3c.github.io/webauthn/#dictdef-publickeycredentialdescriptor</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-publickeycredentialdescriptor">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dictdef-publickeycredentialrequestoptions">
   <a href="https://w3c.github.io/webauthn/#dictdef-publickeycredentialrequestoptions">https://w3c.github.io/webauthn/#dictdef-publickeycredentialrequestoptions</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-publickeycredentialrequestoptions">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-publickeycredential-create-slot">
   <a href="https://w3c.github.io/webauthn/#dom-publickeycredential-create-slot">https://w3c.github.io/webauthn/#dom-publickeycredential-create-slot</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-publickeycredential-create-slot">7. Permissions Policy integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-publickeycredential-discoverfromexternalsource-slot">
   <a href="https://w3c.github.io/webauthn/#dom-publickeycredential-discoverfromexternalsource-slot">https://w3c.github.io/webauthn/#dom-publickeycredential-discoverfromexternalsource-slot</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-publickeycredential-discoverfromexternalsource-slot">5. WebAuthn Extension - "payment"</a>
    <li><a href="#ref-for-dom-publickeycredential-discoverfromexternalsource-slot①">7. Permissions Policy integration</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-publickeycredentialrequestoptions-allowcredentials">
   <a href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials">https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-allowcredentials</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-publickeycredentialrequestoptions-allowcredentials">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-authenticatorselectioncriteria-authenticatorattachment">
   <a href="https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-authenticatorattachment">https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-authenticatorattachment</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-authenticatorselectioncriteria-authenticatorattachment">5. WebAuthn Extension - "payment"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-publickeycredentialcreationoptions-authenticatorselection">
   <a href="https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-authenticatorselection">https://w3c.github.io/webauthn/#dom-publickeycredentialcreationoptions-authenticatorselection</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-publickeycredentialcreationoptions-authenticatorselection">5. WebAuthn Extension - "payment"</a> <a href="#ref-for-dom-publickeycredentialcreationoptions-authenticatorselection①">(2)</a> <a href="#ref-for-dom-publickeycredentialcreationoptions-authenticatorselection②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-collectedclientdata-challenge">
   <a href="https://w3c.github.io/webauthn/#dom-collectedclientdata-challenge">https://w3c.github.io/webauthn/#dom-collectedclientdata-challenge</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-collectedclientdata-challenge">8.1. Verifying an Authentication Assertion</a>
    <li><a href="#ref-for-dom-collectedclientdata-challenge①">10.1.1. Login Attack</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-publickeycredentialrequestoptions-challenge">
   <a href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-challenge">https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-challenge</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-publickeycredentialrequestoptions-challenge">1.1.1. Cryptographic evidence of transaction confirmation</a>
    <li><a href="#ref-for-dom-publickeycredentialrequestoptions-challenge①">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-publickeycredentialrequestoptions-extensions">
   <a href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-extensions">https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-extensions</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-publickeycredentialrequestoptions-extensions">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-publickeycredentialdescriptor-id">
   <a href="https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-id">https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-id</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-publickeycredentialdescriptor-id">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-authenticatortransport-internal">
   <a href="https://w3c.github.io/webauthn/#dom-authenticatortransport-internal">https://w3c.github.io/webauthn/#dom-authenticatortransport-internal</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-authenticatortransport-internal">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-collectedclientdata-origin">
   <a href="https://w3c.github.io/webauthn/#dom-collectedclientdata-origin">https://w3c.github.io/webauthn/#dom-collectedclientdata-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-collectedclientdata-origin">8.1. Verifying an Authentication Assertion</a>
    <li><a href="#ref-for-dom-collectedclientdata-origin①">10.1.1. Login Attack</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-authenticatorattachment-platform">
   <a href="https://w3c.github.io/webauthn/#dom-authenticatorattachment-platform">https://w3c.github.io/webauthn/#dom-authenticatorattachment-platform</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-authenticatorattachment-platform">5. WebAuthn Extension - "payment"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-residentkeyrequirement-preferred">
   <a href="https://w3c.github.io/webauthn/#dom-residentkeyrequirement-preferred">https://w3c.github.io/webauthn/#dom-residentkeyrequirement-preferred</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-residentkeyrequirement-preferred">5. WebAuthn Extension - "payment"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-publickeycredentialtype-public-key">
   <a href="https://w3c.github.io/webauthn/#dom-publickeycredentialtype-public-key">https://w3c.github.io/webauthn/#dom-publickeycredentialtype-public-key</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-publickeycredentialtype-public-key">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-credentialrequestoptions-publickey">
   <a href="https://w3c.github.io/webauthn/#dom-credentialrequestoptions-publickey">https://w3c.github.io/webauthn/#dom-credentialrequestoptions-publickey</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-credentialrequestoptions-publickey">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-residentkeyrequirement-required">
   <a href="https://w3c.github.io/webauthn/#dom-residentkeyrequirement-required">https://w3c.github.io/webauthn/#dom-residentkeyrequirement-required</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-residentkeyrequirement-required">5. WebAuthn Extension - "payment"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-userverificationrequirement-required">
   <a href="https://w3c.github.io/webauthn/#dom-userverificationrequirement-required">https://w3c.github.io/webauthn/#dom-userverificationrequirement-required</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-userverificationrequirement-required">4.1.8. Steps to respond to a payment request</a>
    <li><a href="#ref-for-dom-userverificationrequirement-required①">5. WebAuthn Extension - "payment"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-authenticatorselectioncriteria-residentkey">
   <a href="https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-residentkey">https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-residentkey</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-authenticatorselectioncriteria-residentkey">5. WebAuthn Extension - "payment"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-publickeycredentialrequestoptions-rpid">
   <a href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-rpid">https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-rpid</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-publickeycredentialrequestoptions-rpid">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-publickeycredentialrequestoptions-timeout">
   <a href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-timeout">https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-timeout</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-publickeycredentialrequestoptions-timeout">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-publickeycredentialdescriptor-transports">
   <a href="https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-transports">https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-transports</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-publickeycredentialdescriptor-transports">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-collectedclientdata-type">
   <a href="https://w3c.github.io/webauthn/#dom-collectedclientdata-type">https://w3c.github.io/webauthn/#dom-collectedclientdata-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-collectedclientdata-type">5. WebAuthn Extension - "payment"</a>
    <li><a href="#ref-for-dom-collectedclientdata-type①">8.1. Verifying an Authentication Assertion</a>
    <li><a href="#ref-for-dom-collectedclientdata-type②">10.1.1. Login Attack</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-publickeycredentialdescriptor-type">
   <a href="https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-type">https://w3c.github.io/webauthn/#dom-publickeycredentialdescriptor-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-publickeycredentialdescriptor-type">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-authenticatorselectioncriteria-userverification">
   <a href="https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-userverification">https://w3c.github.io/webauthn/#dom-authenticatorselectioncriteria-userverification</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-authenticatorselectioncriteria-userverification">5. WebAuthn Extension - "payment"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-publickeycredentialrequestoptions-userverification">
   <a href="https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-userverification">https://w3c.github.io/webauthn/#dom-publickeycredentialrequestoptions-userverification</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-publickeycredentialrequestoptions-userverification">4.1.8. Steps to respond to a payment request</a> <a href="#ref-for-dom-publickeycredentialrequestoptions-userverification①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-extension-command">
   <a href="https://w3c.github.io/webdriver/#dfn-extension-command">https://w3c.github.io/webdriver/#dfn-extension-command</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-extension-command">9. User Agent Automation</a>
    <li><a href="#ref-for-dfn-extension-command①">9.1. Set SPC Transaction Mode</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-getting-properties">
   <a href="https://w3c.github.io/webdriver/#dfn-getting-properties">https://w3c.github.io/webdriver/#dfn-getting-properties</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-getting-properties">9.1. Set SPC Transaction Mode</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-invalid-argument">
   <a href="https://w3c.github.io/webdriver/#dfn-invalid-argument">https://w3c.github.io/webdriver/#dfn-invalid-argument</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-invalid-argument">9.1. Set SPC Transaction Mode</a> <a href="#ref-for-dfn-invalid-argument①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-remote-end-steps">
   <a href="https://w3c.github.io/webdriver/#dfn-remote-end-steps">https://w3c.github.io/webdriver/#dfn-remote-end-steps</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-remote-end-steps">9.1. Set SPC Transaction Mode</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-success">
   <a href="https://w3c.github.io/webdriver/#dfn-success">https://w3c.github.io/webdriver/#dfn-success</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-success">9.1. Set SPC Transaction Mode</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-undefined">
   <a href="https://w3c.github.io/webdriver/#dfn-undefined">https://w3c.github.io/webdriver/#dfn-undefined</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-undefined">9.1. Set SPC Transaction Mode</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-errors">
   <a href="https://w3c.github.io/webdriver/#dfn-errors">https://w3c.github.io/webdriver/#dfn-errors</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-errors">9.1. Set SPC Transaction Mode</a> <a href="#ref-for-dfn-errors①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-error-code">
   <a href="https://w3c.github.io/webdriver/#dfn-error-code">https://w3c.github.io/webdriver/#dfn-error-code</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-error-code">9.1. Set SPC Transaction Mode</a> <a href="#ref-for-dfn-error-code①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-BufferSource">
   <a href="https://heycam.github.io/webidl/#BufferSource">https://heycam.github.io/webidl/#BufferSource</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-BufferSource">4.1.3. SecurePaymentConfirmationRequest Dictionary</a> <a href="#ref-for-BufferSource①">(2)</a> <a href="#ref-for-BufferSource②">(3)</a> <a href="#ref-for-BufferSource③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMException">
   <a href="https://heycam.github.io/webidl/#idl-DOMException">https://heycam.github.io/webidl/#idl-DOMException</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMException">4.1.6. Steps to check if a payment can be made</a>
    <li><a href="#ref-for-idl-DOMException①">5. WebAuthn Extension - "payment"</a> <a href="#ref-for-idl-DOMException②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-notallowederror">
   <a href="https://heycam.github.io/webidl/#notallowederror">https://heycam.github.io/webidl/#notallowederror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-notallowederror">4.1.6. Steps to check if a payment can be made</a>
    <li><a href="#ref-for-notallowederror①">5. WebAuthn Extension - "payment"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-exceptiondef-rangeerror">
   <a href="https://heycam.github.io/webidl/#exceptiondef-rangeerror">https://heycam.github.io/webidl/#exceptiondef-rangeerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exceptiondef-rangeerror">4.1.5. Steps to validate payment method data</a> <a href="#ref-for-exceptiondef-rangeerror①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-securityerror">
   <a href="https://heycam.github.io/webidl/#securityerror">https://heycam.github.io/webidl/#securityerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-securityerror">5. WebAuthn Extension - "payment"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-exceptiondef-typeerror">
   <a href="https://heycam.github.io/webidl/#exceptiondef-typeerror">https://heycam.github.io/webidl/#exceptiondef-typeerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exceptiondef-typeerror">4.1.5. Steps to validate payment method data</a> <a href="#ref-for-exceptiondef-typeerror①">(2)</a> <a href="#ref-for-exceptiondef-typeerror②">(3)</a> <a href="#ref-for-exceptiondef-typeerror③">(4)</a> <a href="#ref-for-exceptiondef-typeerror④">(5)</a> <a href="#ref-for-exceptiondef-typeerror⑤">(6)</a> <a href="#ref-for-exceptiondef-typeerror⑥">(7)</a> <a href="#ref-for-exceptiondef-typeerror⑦">(8)</a> <a href="#ref-for-exceptiondef-typeerror⑧">(9)</a>
    <li><a href="#ref-for-exceptiondef-typeerror⑨">5. WebAuthn Extension - "payment"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-USVString">
   <a href="https://heycam.github.io/webidl/#idl-USVString">https://heycam.github.io/webidl/#idl-USVString</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-USVString">4.1.3. SecurePaymentConfirmationRequest Dictionary</a> <a href="#ref-for-idl-USVString①">(2)</a> <a href="#ref-for-idl-USVString②">(3)</a> <a href="#ref-for-idl-USVString③">(4)</a> <a href="#ref-for-idl-USVString④">(5)</a> <a href="#ref-for-idl-USVString⑤">(6)</a> <a href="#ref-for-idl-USVString⑥">(7)</a> <a href="#ref-for-idl-USVString⑦">(8)</a>
    <li><a href="#ref-for-idl-USVString⑧">5. WebAuthn Extension - "payment"</a> <a href="#ref-for-idl-USVString⑨">(2)</a> <a href="#ref-for-idl-USVString①⓪">(3)</a> <a href="#ref-for-idl-USVString①①">(4)</a> <a href="#ref-for-idl-USVString①②">(5)</a> <a href="#ref-for-idl-USVString①③">(6)</a> <a href="#ref-for-idl-USVString①④">(7)</a> <a href="#ref-for-idl-USVString①⑤">(8)</a>
    <li><a href="#ref-for-idl-USVString①⑥">5.2. CollectedClientAdditionalPaymentData Dictionary</a> <a href="#ref-for-idl-USVString①⑦">(2)</a> <a href="#ref-for-idl-USVString①⑧">(3)</a> <a href="#ref-for-idl-USVString①⑨">(4)</a> <a href="#ref-for-idl-USVString②⓪">(5)</a> <a href="#ref-for-idl-USVString②①">(6)</a> <a href="#ref-for-idl-USVString②②">(7)</a> <a href="#ref-for-idl-USVString②③">(8)</a>
    <li><a href="#ref-for-idl-USVString②④">6.1. PaymentCredentialInstrument Dictionary</a> <a href="#ref-for-idl-USVString②⑤">(2)</a> <a href="#ref-for-idl-USVString②⑥">(3)</a> <a href="#ref-for-idl-USVString②⑦">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-boolean">
   <a href="https://heycam.github.io/webidl/#idl-boolean">https://heycam.github.io/webidl/#idl-boolean</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-boolean">5. WebAuthn Extension - "payment"</a> <a href="#ref-for-idl-boolean①">(2)</a>
    <li><a href="#ref-for-idl-boolean②">6.1. PaymentCredentialInstrument Dictionary</a> <a href="#ref-for-idl-boolean③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-sequence">
   <a href="https://heycam.github.io/webidl/#idl-sequence">https://heycam.github.io/webidl/#idl-sequence</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-sequence">4.1.3. SecurePaymentConfirmationRequest Dictionary</a> <a href="#ref-for-idl-sequence①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-unsigned-long">
   <a href="https://heycam.github.io/webidl/#idl-unsigned-long">https://heycam.github.io/webidl/#idl-unsigned-long</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-unsigned-long">4.1.3. SecurePaymentConfirmationRequest Dictionary</a> <a href="#ref-for-idl-unsigned-long①">(2)</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[CREDENTIAL-MANAGEMENT-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-credentialscontainer-create">create()</span>
     <li><span class="dfn-paneled" id="term-for-dom-credentialscontainer-get">get()</span>
     <li><span class="dfn-paneled" id="term-for-dom-credential-id">id</span>
     <li><span class="dfn-paneled" id="term-for-abstract-opdef-request-a-credential">request a credential</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ECMASCRIPT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-sec-object-internal-methods-and-internal-slots">internal method</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-consume-user-activation">consume user activation</span>
     <li><span class="dfn-paneled" id="term-for-current-settings-object">current settings object</span>
     <li><span class="dfn-paneled" id="term-for-in-parallel">in parallel</span>
     <li><span class="dfn-paneled" id="term-for-concept-origin">origin</span>
     <li><span class="dfn-paneled" id="term-for-concept-relevant-global">relevant global object</span>
     <li><span class="dfn-paneled" id="term-for-relevant-settings-object">relevant settings object</span>
     <li><span class="dfn-paneled" id="term-for-ascii-serialisation-of-an-origin">serialization of an origin</span>
     <li><span class="dfn-paneled" id="term-for-concept-environment-top-level-origin">top-level origin</span>
     <li><span class="dfn-paneled" id="term-for-transient-activation">transient activation</span>
    </ul>
   <li>
    <a data-link-type="biblio">[I18N-GLOSSARY]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-language-negotiation">language negotiation</span>
     <li><span class="dfn-paneled" id="term-for-language-priority-list">language priority list</span>
     <li><span class="dfn-paneled" id="term-for-locale">locale</span>
    </ul>
   <li>
    <a data-link-type="biblio">[IMAGE-RESOURCE]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dfn-fetching-an-image-resource">fetching an image resource</span>
     <li><span class="dfn-paneled" id="term-for-dom-imageresource-src">src</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-list-append">append</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PAYMENT-METHOD-ID]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-registry">registry of standardized payment methods</span>
     <li><span class="dfn-paneled" id="term-for-dfn-standardized-payment-method-identifier">standardized payment method identifier</span>
    </ul>
   <li>
    <a data-link-type="biblio">[PAYMENT-REQUEST]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-paymentcurrencyamount">PaymentCurrencyAmount</span>
     <li><span class="dfn-paneled" id="term-for-dom-paymentrequest">PaymentRequest</span>
     <li><span class="dfn-paneled" id="term-for-dom-paymentrequest-constructor">constructor</span>
     <li><span class="dfn-paneled" id="term-for-dom-paymentcurrencyamount-currency">currency</span>
     <li><span class="dfn-paneled" id="term-for-dfn-payment-handler">payment handler</span>
     <li><span class="dfn-paneled" id="term-for-dfn-payment-method">payment method</span>
     <li><span class="dfn-paneled" id="term-for-dfn-additional-data-type">payment method additional data type</span>
     <li><span class="dfn-paneled" id="term-for-dfn-payment-permission">payment permission string</span>
     <li><span class="dfn-paneled" id="term-for-accessibility-considerations">payment request accessibility considerations</span>
     <li><span class="dfn-paneled" id="term-for-dfn-details">payment request details</span>
     <li><span class="dfn-paneled" id="term-for-dom-paymentrequest-show">show()</span>
     <li><span class="dfn-paneled" id="term-for-dfn-steps-to-check-if-a-payment-can-be-made">steps to check if a payment can be made</span>
     <li><span class="dfn-paneled" id="term-for-dfn-steps-to-respond-to-a-payment-request">steps to respond to a payment request</span>
     <li><span class="dfn-paneled" id="term-for-dfn-steps-to-validate-payment-method-data">steps to validate payment method data</span>
     <li><span class="dfn-paneled" id="term-for-dom-paymentdetailsinit-total">total</span>
     <li><span class="dfn-paneled" id="term-for-dom-paymentcurrencyamount-value">value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-url-origin">origin</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-scheme">scheme</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-parser">url parser</span>
     <li><span class="dfn-paneled" id="term-for-valid-domain">valid domain</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEB-AUTHN]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-authentication-ceremony">authentication ceremony</span>
     <li><span class="dfn-paneled" id="term-for-authentication-extension">authentication extension</span>
     <li><span class="dfn-paneled" id="term-for-client-extension">client extension</span>
     <li><span class="dfn-paneled" id="term-for-credential-id">credential id</span>
     <li><span class="dfn-paneled" id="term-for-discoverable-credential">discoverable credential</span>
     <li><span class="dfn-paneled" id="term-for-public-key-credential">public key credential</span>
     <li><span class="dfn-paneled" id="term-for-registration-extension">registration extension</span>
     <li><span class="dfn-paneled" id="term-for-relying-party">relying party</span>
     <li><span class="dfn-paneled" id="term-for-webauthn-extensions">webauthn extension</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBAUTHN-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dictdef-authenticationextensionsclientinputs">AuthenticationExtensionsClientInputs</span>
     <li><span class="dfn-paneled" id="term-for-dictdef-collectedclientdata">CollectedClientData</span>
     <li><span class="dfn-paneled" id="term-for-publickeycredential">PublicKeyCredential</span>
     <li><span class="dfn-paneled" id="term-for-dictdef-publickeycredentialdescriptor">PublicKeyCredentialDescriptor</span>
     <li><span class="dfn-paneled" id="term-for-dictdef-publickeycredentialrequestoptions">PublicKeyCredentialRequestOptions</span>
     <li><span class="dfn-paneled" id="term-for-dom-publickeycredential-create-slot">[[Create]](origin, options, sameOriginWithAncestors)</span>
     <li><span class="dfn-paneled" id="term-for-dom-publickeycredential-discoverfromexternalsource-slot">[[DiscoverFromExternalSource]](origin, options, sameOriginWithAncestors)</span>
     <li><span class="dfn-paneled" id="term-for-dom-publickeycredentialrequestoptions-allowcredentials">allowCredentials</span>
     <li><span class="dfn-paneled" id="term-for-dom-authenticatorselectioncriteria-authenticatorattachment">authenticatorAttachment</span>
     <li><span class="dfn-paneled" id="term-for-dom-publickeycredentialcreationoptions-authenticatorselection">authenticatorSelection</span>
     <li><span class="dfn-paneled" id="term-for-dom-collectedclientdata-challenge">challenge <small>(for CollectedClientData)</small></span>
     <li><span class="dfn-paneled" id="term-for-dom-publickeycredentialrequestoptions-challenge">challenge <small>(for PublicKeyCredentialRequestOptions)</small></span>
     <li><span class="dfn-paneled" id="term-for-dom-publickeycredentialrequestoptions-extensions">extensions</span>
     <li><span class="dfn-paneled" id="term-for-dom-publickeycredentialdescriptor-id">id</span>
     <li><span class="dfn-paneled" id="term-for-dom-authenticatortransport-internal">internal</span>
     <li><span class="dfn-paneled" id="term-for-dom-collectedclientdata-origin">origin</span>
     <li><span class="dfn-paneled" id="term-for-dom-authenticatorattachment-platform">platform</span>
     <li><span class="dfn-paneled" id="term-for-dom-residentkeyrequirement-preferred">preferred</span>
     <li><span class="dfn-paneled" id="term-for-dom-publickeycredentialtype-public-key">public-key</span>
     <li><span class="dfn-paneled" id="term-for-dom-credentialrequestoptions-publickey">publicKey</span>
     <li><span class="dfn-paneled" id="term-for-dom-residentkeyrequirement-required">required <small>(for ResidentKeyRequirement)</small></span>
     <li><span class="dfn-paneled" id="term-for-dom-userverificationrequirement-required">required <small>(for UserVerificationRequirement)</small></span>
     <li><span class="dfn-paneled" id="term-for-dom-authenticatorselectioncriteria-residentkey">residentKey</span>
     <li><span class="dfn-paneled" id="term-for-dom-publickeycredentialrequestoptions-rpid">rpId</span>
     <li><span class="dfn-paneled" id="term-for-dom-publickeycredentialrequestoptions-timeout">timeout</span>
     <li><span class="dfn-paneled" id="term-for-dom-publickeycredentialdescriptor-transports">transports</span>
     <li><span class="dfn-paneled" id="term-for-dom-collectedclientdata-type">type <small>(for CollectedClientData)</small></span>
     <li><span class="dfn-paneled" id="term-for-dom-publickeycredentialdescriptor-type">type <small>(for PublicKeyCredentialDescriptor)</small></span>
     <li><span class="dfn-paneled" id="term-for-dom-authenticatorselectioncriteria-userverification">userVerification <small>(for AuthenticatorSelectionCriteria)</small></span>
     <li><span class="dfn-paneled" id="term-for-dom-publickeycredentialrequestoptions-userverification">userVerification <small>(for PublicKeyCredentialRequestOptions)</small></span>
    </ul>
   <li>
    <a data-link-type="biblio">[WebDriver]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dfn-extension-command">extension command</span>
     <li><span class="dfn-paneled" id="term-for-dfn-getting-properties">getting a property</span>
     <li><span class="dfn-paneled" id="term-for-dfn-invalid-argument">invalid argument</span>
     <li><span class="dfn-paneled" id="term-for-dfn-remote-end-steps">remote end steps</span>
     <li><span class="dfn-paneled" id="term-for-dfn-success">success</span>
     <li><span class="dfn-paneled" id="term-for-dfn-undefined">undefined</span>
     <li><span class="dfn-paneled" id="term-for-dfn-errors">webdriver error</span>
     <li><span class="dfn-paneled" id="term-for-dfn-error-code">webdriver error code</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-BufferSource">BufferSource</span>
     <li><span class="dfn-paneled" id="term-for-idl-DOMException">DOMException</span>
     <li><span class="dfn-paneled" id="term-for-notallowederror">NotAllowedError</span>
     <li><span class="dfn-paneled" id="term-for-exceptiondef-rangeerror">RangeError</span>
     <li><span class="dfn-paneled" id="term-for-securityerror">SecurityError</span>
     <li><span class="dfn-paneled" id="term-for-exceptiondef-typeerror">TypeError</span>
     <li><span class="dfn-paneled" id="term-for-idl-USVString">USVString</span>
     <li><span class="dfn-paneled" id="term-for-idl-boolean">boolean</span>
     <li><span class="dfn-paneled" id="term-for-idl-sequence">sequence</span>
     <li><span class="dfn-paneled" id="term-for-idl-unsigned-long">unsigned long</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-credential-management-1">[CREDENTIAL-MANAGEMENT-1]
   <dd>Mike West. <a href="https://w3c.github.io/webappsec-credential-management/"><cite>Credential Management Level 1</cite></a>. URL: <a href="https://w3c.github.io/webappsec-credential-management/">https://w3c.github.io/webappsec-credential-management/</a>
   <dt id="biblio-ecmascript">[ECMASCRIPT]
   <dd><a href="https://tc39.es/ecma262/"><cite>ECMAScript Language Specification</cite></a>. URL: <a href="https://tc39.es/ecma262/">https://tc39.es/ecma262/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-image-resource">[IMAGE-RESOURCE]
   <dd>Aaron Gustafson; Rayan Kanso; Marcos Caceres. <a href="https://w3c.github.io/image-resource/"><cite>Image Resource</cite></a>. URL: <a href="https://w3c.github.io/image-resource/">https://w3c.github.io/image-resource/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-payment-method-id">[PAYMENT-METHOD-ID]
   <dd>Marcos Caceres; et al. <a href="https://w3c.github.io/payment-method-id/"><cite>Payment Method Identifiers</cite></a>. URL: <a href="https://w3c.github.io/payment-method-id/">https://w3c.github.io/payment-method-id/</a>
   <dt id="biblio-payment-request">[PAYMENT-REQUEST]
   <dd>Marcos Caceres; et al. <a href="https://w3c.github.io/payment-request/"><cite>Payment Request API</cite></a>. URL: <a href="https://w3c.github.io/payment-request/">https://w3c.github.io/payment-request/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webauthn-1">[WEBAUTHN-1]
   <dd>Dirk Balfanz; et al. <a href="https://w3c.github.io/webauthn/"><cite>Web Authentication:An API for accessing Public Key Credentials Level 1</cite></a>. URL: <a href="https://w3c.github.io/webauthn/">https://w3c.github.io/webauthn/</a>
   <dt id="biblio-webdriver">[WebDriver]
   <dd>Simon Stewart; David Burns. <a href="https://w3c.github.io/webdriver/"><cite>WebDriver</cite></a>. URL: <a href="https://w3c.github.io/webdriver/">https://w3c.github.io/webdriver/</a>
   <dt id="biblio-webidl">[WebIDL]
   <dd>Boris Zbarsky. <a href="https://heycam.github.io/webidl/"><cite>Web IDL</cite></a>. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-bcp47">[BCP47]
   <dd>A. Phillips, Ed.; M. Davis, Ed.. <a href="https://datatracker.ietf.org/doc/html/rfc5646"><cite>Tags for Identifying Languages</cite></a>. September 2009. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc5646">https://datatracker.ietf.org/doc/html/rfc5646</a>
   <dt id="biblio-rfc2397">[RFC2397]
   <dd>L. Masinter. <a href="https://datatracker.ietf.org/doc/html/rfc2397"><cite>The "data" URL scheme</cite></a>. August 1998. Proposed Standard. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2397">https://datatracker.ietf.org/doc/html/rfc2397</a>
   <dt id="biblio-rfc4647">[RFC4647]
   <dd>A. Phillips; M. Davis. <a href="https://datatracker.ietf.org/doc/html/rfc4647"><cite>Matching of Language Tags</cite></a>. September 2006. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc4647">https://datatracker.ietf.org/doc/html/rfc4647</a>
   <dt id="biblio-webauthn-conditional-ui">[WEBAUTHN-CONDITIONAL-UI]
   <dd><a href="https://github.com/w3c/webauthn/issues/1545"><cite>WebAuthn Conditional UI Proposal</cite></a>. URL: <a href="https://github.com/w3c/webauthn/issues/1545">https://github.com/w3c/webauthn/issues/1545</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="#dictdef-securepaymentconfirmationrequest"><c- g>SecurePaymentConfirmationRequest</c-></a> {
    <c- b>required</c-> <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#BufferSource"><c- n>BufferSource</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="BufferSource " href="#dom-securepaymentconfirmationrequest-challenge"><c- g>challenge</c-></a>;
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-securepaymentconfirmationrequest-rpid"><c- g>rpId</c-></a>;
    <c- b>required</c-> <a data-link-type="dfn" href="https://heycam.github.io/webidl/#idl-sequence"><c- b>sequence</c-></a>&lt;<a data-link-type="idl-name" href="https://heycam.github.io/webidl/#BufferSource"><c- n>BufferSource</c-></a>> <a class="idl-code" data-link-type="dict-member" data-type="sequence<BufferSource> " href="#dom-securepaymentconfirmationrequest-credentialids"><c- g>credentialIds</c-></a>;
    <c- b>required</c-> <a data-link-type="idl-name" href="#dictdef-paymentcredentialinstrument"><c- n>PaymentCredentialInstrument</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCredentialInstrument " href="#dom-securepaymentconfirmationrequest-instrument"><c- g>instrument</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-long"><c- b>unsigned</c-> <c- b>long</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="unsigned long " href="#dom-securepaymentconfirmationrequest-timeout"><c- g>timeout</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-securepaymentconfirmationrequest-payeename"><c- g>payeeName</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-securepaymentconfirmationrequest-payeeorigin"><c- g>payeeOrigin</c-></a>;
    <a data-link-type="idl-name" href="https://w3c.github.io/webauthn/#dictdef-authenticationextensionsclientinputs"><c- n>AuthenticationExtensionsClientInputs</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="AuthenticationExtensionsClientInputs " href="#dom-securepaymentconfirmationrequest-extensions"><c- g>extensions</c-></a>;
    <a data-link-type="dfn" href="https://heycam.github.io/webidl/#idl-sequence"><c- b>sequence</c-></a>&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a>> <a class="idl-code" data-link-type="dict-member" data-type="sequence<USVString> " href="#dom-securepaymentconfirmationrequest-locale"><c- g>locale</c-></a>;
};

<c- b>partial</c-> <c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="https://w3c.github.io/webauthn/#dictdef-authenticationextensionsclientinputs"><c- g>AuthenticationExtensionsClientInputs</c-></a> {
  <a data-link-type="idl-name" href="#dictdef-authenticationextensionspaymentinputs"><c- n>AuthenticationExtensionsPaymentInputs</c-></a> <a data-type="AuthenticationExtensionsPaymentInputs " href="#dom-authenticationextensionsclientinputs-payment"><code><c- g>payment</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-authenticationextensionspaymentinputs"><code><c- g>AuthenticationExtensionsPaymentInputs</c-></code></a> {
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean"><c- b>boolean</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="boolean " href="#dom-authenticationextensionspaymentinputs-ispayment"><c- g>isPayment</c-></a>;

  // Only used for authentication.
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-authenticationextensionspaymentinputs-rpid"><c- g>rpId</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-authenticationextensionspaymentinputs-toporigin"><c- g>topOrigin</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-authenticationextensionspaymentinputs-payeename"><c- g>payeeName</c-></a>;
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-authenticationextensionspaymentinputs-payeeorigin"><c- g>payeeOrigin</c-></a>;
  <a data-link-type="idl-name" href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount"><c- n>PaymentCurrencyAmount</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCurrencyAmount " href="#dom-authenticationextensionspaymentinputs-total"><c- g>total</c-></a>;
  <a data-link-type="idl-name" href="#dictdef-paymentcredentialinstrument"><c- n>PaymentCredentialInstrument</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCredentialInstrument " href="#dom-authenticationextensionspaymentinputs-instrument"><c- g>instrument</c-></a>;
};

<c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="#dictdef-collectedclientpaymentdata"><c- g>CollectedClientPaymentData</c-></a> : <a data-link-type="idl-name" href="https://w3c.github.io/webauthn/#dictdef-collectedclientdata"><c- n>CollectedClientData</c-></a> {
    <c- b>required</c-> <a data-link-type="idl-name" href="#dictdef-collectedclientadditionalpaymentdata"><c- n>CollectedClientAdditionalPaymentData</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="CollectedClientAdditionalPaymentData " href="#dom-collectedclientpaymentdata-payment"><c- g>payment</c-></a>;
};

<c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="#dictdef-collectedclientadditionalpaymentdata"><c- g>CollectedClientAdditionalPaymentData</c-></a> {
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-collectedclientadditionalpaymentdata-rpid"><c- g>rpId</c-></a>;
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-collectedclientadditionalpaymentdata-toporigin"><c- g>topOrigin</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-collectedclientadditionalpaymentdata-payeename"><c- g>payeeName</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-collectedclientadditionalpaymentdata-payeeorigin"><c- g>payeeOrigin</c-></a>;
    <c- b>required</c-> <a data-link-type="idl-name" href="https://www.w3.org/TR/payment-request/#dom-paymentcurrencyamount"><c- n>PaymentCurrencyAmount</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCurrencyAmount " href="#dom-collectedclientadditionalpaymentdata-total"><c- g>total</c-></a>;
    <c- b>required</c-> <a data-link-type="idl-name" href="#dictdef-paymentcredentialinstrument"><c- n>PaymentCredentialInstrument</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="PaymentCredentialInstrument " href="#dom-collectedclientadditionalpaymentdata-instrument"><c- g>instrument</c-></a>;
};

<c- b>dictionary</c-> <a class="idl-code" data-link-type="dictionary" href="#dictdef-paymentcredentialinstrument"><c- g>PaymentCredentialInstrument</c-></a> {
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-paymentcredentialinstrument-displayname"><c- g>displayName</c-></a>;
    <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="dict-member" data-type="USVString " href="#dom-paymentcredentialinstrument-icon"><c- g>icon</c-></a>;
    <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean"><c- b>boolean</c-></a> <a class="idl-code" data-default="true" data-link-type="dict-member" data-type="boolean " href="#dom-paymentcredentialinstrument-iconmustbeshown"><c- g>iconMustBeShown</c-></a> = <c- b>true</c->;
};

<c- b>enum</c-> <a href="#enumdef-transactionautomationmode"><code><c- g>TransactionAutomationMode</c-></code></a> {
  <a href="#dom-transactionautomationmode-none"><code><c- s>"none"</c-></code></a>,
  <a href="#dom-transactionautomationmode-autoaccept"><code><c- s>"autoaccept"</c-></code></a>,
  <a href="#dom-transactionautomationmode-autoreject"><code><c- s>"autoreject"</c-></code></a>
};

</pre>
  <aside class="dfn-panel" data-for="spc-credential">
   <b><a href="#spc-credential">#spc-credential</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-spc-credential">2. Terminology</a> <a href="#ref-for-spc-credential①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="steps-to-silently-determine-if-a-credential-is-spc-enabled">
   <b><a href="#steps-to-silently-determine-if-a-credential-is-spc-enabled">#steps-to-silently-determine-if-a-credential-is-spc-enabled</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-steps-to-silently-determine-if-a-credential-is-spc-enabled">4.1.6. Steps to check if a payment can be made</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="steps-to-silently-determine-if-a-credential-is-available-for-the-current-device">
   <b><a href="#steps-to-silently-determine-if-a-credential-is-available-for-the-current-device">#steps-to-silently-determine-if-a-credential-is-available-for-the-current-device</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-steps-to-silently-determine-if-a-credential-is-available-for-the-current-device">4.1.6. Steps to check if a payment can be made</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="secure-payment-confirmation-payment-handler">
   <b><a href="#secure-payment-confirmation-payment-handler">#secure-payment-confirmation-payment-handler</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-secure-payment-confirmation-payment-handler">4.1.1. Payment Method Identifier</a>
    <li><a href="#ref-for-secure-payment-confirmation-payment-handler①">4.1.7. Displaying a transaction confirmation UX</a>
    <li><a href="#ref-for-secure-payment-confirmation-payment-handler②">8.1. Verifying an Authentication Assertion</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="secure-payment-confirmation">
   <b><a href="#secure-payment-confirmation">#secure-payment-confirmation</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-secure-payment-confirmation">4. Authentication</a>
    <li><a href="#ref-for-secure-payment-confirmation①">4.1. Payment Method: Secure Payment Confirmation</a>
    <li><a href="#ref-for-secure-payment-confirmation②">4.1.2. Registration in [payment-method-id]</a>
    <li><a href="#ref-for-secure-payment-confirmation③">5. WebAuthn Extension - "payment"</a> <a href="#ref-for-secure-payment-confirmation④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-securepaymentconfirmationrequest">
   <b><a href="#dictdef-securepaymentconfirmationrequest">#dictdef-securepaymentconfirmationrequest</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-securepaymentconfirmationrequest">4.1.3. SecurePaymentConfirmationRequest Dictionary</a> <a href="#ref-for-dictdef-securepaymentconfirmationrequest①">(2)</a>
    <li><a href="#ref-for-dictdef-securepaymentconfirmationrequest②">4.1.4. Payment Method additional data type</a>
    <li><a href="#ref-for-dictdef-securepaymentconfirmationrequest③">4.1.5. Steps to validate payment method data</a>
    <li><a href="#ref-for-dictdef-securepaymentconfirmationrequest④">4.1.6. Steps to check if a payment can be made</a>
    <li><a href="#ref-for-dictdef-securepaymentconfirmationrequest⑤">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-securepaymentconfirmationrequest-challenge">
   <b><a href="#dom-securepaymentconfirmationrequest-challenge">#dom-securepaymentconfirmationrequest-challenge</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-challenge">4.1.3. SecurePaymentConfirmationRequest Dictionary</a>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-challenge①">4.1.5. Steps to validate payment method data</a>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-challenge②">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-securepaymentconfirmationrequest-rpid">
   <b><a href="#dom-securepaymentconfirmationrequest-rpid">#dom-securepaymentconfirmationrequest-rpid</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-rpid">4.1.3. SecurePaymentConfirmationRequest Dictionary</a>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-rpid①">4.1.5. Steps to validate payment method data</a>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-rpid②">4.1.6. Steps to check if a payment can be made</a>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-rpid③">4.1.8. Steps to respond to a payment request</a> <a href="#ref-for-dom-securepaymentconfirmationrequest-rpid④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-securepaymentconfirmationrequest-credentialids">
   <b><a href="#dom-securepaymentconfirmationrequest-credentialids">#dom-securepaymentconfirmationrequest-credentialids</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-credentialids">4.1.3. SecurePaymentConfirmationRequest Dictionary</a>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-credentialids①">4.1.5. Steps to validate payment method data</a> <a href="#ref-for-dom-securepaymentconfirmationrequest-credentialids②">(2)</a>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-credentialids③">4.1.6. Steps to check if a payment can be made</a> <a href="#ref-for-dom-securepaymentconfirmationrequest-credentialids④">(2)</a> <a href="#ref-for-dom-securepaymentconfirmationrequest-credentialids⑤">(3)</a>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-credentialids⑥">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-securepaymentconfirmationrequest-instrument">
   <b><a href="#dom-securepaymentconfirmationrequest-instrument">#dom-securepaymentconfirmationrequest-instrument</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-instrument">4.1.3. SecurePaymentConfirmationRequest Dictionary</a>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-instrument①">4.1.5. Steps to validate payment method data</a> <a href="#ref-for-dom-securepaymentconfirmationrequest-instrument②">(2)</a> <a href="#ref-for-dom-securepaymentconfirmationrequest-instrument③">(3)</a>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-instrument④">4.1.6. Steps to check if a payment can be made</a> <a href="#ref-for-dom-securepaymentconfirmationrequest-instrument⑤">(2)</a> <a href="#ref-for-dom-securepaymentconfirmationrequest-instrument⑥">(3)</a>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-instrument⑦">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-securepaymentconfirmationrequest-timeout">
   <b><a href="#dom-securepaymentconfirmationrequest-timeout">#dom-securepaymentconfirmationrequest-timeout</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-timeout">4.1.3. SecurePaymentConfirmationRequest Dictionary</a>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-timeout①">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-securepaymentconfirmationrequest-payeename">
   <b><a href="#dom-securepaymentconfirmationrequest-payeename">#dom-securepaymentconfirmationrequest-payeename</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-payeename">4.1.3. SecurePaymentConfirmationRequest Dictionary</a> <a href="#ref-for-dom-securepaymentconfirmationrequest-payeename①">(2)</a>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-payeename②">4.1.5. Steps to validate payment method data</a> <a href="#ref-for-dom-securepaymentconfirmationrequest-payeename③">(2)</a>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-payeename④">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-securepaymentconfirmationrequest-payeeorigin">
   <b><a href="#dom-securepaymentconfirmationrequest-payeeorigin">#dom-securepaymentconfirmationrequest-payeeorigin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-payeeorigin">4.1.3. SecurePaymentConfirmationRequest Dictionary</a> <a href="#ref-for-dom-securepaymentconfirmationrequest-payeeorigin①">(2)</a>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-payeeorigin②">4.1.5. Steps to validate payment method data</a> <a href="#ref-for-dom-securepaymentconfirmationrequest-payeeorigin③">(2)</a> <a href="#ref-for-dom-securepaymentconfirmationrequest-payeeorigin④">(3)</a> <a href="#ref-for-dom-securepaymentconfirmationrequest-payeeorigin⑤">(4)</a>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-payeeorigin⑥">4.1.6. Steps to check if a payment can be made</a> <a href="#ref-for-dom-securepaymentconfirmationrequest-payeeorigin⑦">(2)</a> <a href="#ref-for-dom-securepaymentconfirmationrequest-payeeorigin⑧">(3)</a>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-payeeorigin⑨">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-securepaymentconfirmationrequest-extensions">
   <b><a href="#dom-securepaymentconfirmationrequest-extensions">#dom-securepaymentconfirmationrequest-extensions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-extensions">4.1.3. SecurePaymentConfirmationRequest Dictionary</a>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-extensions①">4.1.8. Steps to respond to a payment request</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-securepaymentconfirmationrequest-locale">
   <b><a href="#dom-securepaymentconfirmationrequest-locale">#dom-securepaymentconfirmationrequest-locale</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-locale">4.1.3. SecurePaymentConfirmationRequest Dictionary</a> <a href="#ref-for-dom-securepaymentconfirmationrequest-locale①">(2)</a>
    <li><a href="#ref-for-dom-securepaymentconfirmationrequest-locale②">4.1.7. Displaying a transaction confirmation UX</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-authenticationextensionsclientinputs-payment">
   <b><a href="#dom-authenticationextensionsclientinputs-payment">#dom-authenticationextensionsclientinputs-payment</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-authenticationextensionsclientinputs-payment">3. Registration</a>
    <li><a href="#ref-for-dom-authenticationextensionsclientinputs-payment①">4.1.8. Steps to respond to a payment request</a>
    <li><a href="#ref-for-dom-authenticationextensionsclientinputs-payment②">10.1.1. Login Attack</a> <a href="#ref-for-dom-authenticationextensionsclientinputs-payment③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-authenticationextensionspaymentinputs">
   <b><a href="#dictdef-authenticationextensionspaymentinputs">#dictdef-authenticationextensionspaymentinputs</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-authenticationextensionspaymentinputs">4.1.8. Steps to respond to a payment request</a>
    <li><a href="#ref-for-dictdef-authenticationextensionspaymentinputs①">5. WebAuthn Extension - "payment"</a> <a href="#ref-for-dictdef-authenticationextensionspaymentinputs②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-authenticationextensionspaymentinputs-ispayment">
   <b><a href="#dom-authenticationextensionspaymentinputs-ispayment">#dom-authenticationextensionspaymentinputs-ispayment</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-authenticationextensionspaymentinputs-ispayment">4.1.8. Steps to respond to a payment request</a>
    <li><a href="#ref-for-dom-authenticationextensionspaymentinputs-ispayment①">5. WebAuthn Extension - "payment"</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-authenticationextensionspaymentinputs-rpid">
   <b><a href="#dom-authenticationextensionspaymentinputs-rpid">#dom-authenticationextensionspaymentinputs-rpid</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-authenticationextensionspaymentinputs-rpid">4.1.8. Steps to respond to a payment request</a>
    <li><a href="#ref-for-dom-authenticationextensionspaymentinputs-rpid①">5. WebAuthn Extension - "payment"</a> <a href="#ref-for-dom-authenticationextensionspaymentinputs-rpid②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-authenticationextensionspaymentinputs-toporigin">
   <b><a href="#dom-authenticationextensionspaymentinputs-toporigin">#dom-authenticationextensionspaymentinputs-toporigin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-authenticationextensionspaymentinputs-toporigin">4.1.8. Steps to respond to a payment request</a>
    <li><a href="#ref-for-dom-authenticationextensionspaymentinputs-toporigin①">5. WebAuthn Extension - "payment"</a> <a href="#ref-for-dom-authenticationextensionspaymentinputs-toporigin②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-authenticationextensionspaymentinputs-payeename">
   <b><a href="#dom-authenticationextensionspaymentinputs-payeename">#dom-authenticationextensionspaymentinputs-payeename</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-authenticationextensionspaymentinputs-payeename">4.1.8. Steps to respond to a payment request</a>
    <li><a href="#ref-for-dom-authenticationextensionspaymentinputs-payeename①">5. WebAuthn Extension - "payment"</a> <a href="#ref-for-dom-authenticationextensionspaymentinputs-payeename②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-authenticationextensionspaymentinputs-payeeorigin">
   <b><a href="#dom-authenticationextensionspaymentinputs-payeeorigin">#dom-authenticationextensionspaymentinputs-payeeorigin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-authenticationextensionspaymentinputs-payeeorigin">4.1.8. Steps to respond to a payment request</a>
    <li><a href="#ref-for-dom-authenticationextensionspaymentinputs-payeeorigin①">5. WebAuthn Extension - "payment"</a> <a href="#ref-for-dom-authenticationextensionspaymentinputs-payeeorigin②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-authenticationextensionspaymentinputs-total">
   <b><a href="#dom-authenticationextensionspaymentinputs-total">#dom-authenticationextensionspaymentinputs-total</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-authenticationextensionspaymentinputs-total">4.1.8. Steps to respond to a payment request</a>
    <li><a href="#ref-for-dom-authenticationextensionspaymentinputs-total①">5. WebAuthn Extension - "payment"</a> <a href="#ref-for-dom-authenticationextensionspaymentinputs-total②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-authenticationextensionspaymentinputs-instrument">
   <b><a href="#dom-authenticationextensionspaymentinputs-instrument">#dom-authenticationextensionspaymentinputs-instrument</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-authenticationextensionspaymentinputs-instrument">4.1.8. Steps to respond to a payment request</a>
    <li><a href="#ref-for-dom-authenticationextensionspaymentinputs-instrument①">5. WebAuthn Extension - "payment"</a> <a href="#ref-for-dom-authenticationextensionspaymentinputs-instrument②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-collectedclientpaymentdata">
   <b><a href="#dictdef-collectedclientpaymentdata">#dictdef-collectedclientpaymentdata</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-collectedclientpaymentdata">4.1.7. Displaying a transaction confirmation UX</a>
    <li><a href="#ref-for-dictdef-collectedclientpaymentdata①">5. WebAuthn Extension - "payment"</a>
    <li><a href="#ref-for-dictdef-collectedclientpaymentdata②">5.1. CollectedClientPaymentData Dictionary</a> <a href="#ref-for-dictdef-collectedclientpaymentdata③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-collectedclientpaymentdata-payment">
   <b><a href="#dom-collectedclientpaymentdata-payment">#dom-collectedclientpaymentdata-payment</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-collectedclientpaymentdata-payment">5. WebAuthn Extension - "payment"</a>
    <li><a href="#ref-for-dom-collectedclientpaymentdata-payment①">5.1. CollectedClientPaymentData Dictionary</a>
    <li><a href="#ref-for-dom-collectedclientpaymentdata-payment②">8.1. Verifying an Authentication Assertion</a> <a href="#ref-for-dom-collectedclientpaymentdata-payment③">(2)</a> <a href="#ref-for-dom-collectedclientpaymentdata-payment④">(3)</a> <a href="#ref-for-dom-collectedclientpaymentdata-payment⑤">(4)</a> <a href="#ref-for-dom-collectedclientpaymentdata-payment⑥">(5)</a> <a href="#ref-for-dom-collectedclientpaymentdata-payment⑦">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-collectedclientadditionalpaymentdata">
   <b><a href="#dictdef-collectedclientadditionalpaymentdata">#dictdef-collectedclientadditionalpaymentdata</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-collectedclientadditionalpaymentdata">5. WebAuthn Extension - "payment"</a>
    <li><a href="#ref-for-dictdef-collectedclientadditionalpaymentdata①">5.1. CollectedClientPaymentData Dictionary</a> <a href="#ref-for-dictdef-collectedclientadditionalpaymentdata②">(2)</a>
    <li><a href="#ref-for-dictdef-collectedclientadditionalpaymentdata③">5.2. CollectedClientAdditionalPaymentData Dictionary</a> <a href="#ref-for-dictdef-collectedclientadditionalpaymentdata④">(2)</a> <a href="#ref-for-dictdef-collectedclientadditionalpaymentdata⑤">(3)</a>
    <li><a href="#ref-for-dictdef-collectedclientadditionalpaymentdata⑥">6.1. PaymentCredentialInstrument Dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-collectedclientadditionalpaymentdata-rpid">
   <b><a href="#dom-collectedclientadditionalpaymentdata-rpid">#dom-collectedclientadditionalpaymentdata-rpid</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-rpid">5. WebAuthn Extension - "payment"</a>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-rpid①">5.2. CollectedClientAdditionalPaymentData Dictionary</a>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-rpid②">8.1. Verifying an Authentication Assertion</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-collectedclientadditionalpaymentdata-toporigin">
   <b><a href="#dom-collectedclientadditionalpaymentdata-toporigin">#dom-collectedclientadditionalpaymentdata-toporigin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-toporigin">5. WebAuthn Extension - "payment"</a>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-toporigin①">5.2. CollectedClientAdditionalPaymentData Dictionary</a>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-toporigin②">8.1. Verifying an Authentication Assertion</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-collectedclientadditionalpaymentdata-payeename">
   <b><a href="#dom-collectedclientadditionalpaymentdata-payeename">#dom-collectedclientadditionalpaymentdata-payeename</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-payeename">4.1.7. Displaying a transaction confirmation UX</a>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-payeename①">5. WebAuthn Extension - "payment"</a>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-payeename②">5.2. CollectedClientAdditionalPaymentData Dictionary</a>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-payeename③">8.1. Verifying an Authentication Assertion</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-collectedclientadditionalpaymentdata-payeeorigin">
   <b><a href="#dom-collectedclientadditionalpaymentdata-payeeorigin">#dom-collectedclientadditionalpaymentdata-payeeorigin</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-payeeorigin">4.1.7. Displaying a transaction confirmation UX</a>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-payeeorigin①">5. WebAuthn Extension - "payment"</a>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-payeeorigin②">5.2. CollectedClientAdditionalPaymentData Dictionary</a>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-payeeorigin③">8.1. Verifying an Authentication Assertion</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-collectedclientadditionalpaymentdata-total">
   <b><a href="#dom-collectedclientadditionalpaymentdata-total">#dom-collectedclientadditionalpaymentdata-total</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-total">4.1.7. Displaying a transaction confirmation UX</a>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-total①">5. WebAuthn Extension - "payment"</a>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-total②">5.2. CollectedClientAdditionalPaymentData Dictionary</a>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-total③">8.1. Verifying an Authentication Assertion</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-collectedclientadditionalpaymentdata-instrument">
   <b><a href="#dom-collectedclientadditionalpaymentdata-instrument">#dom-collectedclientadditionalpaymentdata-instrument</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-instrument">4.1.6. Steps to check if a payment can be made</a>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-instrument①">4.1.7. Displaying a transaction confirmation UX</a>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-instrument②">5. WebAuthn Extension - "payment"</a>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-instrument③">5.2. CollectedClientAdditionalPaymentData Dictionary</a>
    <li><a href="#ref-for-dom-collectedclientadditionalpaymentdata-instrument④">8.1. Verifying an Authentication Assertion</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-paymentcredentialinstrument">
   <b><a href="#dictdef-paymentcredentialinstrument">#dictdef-paymentcredentialinstrument</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-paymentcredentialinstrument">4.1.3. SecurePaymentConfirmationRequest Dictionary</a> <a href="#ref-for-dictdef-paymentcredentialinstrument①">(2)</a>
    <li><a href="#ref-for-dictdef-paymentcredentialinstrument②">5. WebAuthn Extension - "payment"</a> <a href="#ref-for-dictdef-paymentcredentialinstrument③">(2)</a>
    <li><a href="#ref-for-dictdef-paymentcredentialinstrument④">5.2. CollectedClientAdditionalPaymentData Dictionary</a> <a href="#ref-for-dictdef-paymentcredentialinstrument⑤">(2)</a>
    <li><a href="#ref-for-dictdef-paymentcredentialinstrument⑥">6.1. PaymentCredentialInstrument Dictionary</a> <a href="#ref-for-dictdef-paymentcredentialinstrument⑦">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-paymentcredentialinstrument-displayname">
   <b><a href="#dom-paymentcredentialinstrument-displayname">#dom-paymentcredentialinstrument-displayname</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-paymentcredentialinstrument-displayname">4.1.5. Steps to validate payment method data</a>
    <li><a href="#ref-for-dom-paymentcredentialinstrument-displayname①">4.1.7. Displaying a transaction confirmation UX</a>
    <li><a href="#ref-for-dom-paymentcredentialinstrument-displayname②">6.1. PaymentCredentialInstrument Dictionary</a> <a href="#ref-for-dom-paymentcredentialinstrument-displayname③">(2)</a>
    <li><a href="#ref-for-dom-paymentcredentialinstrument-displayname④">12. Accessibility Considerations</a> <a href="#ref-for-dom-paymentcredentialinstrument-displayname⑤">(2)</a> <a href="#ref-for-dom-paymentcredentialinstrument-displayname⑥">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-paymentcredentialinstrument-icon">
   <b><a href="#dom-paymentcredentialinstrument-icon">#dom-paymentcredentialinstrument-icon</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-paymentcredentialinstrument-icon">4.1.5. Steps to validate payment method data</a> <a href="#ref-for-dom-paymentcredentialinstrument-icon①">(2)</a>
    <li><a href="#ref-for-dom-paymentcredentialinstrument-icon②">4.1.6. Steps to check if a payment can be made</a> <a href="#ref-for-dom-paymentcredentialinstrument-icon③">(2)</a>
    <li><a href="#ref-for-dom-paymentcredentialinstrument-icon④">4.1.7. Displaying a transaction confirmation UX</a> <a href="#ref-for-dom-paymentcredentialinstrument-icon⑤">(2)</a>
    <li><a href="#ref-for-dom-paymentcredentialinstrument-icon⑥">6.1. PaymentCredentialInstrument Dictionary</a> <a href="#ref-for-dom-paymentcredentialinstrument-icon⑦">(2)</a>
    <li><a href="#ref-for-dom-paymentcredentialinstrument-icon⑧">12. Accessibility Considerations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-paymentcredentialinstrument-iconmustbeshown">
   <b><a href="#dom-paymentcredentialinstrument-iconmustbeshown">#dom-paymentcredentialinstrument-iconmustbeshown</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-paymentcredentialinstrument-iconmustbeshown">4.1.6. Steps to check if a payment can be made</a>
    <li><a href="#ref-for-dom-paymentcredentialinstrument-iconmustbeshown①">4.1.7. Displaying a transaction confirmation UX</a>
    <li><a href="#ref-for-dom-paymentcredentialinstrument-iconmustbeshown②">6.1. PaymentCredentialInstrument Dictionary</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="set-spc-transaction-mode">
   <b><a href="#set-spc-transaction-mode">#set-spc-transaction-mode</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-set-spc-transaction-mode">9.1. Set SPC Transaction Mode</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="current-transaction-automation-mode">
   <b><a href="#current-transaction-automation-mode">#current-transaction-automation-mode</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-current-transaction-automation-mode">4.1.7. Displaying a transaction confirmation UX</a> <a href="#ref-for-current-transaction-automation-mode①">(2)</a>
    <li><a href="#ref-for-current-transaction-automation-mode②">9.1. Set SPC Transaction Mode</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="enumdef-transactionautomationmode">
   <b><a href="#enumdef-transactionautomationmode">#enumdef-transactionautomationmode</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-transactionautomationmode">9.1. Set SPC Transaction Mode</a> <a href="#ref-for-enumdef-transactionautomationmode①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-transactionautomationmode-none">
   <b><a href="#dom-transactionautomationmode-none">#dom-transactionautomationmode-none</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-transactionautomationmode-none">4.1.7. Displaying a transaction confirmation UX</a>
    <li><a href="#ref-for-dom-transactionautomationmode-none①">9.1. Set SPC Transaction Mode</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-transactionautomationmode-autoaccept">
   <b><a href="#dom-transactionautomationmode-autoaccept">#dom-transactionautomationmode-autoaccept</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-transactionautomationmode-autoaccept">4.1.7. Displaying a transaction confirmation UX</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-transactionautomationmode-autoreject">
   <b><a href="#dom-transactionautomationmode-autoreject">#dom-transactionautomationmode-autoreject</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-transactionautomationmode-autoreject">4.1.7. Displaying a transaction confirmation UX</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>